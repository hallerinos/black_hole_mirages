(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    315221,       7472]
NotebookOptionsPosition[    306017,       7325]
NotebookOutlinePosition[    306533,       7344]
CellTagsIndexPosition[    306490,       7341]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 ButtonBox[
  RowBox[{"Black", " ", "Hole", " ", 
   RowBox[{"Mirages", ":", " ", 
    RowBox[{
    "electron", " ", "lensing", " ", "and", " ", "Berry", " ", "curvature", 
     " ", "effects", " ", "in", " ", "inhomogeneously", " ", "tilted", " ", 
     "Weyl", " ", "semimetals"}]}]}],
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://arxiv.org/abs/2210.16254"], None},
  ButtonNote->"https://arxiv.org/abs/2210.16254"]], "Subtitle",
 CellChangeTimes->{{3.876372690381579*^9, 3.87637269737879*^9}, {
  3.876372767311132*^9, 3.876372805634338*^9}, {3.876372903415181*^9, 
  3.87637290525632*^9}},ExpressionUUID->"85bcbaea-da79-47a9-8841-\
3e5fd17331cb"],

Cell[TextData[{
 "Andreas ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["Haller", "*"], TraditionalForm]],ExpressionUUID->
  "219cf1b3-2d59-466a-abf7-c03e5d96bcf2"],
 ", Suraj Hegde, Chen Xu, Christophe De Beule, Thomas L. Schmidt, Tobias Meng\
\n* ",
 ButtonBox["andreas.haller@uni.lu",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["mailto:andreas.haller@uni.lu"], None},
  ButtonNote->"mailto:andreas.haller@uni.lu"]
}], "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.87637281627984*^9, 
  3.876372889055265*^9}},ExpressionUUID->"972199aa-7d14-4887-b813-\
b221dd610ba3"],

Cell[CellGroupData[{

Cell["Auxiliary Functions and Modules", "Subsection",
 CellChangeTimes->{{3.8762116731676607`*^9, 3.87621168019105*^9}, {
  3.8763726780972*^9, 
  3.876372683856434*^9}},ExpressionUUID->"16834aeb-6dc8-44ad-b1a3-\
534a9027c016"],

Cell[CellGroupData[{

Cell["SEOM Solutions", "Subsubsection",
 CellChangeTimes->{{3.876278450395162*^9, 
  3.876278455223147*^9}},ExpressionUUID->"bf937a19-27d2-4354-aaf4-\
706dd50f00fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"some", " ", "auxiliary", " ", "functions"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "norm", ",", "hat", ",", "\[Rho]", ",", "\[Rho]s", ",", "v", ",", 
     "\[Alpha]", ",", "r"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"norm", "[", "v_", "]"}], ":=", 
     SqrtBox[
      RowBox[{"v", ".", "v"}]]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"convenient", " ", "norm"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hat", "[", "v_", "]"}], ":=", 
     FractionBox["v", 
      RowBox[{"norm", "[", "v", "]"}]]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"unit", " ", "vector"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Rho]", "[", "v_", "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"v", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"0", 
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"sph", "."}], "\[TwoWayRule]", 
     RowBox[{
      RowBox[{
       RowBox[{"cyl", "."}], " ", ":", " ", 
       RowBox[{"0", 
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], " ", "\[TwoWayRule]", " ", 
      RowBox[{"v", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Rho]s", "[", 
      RowBox[{"r_", ",", "\[Alpha]_"}], "]"}], ":=", 
     RowBox[{"r", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
       FractionBox["1", 
        RowBox[{"2", " ", "\[Alpha]"}]]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{
    "L", ",", "spin", ",", "J", ",", " ", "xv", ",", "kv", ",", "\[Chi]"}], 
    "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"L", "[", 
      RowBox[{"xv_", ",", "kv_"}], "]"}], ":=", 
     RowBox[{"xv", "\[Cross]", "kv"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"angular", " ", "momentum"}], " ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"spin", "[", 
      RowBox[{"\[Chi]_", ",", "kv_"}], "]"}], ":=", 
     RowBox[{
      FractionBox["\[Chi]", "2"], 
      RowBox[{"hat", "[", "kv", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"J", "[", 
      RowBox[{"\[Chi]_", ",", "xv_", ",", "kv_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"xv", ",", "kv"}], "]"}], "+", 
      RowBox[{"spin", "[", 
       RowBox[{"\[Chi]", ",", "kv"}], "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"total", " ", "angular", " ", "momentum"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{
    "u", ",", "r", ",", "vF", ",", "rt", ",", "r", ",", "\[Alpha]", ",", 
     "v"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"u", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "r_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"-", "vF"}], 
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox["rt", "r"], ")"}], "\[Alpha]"]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"scalar", " ", "part", " ", "of", " ", "the", " ", "tilt"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "v_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"u", "[", 
       RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
        RowBox[{"norm", "[", 
         RowBox[{"\[Rho]", "[", "v", "]"}], "]"}]}], "]"}], "*", 
      RowBox[{"hat", "[", 
       RowBox[{"\[Rho]", "[", "v", "]"}], "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", "tilt", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalOmega]", "[", 
      RowBox[{"\[Chi]_", ",", "v_"}], "]"}], ":=", 
     RowBox[{
      FractionBox[
       RowBox[{"\[Chi]", " "}], "2"], 
      FractionBox["v", 
       SuperscriptBox[
        RowBox[{"norm", "[", "v", "]"}], "3"]]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"Berry", " ", "curvature"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"uv", "[", 
        RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
         RowBox[{"\[Rho]", "[", "xs", "]"}]}], "]"}], ".", "ks"}], "+", 
      RowBox[{"vF", "*", 
       RowBox[{"norm", "[", "ks", "]"}]}]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"energy", " ", "dispersion"}], " ", "*)"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "the", " ", "main", " ", "module", " ", "for", " ", "solving", " ", "the",
      " ", "SEOM"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{
    "solveSEOM", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", "\[Alpha]", 
     ",", "\[Chi]", ",", "ti", ",", "tf", ",", "t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"solveSEOM", "[", 
      RowBox[{
      "s_", ",", "x0_", ",", "k0_", ",", "vF_", ",", "rt_", ",", "\[Alpha]_", 
       ",", "\[Chi]_", ",", 
       RowBox[{"ti_", ":", 
        RowBox[{"-", "20"}]}], ",", 
       RowBox[{"tf_", ":", "20"}], ",", 
       RowBox[{"p\[CapitalOmega]_", ":", 
        RowBox[{"+", "1.0"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "define", " ", "variables", " ", "in", " ", "module", " ", "scope"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "xv", ",", "kv", ",", " ", "r", ",", "x", ",", "y", ",", "z", ",", 
         "kx", ",", "ky", ",", "kz", ",", "eq1", ",", "eq2", ",", "eq3", ",", 
         "eq4", ",", " ", "problem", ",", " ", "solution", ",", "xvs", ",", 
         "kvs", ",", "tstop", ",", "return", ",", "t"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"module", " ", "body"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xv", "[", "t_", "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "[", "t", "]"}], ",", 
           RowBox[{"y", "[", "t", "]"}], ",", 
           RowBox[{"z", "[", "t", "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"kv", "[", "t_", "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kx", "[", "t", "]"}], ",", 
           RowBox[{"ky", "[", "t", "]"}], ",", 
           RowBox[{"kz", "[", "t", "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"eq1", "[", "t_", "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"xv", "'"}], "[", "t", "]"}], "\[Equal]", 
           RowBox[{
            RowBox[{"+", 
             RowBox[{"D", "[", 
              RowBox[{
               RowBox[{"\[Epsilon]", "[", 
                RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
                 RowBox[{"xv", "[", "t", "]"}], ",", 
                 RowBox[{"kv", "[", "t", "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"kv", "[", "t", "]"}], ",", "1"}], "}"}]}], "]"}]}], 
            "+", 
            RowBox[{"p\[CapitalOmega]", "*", 
             RowBox[{
              RowBox[{
               RowBox[{"kv", "'"}], "[", "t", "]"}], "\[Cross]", 
              RowBox[{"\[CapitalOmega]", "[", 
               RowBox[{"\[Chi]", ",", 
                RowBox[{"kv", "[", "t", "]"}]}], "]"}]}]}]}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"eq2", "[", "t_", "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"kv", "'"}], "[", "t", "]"}], "\[Equal]", 
           RowBox[{"-", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{"\[Epsilon]", "[", 
               RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
                RowBox[{"xv", "[", "t", "]"}], ",", 
                RowBox[{"kv", "[", "t", "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"xv", "[", "t", "]"}], ",", "1"}], "}"}]}], "]"}]}]}],
           ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"set", " ", "initial", " ", "conditions"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"eq4", ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"kv", "[", "0", "]"}], "\[Equal]", "k0"}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eq3", ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"xv", "[", "0", "]"}], "\[Equal]", "x0"}], ")"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"combine", " ", "the", " ", 
          RowBox[{"eq", "'"}], "s", " ", "defined", " ", "above", " ", "with",
           " ", "a", " ", "stopping", " ", "criterion"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tstop", "=", "\[Infinity]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"problem", "[", "t_", "]"}], ":=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "j"}], "]"}], "]"}], "\[Equal]", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "j"}], "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "&"}], "/@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"eq1", "[", "t", "]"}], ",", 
               RowBox[{"eq2", "[", "t", "]"}], ",", "eq3", ",", "eq4"}], 
              "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"WhenEvent", "[", 
             RowBox[{
              RowBox[{
               SqrtBox[
                RowBox[{
                 SuperscriptBox[
                  RowBox[{
                   RowBox[{"x", "'"}], "[", "t", "]"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{
                   RowBox[{"y", "'"}], "[", "t", "]"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{
                   RowBox[{"z", "'"}], "[", "t", "]"}], "2"]}]], 
               "\[GreaterEqual]", "200"}], ",", 
              RowBox[{
               RowBox[{"tstop", "=", "t"}], ";", 
               "\"\<StopIntegration\>\""}]}], "]"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "numerically", " ", "solve", " ", "the", " ", "coupled", " ", 
          "differential", " ", "equation"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"solution", "[", "t_", "]"}], "=", 
         RowBox[{"First", "[", 
          RowBox[{"NDSolve", "[", 
           RowBox[{
            RowBox[{"problem", "[", "t", "]"}], ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"xv", "[", "t", "]"}], ",", 
               RowBox[{"kv", "[", "t", "]"}]}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"t", ",", "ti", ",", "tf"}], "}"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "this", " ", "might", " ", "not", " ", "catch", " ", "all", " ", 
           "errors"}], ",", " ", 
          RowBox[{"but", " ", 
           RowBox[{"it", "'"}], "ll", " ", "do", " ", "for", " ", "the", " ", 
           "examples", " ", "in", " ", "this", " ", "notebook"}]}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tstop", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"{", 
           RowBox[{"tstop", ",", "tf"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"tstop", "<", "tf"}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<WATCHOUT: tstop=\>\"", "<>", 
            RowBox[{"ToString", "[", "tstop", "]"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"return", "[", "t_", "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"xv", "[", "t", "]"}], "/.", 
            RowBox[{"solution", "[", "t", "]"}]}], ",", " ", 
           RowBox[{
            RowBox[{"kv", "[", "t", "]"}], "/.", 
            RowBox[{"solution", "[", "t", "]"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "return", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"return", "[", "s", "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8753718139163637`*^9, 3.87537248883603*^9}, {
   3.875372521731038*^9, 3.875372598948813*^9}, {3.875372638071093*^9, 
   3.875372667444627*^9}, {3.875372723166608*^9, 3.875372725279752*^9}, {
   3.875372775786047*^9, 3.875372839413402*^9}, {3.87537298938726*^9, 
   3.875372996196085*^9}, {3.875373266701687*^9, 3.875373269475806*^9}, {
   3.8753740342706327`*^9, 3.875374062303205*^9}, {3.875374107478236*^9, 
   3.875374129561631*^9}, {3.8753742235618763`*^9, 3.875374288559656*^9}, {
   3.8753745212889833`*^9, 3.8753745214028177`*^9}, {3.8753745527154493`*^9, 
   3.8753745541002493`*^9}, {3.87537468585247*^9, 3.875374737670253*^9}, {
   3.8753749416599703`*^9, 3.875374942554412*^9}, {3.8753749973764257`*^9, 
   3.8753750783600807`*^9}, {3.875385775677775*^9, 3.8753860496047564`*^9}, {
   3.87538609156984*^9, 3.875386336073556*^9}, {3.8753867452336473`*^9, 
   3.875386763139112*^9}, 3.8753893224917*^9, 3.8753895341269903`*^9, {
   3.8753895909044533`*^9, 3.87538959120335*^9}, {3.875392584653295*^9, 
   3.875392610046296*^9}, {3.87539265307832*^9, 3.8753928085458117`*^9}, {
   3.875392870917982*^9, 3.875393012844138*^9}, {3.8753930547353086`*^9, 
   3.8753932657394238`*^9}, {3.875393308527615*^9, 3.8753934868131733`*^9}, {
   3.875393568798623*^9, 3.875393674799918*^9}, {3.87539373456922*^9, 
   3.875393906421476*^9}, {3.875394055285266*^9, 3.87539410019022*^9}, {
   3.875394147263425*^9, 3.875394218317411*^9}, {3.8754297523229313`*^9, 
   3.875429813412734*^9}, {3.875429913463326*^9, 3.8754299373395357`*^9}, {
   3.875610005315555*^9, 3.875610056741839*^9}, {3.875610418681381*^9, 
   3.875610418744589*^9}, 3.875610631099875*^9, {3.875610931587153*^9, 
   3.875610952400519*^9}, {3.875701282068931*^9, 3.875701335833992*^9}, {
   3.875701390734514*^9, 3.8757014500530787`*^9}, {3.8757014851493073`*^9, 
   3.875701490376498*^9}, {3.875701538720487*^9, 3.8757016382435913`*^9}, {
   3.875701682009058*^9, 3.875701738438554*^9}, {3.875701931633971*^9, 
   3.875702002830406*^9}, {3.875702037280258*^9, 3.875702180350152*^9}, {
   3.875702287017178*^9, 3.875702308255604*^9}, {3.8757175804769773`*^9, 
   3.8757176223524218`*^9}, 3.875717922657584*^9, {3.875719570359198*^9, 
   3.875719680025148*^9}, {3.875719970007078*^9, 3.875719989423703*^9}, {
   3.875720023744266*^9, 3.8757200836177692`*^9}, {3.87572011934797*^9, 
   3.875720188052978*^9}, {3.875720223638438*^9, 3.875720224402527*^9}, {
   3.876199546274818*^9, 3.87619958991718*^9}, {3.8762005183223143`*^9, 
   3.876200531014008*^9}, {3.876200562943416*^9, 3.876200571262085*^9}, {
   3.876200653525708*^9, 3.876200703673315*^9}, {3.87620085949335*^9, 
   3.8762008688634443`*^9}, {3.8762017617851057`*^9, 3.876202438947668*^9}, {
   3.8762025340809603`*^9, 3.8762025400643463`*^9}, {3.87620261709443*^9, 
   3.876202669832224*^9}, {3.8762027197741833`*^9, 3.876202730904736*^9}, {
   3.8762028556244097`*^9, 3.876202927107202*^9}, {3.876203001875944*^9, 
   3.876203043946033*^9}, {3.8762031327067633`*^9, 3.876203148035384*^9}, {
   3.8762032528849792`*^9, 3.876203262675536*^9}, {3.876209233851369*^9, 
   3.876209236504562*^9}, {3.8762112685729303`*^9, 3.876211309596569*^9}, {
   3.876211346880439*^9, 3.876211470947081*^9}, 3.876211731402624*^9, 
   3.876212046401372*^9, 3.8762121612878437`*^9, {3.876212215525592*^9, 
   3.876212247524146*^9}, {3.876212391383792*^9, 3.8762124905947*^9}, 
   3.876212543760313*^9, 3.876212765713426*^9, {3.876212959406522*^9, 
   3.876212959994162*^9}, {3.876213018074327*^9, 3.876213044438684*^9}, 
   3.876213090689808*^9, {3.8762132649719067`*^9, 3.876213276804166*^9}, 
   3.876214214167169*^9, {3.8762142974467373`*^9, 3.876214437745427*^9}, {
   3.876214667689506*^9, 3.876214721049564*^9}, {3.876214760241654*^9, 
   3.8762147721363792`*^9}, {3.876215351659543*^9, 3.876215417140147*^9}, {
   3.876215459066053*^9, 3.8762155730949163`*^9}, {3.876215612514304*^9, 
   3.87621574769133*^9}, 3.876216085475499*^9, {3.876216120107068*^9, 
   3.8762161246353683`*^9}, {3.876216664690085*^9, 3.876216665123727*^9}, {
   3.8762167172075768`*^9, 3.876216734773028*^9}, {3.876217319776656*^9, 
   3.8762173634314747`*^9}, {3.876278663197618*^9, 3.876278663752372*^9}, {
   3.876279664735392*^9, 3.876279675165155*^9}, {3.8762861288801317`*^9, 
   3.87628644839167*^9}, {3.8762969655162487`*^9, 3.876297027238597*^9}, {
   3.876372279038331*^9, 3.8763722834853373`*^9}, {3.876391067642168*^9, 
   3.876391091153441*^9}, {3.876391138881234*^9, 3.876391144434504*^9}, {
   3.876391224655499*^9, 3.876391228491456*^9}, {3.8763912902745333`*^9, 
   3.8763913010295277`*^9}, {3.8763913312444973`*^9, 3.876391350577849*^9}, {
   3.876391438056376*^9, 3.8763915012070007`*^9}, {3.876391578542211*^9, 
   3.8763915811039143`*^9}, {3.876391613774961*^9, 3.8763916138562803`*^9}, {
   3.876391678910523*^9, 3.8763916807994213`*^9}, {3.876391736937585*^9, 
   3.8763918200235233`*^9}, {3.876391873759432*^9, 3.876391893624824*^9}, {
   3.8763919738151417`*^9, 3.876391987899564*^9}, {3.87639211186754*^9, 
   3.87639214124658*^9}, {3.8763949285654497`*^9, 3.876395170928577*^9}, {
   3.876395805331493*^9, 3.876396028796269*^9}, {3.8763960600592833`*^9, 
   3.876396084704054*^9}, {3.876396254328445*^9, 3.876396257921694*^9}, {
   3.87639647434933*^9, 3.876396501191517*^9}, {3.876396618809451*^9, 
   3.8763966285658197`*^9}, {3.876396677693253*^9, 3.876396684601419*^9}, {
   3.876396743043913*^9, 3.876396743136544*^9}, {3.876396804582081*^9, 
   3.8763968432424593`*^9}, {3.8763984583003273`*^9, 3.87639848287786*^9}, {
   3.8763985186919928`*^9, 3.876398550987537*^9}, {3.8763986112464523`*^9, 
   3.876398611382667*^9}, {3.876398747694291*^9, 3.876398819063278*^9}, {
   3.876399485324885*^9, 3.8763994854302807`*^9}, {3.876408008268139*^9, 
   3.876408010272365*^9}, {3.876408043193219*^9, 3.876408050939942*^9}, {
   3.8819026793141117`*^9, 3.881902718843018*^9}, {3.882263267885899*^9, 
   3.8822632683524218`*^9}, 3.88226424891481*^9, {3.882265161842428*^9, 
   3.882265161899601*^9}, 3.882265226206347*^9, {3.8822665797234573`*^9, 
   3.882266579940042*^9}},
 CellLabel->
  "In[323]:=",ExpressionUUID->"8c845484-fbdb-440b-9c72-f8615d0ef9dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",", "\[Alpha]", ",", 
     "\[Chi]", ",", "ti", ",", "tf", ",", "\[Rho]t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "5"}], "}"}], "]"}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8753718139163637`*^9, 3.87537248883603*^9}, {
   3.875372521731038*^9, 3.875372598948813*^9}, {3.875372638071093*^9, 
   3.875372667444627*^9}, {3.875372723166608*^9, 3.875372725279752*^9}, {
   3.875372775786047*^9, 3.875372839413402*^9}, {3.87537298938726*^9, 
   3.875372996196085*^9}, {3.875373266701687*^9, 3.875373269475806*^9}, {
   3.8753740342706327`*^9, 3.875374062303205*^9}, {3.875374107478236*^9, 
   3.875374129561631*^9}, {3.8753742235618763`*^9, 3.875374288559656*^9}, {
   3.8753745212889833`*^9, 3.8753745214028177`*^9}, {3.8753745527154493`*^9, 
   3.8753745541002493`*^9}, {3.87537468585247*^9, 3.875374737670253*^9}, {
   3.8753749416599703`*^9, 3.875374942554412*^9}, {3.8753749973764257`*^9, 
   3.8753750783600807`*^9}, {3.875385775677775*^9, 3.8753860496047564`*^9}, {
   3.87538609156984*^9, 3.875386336073556*^9}, {3.8753867452336473`*^9, 
   3.875386763139112*^9}, 3.8753893224917*^9, 3.8753895341269903`*^9, {
   3.8753895909044533`*^9, 3.87538959120335*^9}, {3.875392584653295*^9, 
   3.875392610046296*^9}, {3.87539265307832*^9, 3.8753928085458117`*^9}, {
   3.875392870917982*^9, 3.875393012844138*^9}, {3.8753930547353086`*^9, 
   3.8753932657394238`*^9}, {3.875393308527615*^9, 3.8753934868131733`*^9}, {
   3.875393568798623*^9, 3.875393674799918*^9}, {3.87539373456922*^9, 
   3.875393906421476*^9}, {3.875394055285266*^9, 3.87539410019022*^9}, {
   3.875394147263425*^9, 3.875394218317411*^9}, {3.8754297523229313`*^9, 
   3.875429813412734*^9}, {3.875429913463326*^9, 3.8754299373395357`*^9}, {
   3.875610005315555*^9, 3.875610056741839*^9}, {3.875610418681381*^9, 
   3.875610418744589*^9}, 3.875610631099875*^9, {3.875610931587153*^9, 
   3.875610952400519*^9}, {3.875701282068931*^9, 3.875701335833992*^9}, {
   3.875701390734514*^9, 3.8757014500530787`*^9}, {3.8757014851493073`*^9, 
   3.875701490376498*^9}, {3.875701538720487*^9, 3.8757016382435913`*^9}, {
   3.875701682009058*^9, 3.875701738438554*^9}, {3.875701931633971*^9, 
   3.875702002830406*^9}, {3.875702037280258*^9, 3.875702180350152*^9}, {
   3.875702287017178*^9, 3.875702308255604*^9}, {3.8757175804769773`*^9, 
   3.8757176223524218`*^9}, 3.875717922657584*^9, {3.875719570359198*^9, 
   3.875719680025148*^9}, {3.875719970007078*^9, 3.875719989423703*^9}, {
   3.875720023744266*^9, 3.8757200836177692`*^9}, {3.87572011934797*^9, 
   3.875720188052978*^9}, {3.875720223638438*^9, 3.875720224402527*^9}, {
   3.876199546274818*^9, 3.87619958991718*^9}, {3.8762005183223143`*^9, 
   3.876200531014008*^9}, {3.876200562943416*^9, 3.876200571262085*^9}, {
   3.876200653525708*^9, 3.876200703673315*^9}, {3.87620085949335*^9, 
   3.8762008688634443`*^9}, {3.8762017617851057`*^9, 3.876202438947668*^9}, {
   3.8762025340809603`*^9, 3.8762025400643463`*^9}, {3.87620261709443*^9, 
   3.876202669832224*^9}, {3.8762027197741833`*^9, 3.876202730904736*^9}, {
   3.8762028556244097`*^9, 3.876202927107202*^9}, {3.876203001875944*^9, 
   3.876203043946033*^9}, {3.8762031327067633`*^9, 3.876203148035384*^9}, {
   3.8762032528849792`*^9, 3.876203262675536*^9}, {3.876209233851369*^9, 
   3.876209236504562*^9}, {3.8762112685729303`*^9, 3.876211309596569*^9}, {
   3.876211346880439*^9, 3.876211470947081*^9}, 3.876211731402624*^9, 
   3.876212046401372*^9, 3.8762121612878437`*^9, {3.876212215525592*^9, 
   3.876212247524146*^9}, {3.876212391383792*^9, 3.8762124905947*^9}, 
   3.876212543760313*^9, 3.876212765713426*^9, {3.876212959406522*^9, 
   3.876212959994162*^9}, {3.876213018074327*^9, 3.876213044438684*^9}, 
   3.876213090689808*^9, {3.8762132649719067`*^9, 3.876213276804166*^9}, 
   3.876214214167169*^9, {3.8762142974467373`*^9, 3.876214437745427*^9}, {
   3.876214667689506*^9, 3.876214721049564*^9}, {3.876214760241654*^9, 
   3.8762147721363792`*^9}, {3.876215351659543*^9, 3.876215417140147*^9}, {
   3.876215459066053*^9, 3.8762155730949163`*^9}, {3.876215612514304*^9, 
   3.87621574769133*^9}, 3.876216085475499*^9, {3.876216120107068*^9, 
   3.8762161246353683`*^9}, {3.876216664690085*^9, 3.876216665123727*^9}, {
   3.8762167172075768`*^9, 3.876216734773028*^9}, {3.876217319776656*^9, 
   3.8762173634314747`*^9}, {3.876278663197618*^9, 3.876278663752372*^9}, {
   3.876279664735392*^9, 3.876279675165155*^9}, {3.8762861288801317`*^9, 
   3.87628644839167*^9}, {3.8762969655162487`*^9, 3.876297027238597*^9}, {
   3.876372279038331*^9, 3.8763722834853373`*^9}, {3.876391067642168*^9, 
   3.876391091153441*^9}, {3.876391138881234*^9, 3.876391144434504*^9}, {
   3.876391224655499*^9, 3.876391228491456*^9}, {3.8763912902745333`*^9, 
   3.8763913010295277`*^9}, {3.8763913312444973`*^9, 3.876391350577849*^9}, {
   3.876391438056376*^9, 3.8763915012070007`*^9}, {3.876391578542211*^9, 
   3.8763915811039143`*^9}, {3.876391613774961*^9, 3.8763916138562803`*^9}, {
   3.876391678910523*^9, 3.8763916807994213`*^9}, {3.876391736937585*^9, 
   3.8763918200235233`*^9}, {3.876391873759432*^9, 3.876391893624824*^9}, {
   3.8763919738151417`*^9, 3.876391987899564*^9}, {3.87639211186754*^9, 
   3.87639214124658*^9}, {3.8763949285654497`*^9, 3.876395170928577*^9}, {
   3.876395805331493*^9, 3.876396028796269*^9}, {3.8763960600592833`*^9, 
   3.876396060442668*^9}, {3.876396104472725*^9, 3.876396109291532*^9}, {
   3.876396278380163*^9, 3.876396281581484*^9}, {3.8763963225950413`*^9, 
   3.876396323685813*^9}, {3.8763985818779173`*^9, 3.876398587080241*^9}, {
   3.8764081157731743`*^9, 3.8764081527830763`*^9}},
 CellLabel->
  "In[339]:=",ExpressionUUID->"4f22d022-b777-4da8-bee6-99a5ec583125"],

Cell[BoxData[
 RowBox[{
  RowBox[{"solveSEOM", "[", 
   RowBox[{"s", ",", "x0", ",", "k0", ",", 
    RowBox[{"vF", "=", "1"}], ",", 
    RowBox[{"\[Rho]t", "=", "1"}], ",", 
    RowBox[{"\[Alpha]", "=", 
     RowBox[{"1", "/", "2"}]}], ",", 
    RowBox[{"\[Chi]", "=", 
     RowBox[{"+", "1"}]}]}], "]"}], "//", "AbsoluteTiming"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8753718139163637`*^9, 3.87537248883603*^9}, {
   3.875372521731038*^9, 3.875372598948813*^9}, {3.875372638071093*^9, 
   3.875372667444627*^9}, {3.875372723166608*^9, 3.875372725279752*^9}, {
   3.875372775786047*^9, 3.875372839413402*^9}, {3.87537298938726*^9, 
   3.875372996196085*^9}, {3.875373266701687*^9, 3.875373269475806*^9}, {
   3.8753740342706327`*^9, 3.875374062303205*^9}, {3.875374107478236*^9, 
   3.875374129561631*^9}, {3.8753742235618763`*^9, 3.875374288559656*^9}, {
   3.8753745212889833`*^9, 3.8753745214028177`*^9}, {3.8753745527154493`*^9, 
   3.8753745541002493`*^9}, {3.87537468585247*^9, 3.875374737670253*^9}, {
   3.8753749416599703`*^9, 3.875374942554412*^9}, {3.8753749973764257`*^9, 
   3.8753750783600807`*^9}, {3.875385775677775*^9, 3.8753860496047564`*^9}, {
   3.87538609156984*^9, 3.875386336073556*^9}, {3.8753867452336473`*^9, 
   3.875386763139112*^9}, 3.8753893224917*^9, 3.8753895341269903`*^9, {
   3.8753895909044533`*^9, 3.87538959120335*^9}, {3.875392584653295*^9, 
   3.875392610046296*^9}, {3.87539265307832*^9, 3.8753928085458117`*^9}, {
   3.875392870917982*^9, 3.875393012844138*^9}, {3.8753930547353086`*^9, 
   3.8753932657394238`*^9}, {3.875393308527615*^9, 3.8753934868131733`*^9}, {
   3.875393568798623*^9, 3.875393674799918*^9}, {3.87539373456922*^9, 
   3.875393906421476*^9}, {3.875394055285266*^9, 3.87539410019022*^9}, {
   3.875394147263425*^9, 3.875394218317411*^9}, {3.8754297523229313`*^9, 
   3.875429813412734*^9}, {3.875429913463326*^9, 3.8754299373395357`*^9}, {
   3.875610005315555*^9, 3.875610056741839*^9}, {3.875610418681381*^9, 
   3.875610418744589*^9}, 3.875610631099875*^9, {3.875610931587153*^9, 
   3.875610952400519*^9}, {3.875701282068931*^9, 3.875701335833992*^9}, {
   3.875701390734514*^9, 3.8757014500530787`*^9}, {3.8757014851493073`*^9, 
   3.875701490376498*^9}, {3.875701538720487*^9, 3.8757016382435913`*^9}, {
   3.875701682009058*^9, 3.875701738438554*^9}, {3.875701931633971*^9, 
   3.875702002830406*^9}, {3.875702037280258*^9, 3.875702180350152*^9}, {
   3.875702287017178*^9, 3.875702308255604*^9}, {3.8757175804769773`*^9, 
   3.8757176223524218`*^9}, 3.875717922657584*^9, {3.875719570359198*^9, 
   3.875719680025148*^9}, {3.875719970007078*^9, 3.875719989423703*^9}, {
   3.875720023744266*^9, 3.8757200836177692`*^9}, {3.87572011934797*^9, 
   3.875720188052978*^9}, {3.875720223638438*^9, 3.875720224402527*^9}, {
   3.876199546274818*^9, 3.87619958991718*^9}, {3.8762005183223143`*^9, 
   3.876200531014008*^9}, {3.876200562943416*^9, 3.876200571262085*^9}, {
   3.876200653525708*^9, 3.876200703673315*^9}, {3.87620085949335*^9, 
   3.8762008688634443`*^9}, {3.8762017617851057`*^9, 3.876202438947668*^9}, {
   3.8762025340809603`*^9, 3.8762025400643463`*^9}, {3.87620261709443*^9, 
   3.876202669832224*^9}, {3.8762027197741833`*^9, 3.876202730904736*^9}, {
   3.8762028556244097`*^9, 3.876202927107202*^9}, {3.876203001875944*^9, 
   3.876203043946033*^9}, {3.8762031327067633`*^9, 3.876203148035384*^9}, {
   3.8762032528849792`*^9, 3.876203262675536*^9}, {3.876209233851369*^9, 
   3.876209236504562*^9}, {3.8762112685729303`*^9, 3.876211309596569*^9}, {
   3.876211346880439*^9, 3.876211470947081*^9}, 3.876211731402624*^9, 
   3.876212046401372*^9, 3.8762121612878437`*^9, {3.876212215525592*^9, 
   3.876212247524146*^9}, {3.876212391383792*^9, 3.8762124905947*^9}, 
   3.876212543760313*^9, 3.876212765713426*^9, {3.876212959406522*^9, 
   3.876212959994162*^9}, {3.876213018074327*^9, 3.876213044438684*^9}, 
   3.876213090689808*^9, {3.8762132649719067`*^9, 3.876213276804166*^9}, 
   3.876214214167169*^9, {3.8762142974467373`*^9, 3.876214437745427*^9}, {
   3.876214667689506*^9, 3.876214721049564*^9}, {3.876214760241654*^9, 
   3.8762147721363792`*^9}, {3.876215351659543*^9, 3.876215417140147*^9}, {
   3.876215459066053*^9, 3.8762155730949163`*^9}, {3.876215612514304*^9, 
   3.87621574769133*^9}, 3.876216085475499*^9, {3.876216120107068*^9, 
   3.8762161246353683`*^9}, {3.876216664690085*^9, 3.876216665123727*^9}, {
   3.8762167172075768`*^9, 3.876216734773028*^9}, {3.876217319776656*^9, 
   3.8762173634314747`*^9}, {3.876278663197618*^9, 3.876278663752372*^9}, {
   3.876279664735392*^9, 3.876279675165155*^9}, {3.8762861288801317`*^9, 
   3.87628644839167*^9}, {3.8762969655162487`*^9, 3.876297027238597*^9}, {
   3.876372279038331*^9, 3.8763722834853373`*^9}, {3.876391067642168*^9, 
   3.876391091153441*^9}, {3.876391138881234*^9, 3.876391144434504*^9}, {
   3.876391224655499*^9, 3.876391228491456*^9}, {3.8763912902745333`*^9, 
   3.8763913010295277`*^9}, {3.8763913312444973`*^9, 3.876391350577849*^9}, {
   3.876391438056376*^9, 3.8763915012070007`*^9}, {3.876391578542211*^9, 
   3.8763915811039143`*^9}, {3.876391613774961*^9, 3.8763916138562803`*^9}, {
   3.876391678910523*^9, 3.8763916807994213`*^9}, {3.876391736937585*^9, 
   3.8763918200235233`*^9}, {3.876391873759432*^9, 3.876391893624824*^9}, {
   3.8763919738151417`*^9, 3.876391987899564*^9}, {3.87639211186754*^9, 
   3.87639214124658*^9}, {3.8763949285654497`*^9, 3.876395170928577*^9}, {
   3.876395805331493*^9, 3.876396028796269*^9}, {3.8763960600592833`*^9, 
   3.876396060442668*^9}, {3.876396104472725*^9, 3.876396109291532*^9}, {
   3.876396278380163*^9, 3.876396308989497*^9}, {3.876396702588406*^9, 
   3.876396726764045*^9}, 3.876396768085444*^9, {3.876396839058584*^9, 
   3.876396839140345*^9}, {3.876408097060121*^9, 3.8764081337103148`*^9}},
 CellLabel->
  "In[341]:=",ExpressionUUID->"f2a61410-9d2d-4663-9dde-d0f4096b7917"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plotting", "Subsubsection",
 CellChangeTimes->{{3.876278461749938*^9, 
  3.876278464783457*^9}},ExpressionUUID->"7ef52e73-a8a0-414d-bc87-\
366b20317915"],

Cell[BoxData[{
 RowBox[{"<<", "MaTeX`"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"Plot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"ParametricPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"LogLinearPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"LogLogPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"ListPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"ListLogLinearPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", 
    RowBox[{"ListLogLogPlot", ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "makePlots", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots", "[", 
    RowBox[{"xk_", ",", "\[Rho]t_", ",", "\[Alpha]_", ",", "\[Chi]_", ",", 
     RowBox[{"ti_", ":", 
      RowBox[{"-", "20"}]}], ",", 
     RowBox[{"tf_", ":", "20"}], ",", 
     RowBox[{"print_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "allPlots", ",", "photonSphere", ",", "photonCylinder", ",", "inset", 
       ",", "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", 
       "sPlot", ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ", ",", "t",
        ",", "tpr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"photonSphere", "=", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Sphere", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "#"}], "]"}], 
          "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"\[Rho]t", ",", 
           RowBox[{"\[Rho]t", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
             FractionBox["1", 
              RowBox[{"2", "\[Alpha]"}]]]}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"photonCylinder", "=", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Cylinder", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"xk", "[", "#", "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "&"}], "/@", 
             RowBox[{"{", 
              RowBox[{"ti", ",", "tf"}], "}"}]}], ",", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
            FractionBox["1", 
             RowBox[{"2", "\[Alpha]"}]]]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\[Rho]", "[", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "\[Equal]", "1"}], ",", 
        RowBox[{"inset", "=", "photonSphere"}], ",", 
        RowBox[{"inset", "=", "photonCylinder"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"trajXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot3D", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"AxesLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
             "}"}]}], ",", 
           RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}], ",", 
         RowBox[{"Graphics3D", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"xk", "[", "t", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", "inset", ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{spatial trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajDTXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot3D", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", 
           RowBox[{"AxesLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
             "}"}]}]}], "]"}], ",", 
         RowBox[{"Graphics3D", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{velocity trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajKV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot3D", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", 
           RowBox[{"AxesLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
             "}"}]}]}], "]"}], ",", 
         RowBox[{"Graphics3D", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"xk", "[", "t", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{momentum trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"angMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"xk", "[", "t", "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", "\"\<L_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sPlot", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"spin", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Spin}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", "\"\<s_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"totAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"J", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{Total angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", "\"\<J_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtTotAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"J", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], ",", "tpr"}], "]"}],
            "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of total angular moment}\>\"", 
           "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot J_x\>\"", ",", "\"\<\\\\dot J_y\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtJLSZ", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"spin", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{
                   RowBox[{"xk", "[", "tpr", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"L", "[", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"xk", "[", "tpr", "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"J", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of z-components of $\\\\bf J$, \
$\\\\bf L$ and $\\\\bf S$}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot s_z\>\"", ",", "\"\<\\\\dot L_z\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"allPlots", "=", 
       RowBox[{"{", 
        RowBox[{
        "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", "sPlot",
          ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ"}], "}"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"print", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Print", "[", "#", "]"}], "&"}], "/@", "allPlots"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "allPlots"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQ/WQHg2TWwzeOPB6yxiB6xRZpaxAdxsXtCaIvej/1
AdHPYtKCQPTB+l8RIPqlhl4siD6s8z8RRC+Tz0kF0SrG8lkg+iyLRD6ItmF6
WQKiA7bI1ILoxPz9E0F0i/6yBSBaKlB1FYhmenwYTC8493A9iN51QnAviA76
9PIOiA5kMX8Covn/r1TNBdJCVjPUQbR+Zc+KPCBtbrJ8PYie5ruzvBhkH29D
DYguOVT7dDqQXjPpNZi24TruPxNIP//vFgSiL4l9X7EYSBubtq0B0Qaf/L+D
aI67R3iXAGlbi00yIPrO8RUKILrk/sUSEP3M27AURNub264F0SviDoBp+YXh
x0D0jDNp50C0wpIzhSuBtJ5bZRGI7g581wKiF7CLtIJoAPdu18Y=
  "],
 CellLabel->
  "In[342]:=",ExpressionUUID->"8993ef5f-aa5a-4840-baed-a3ef0d44ff0c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",", "\[Alpha]", ",", 
     "\[Chi]", ",", "ti", ",", "tf", ",", "\[Rho]t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"8", "+", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "5"}], ",", "5"}], "}"}], "]"}]}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762784720225697`*^9, 3.876278680915045*^9}, {
   3.876278744865803*^9, 3.8762788563450117`*^9}, {3.876278887165505*^9, 
   3.87627893119884*^9}, {3.876278983828095*^9, 3.876279017442494*^9}, {
   3.876279055974214*^9, 3.8762790833788633`*^9}, {3.8762791209749928`*^9, 
   3.876279160750586*^9}, {3.8762792072815228`*^9, 3.876279272897011*^9}, {
   3.876279437982346*^9, 3.8762795571933002`*^9}, {3.87627963316615*^9, 
   3.876279638121461*^9}, {3.876279679056473*^9, 3.8762797845557528`*^9}, {
   3.87628003931083*^9, 3.876280097719277*^9}, {3.876284717312385*^9, 
   3.8762847327570887`*^9}, {3.876287812389793*^9, 3.876287869225124*^9}, {
   3.876297661790721*^9, 3.876297700001625*^9}, {3.876372267929987*^9, 
   3.8763722713616543`*^9}, {3.8763751662199993`*^9, 3.876375186218738*^9}, {
   3.8763963597215357`*^9, 3.876396388193994*^9}, {3.876396986498314*^9, 
   3.8763971661519814`*^9}, {3.876397285569365*^9, 3.876397317274397*^9}, {
   3.876397990558527*^9, 3.876398012729558*^9}, 3.8764081584921017`*^9},
 CellLabel->
  "In[352]:=",ExpressionUUID->"07001438-fc15-4819-b89d-bdc34fe5fe08"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"fun", ",", "s"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{"s", ",", "x0", ",", "k0", ",", 
      RowBox[{"vF", "=", "1"}], ",", 
      RowBox[{"\[Rho]t", "=", "1"}], ",", 
      RowBox[{"\[Alpha]", "=", 
       RowBox[{"1", "/", "2"}]}], ",", 
      RowBox[{"\[Chi]", "=", 
       RowBox[{"+", "1"}]}]}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQ/WQHg2TWwzeOPB6yxiB6xRZpaxAdxsXtCaIvej/1
AdHPYtKCQPTB+l8RIPqlhl4siD6s8z8RRC+Tz0kF0SrG8lkg+iyLRD6ItmF6
WQKiA7bI1ILoxPz9E0F0i/6yBSBaKlB1FYhmenwYTC8493A9iN51QnAviA76
9PIOiA5kMX8Covn/r1TNBdJCVjPUQbR+Zc+KPCBtbrJ8PYie5ruzvBhkH29D
DYguOVT7dDqQXjPpNZi24TruPxNIP//vFgSiL4l9X7EYSBubtq0B0Qaf/L+D
aI67R3iXAGlbi00yIPrO8RUKILrk/sUSEH1g/4QKEJ2XWXwBRB+puAimZ92+
n7MSSMv4X88H0T9Pc5WC+RuMwTS3+qwaEH3mrH49iAYAd8TZ+A==
  "],
 CellLabel->
  "In[354]:=",ExpressionUUID->"c1f8ba6c-be24-45f4-8e20-fdef409918cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{"fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]"}], "]"}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQ/WQHg2TWwzeOPB6yxiB6xRZpaxAdxsXtCaIvej/1
AdHPYtKCQPTB+l8RIPqlhl4siD6s8z8RRC+Tz0kF0SrG8lkg+iyLRD6ItmF6
WQKiA7bI1ILoxPz9E0F0i/6yBSBaKlB1FYhmenwYTC8493A9iN51QnAviA76
9PIOiA5kMX8Covn/r1TNBdJCVjPUQbR+Zc+KPCBtbrJ8PYie5ruzvBhkH29D
DYguOVT7dDqQXjPpNZi24TruPxNIP//vFgSiL4l9X7EYSBubtq0B0Qaf/L+D
aI67R3iXAGlbi00yIPrO8RUKILrk/sUSEH1g/4QKEJ2XWXwBRM97cfQiiH7T
xF2yEkgXXpMD0wrbI+tAtMPWcjA9Y8mzVhAtsUGlDUQDAGv/2fc=
  "],
 CellLabel->
  "In[356]:=",ExpressionUUID->"339cc039-9676-4aeb-a571-7f0325e2b968"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "makePlots2D", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "xk", 
   ",", "ti", ",", "tf", ",", "ax1", ",", "ax2", ",", "print", ",", "t"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots2D", "[", 
    RowBox[{"xk_", ",", "\[Rho]t_", ",", "\[Alpha]_", ",", "\[Chi]_", ",", 
     RowBox[{"ti_", ":", 
      RowBox[{"-", "20"}]}], ",", 
     RowBox[{"tf_", ":", "20"}], ",", 
     RowBox[{"ax1_", ":", "1"}], ",", 
     RowBox[{"ax2_", ":", "2"}], ",", 
     RowBox[{"print_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "allPlots", ",", "photonSphere", ",", "photonCylinder", ",", "inset", 
       ",", "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", 
       "sPlot", ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ", ",", "t",
        ",", "tpr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"inset", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ax1", ",", "ax2"}], "}"}], "\[Equal]", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "||", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ax1", ",", "ax2"}], "}"}], "\[Equal]", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}]}], ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Opacity", "[", "0.3", "]"}], ",", 
              RowBox[{"Disk", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}], ",", "#"}], "]"}]}], "}"}], 
            "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{"\[Rho]t", ",", 
             RowBox[{"\[Rho]t", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
               FractionBox["1", 
                RowBox[{"2", "\[Alpha]"}]]]}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"xk", "[", "t", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
              "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}]}]}], "]"}], 
         ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Line", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"xk", "[", "t", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", "inset", ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{spatial trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajDTXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
              "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}]}]}], "]"}], 
         ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Line", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{velocity trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajKV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"xk", "[", "t", "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
              "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}]}]}], "]"}], 
         ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Line", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"xk", "[", "t", "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{momentum trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"angMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"xk", "[", "t", "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", "\"\<L_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sPlot", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"spin", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Spin}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", "\"\<s_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"totAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"J", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{Total angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", "\"\<J_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtTotAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"J", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"xk", "[", "tpr", "]"}]}]}], "]"}], ",", "tpr"}], 
            "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of total angular moment}\>\"", 
           "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot J_x\>\"", ",", "\"\<\\\\dot J_y\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtJLSZ", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"spin", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{
                   RowBox[{"xk", "[", "tpr", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"L", "[", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"xk", "[", "tpr", "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"J", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of z-components of $\\\\bf J$, \
$\\\\bf L$ and $\\\\bf S$}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot s_z\>\"", ",", "\"\<\\\\dot L_z\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"allPlots", "=", 
       RowBox[{"{", 
        RowBox[{
        "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", "sPlot",
          ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ"}], "}"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"print", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Print", "[", "#", "]"}], "&"}], "/@", "allPlots"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "allPlots"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762784720225697`*^9, 3.876278680915045*^9}, {
   3.876278744865803*^9, 3.8762788563450117`*^9}, {3.876278887165505*^9, 
   3.87627893119884*^9}, {3.876278983828095*^9, 3.876279017442494*^9}, {
   3.876279055974214*^9, 3.8762790833788633`*^9}, {3.8762791209749928`*^9, 
   3.876279160750586*^9}, {3.8762792072815228`*^9, 3.876279272897011*^9}, {
   3.876279437982346*^9, 3.8762795571933002`*^9}, {3.87627963316615*^9, 
   3.876279638121461*^9}, {3.876279679056473*^9, 3.8762797845557528`*^9}, {
   3.87628003931083*^9, 3.876280097719277*^9}, {3.876284717312385*^9, 
   3.8762847327570887`*^9}, {3.876287812389793*^9, 3.876287869225124*^9}, {
   3.876297661790721*^9, 3.876297700001625*^9}, {3.876372267929987*^9, 
   3.8763722713616543`*^9}, {3.8763751662199993`*^9, 3.876375186218738*^9}, {
   3.8763963597215357`*^9, 3.876396388193994*^9}, {3.876398046127877*^9, 
   3.876398149609194*^9}, 3.8763982983150873`*^9, {3.87639891238721*^9, 
   3.876398950768055*^9}, {3.876399031203125*^9, 3.8763990910400248`*^9}, {
   3.8764082554715643`*^9, 3.8764082581261997`*^9}, {3.876408375057629*^9, 
   3.876408376131711*^9}, {3.8819064830323563`*^9, 3.8819064831407223`*^9}},
 CellLabel->
  "In[357]:=",ExpressionUUID->"32b1e47c-a4b0-4d8a-9e85-6e3c67104036"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"test", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",", "\[Alpha]", ",", 
     "\[Chi]", ",", "ti", ",", "tf", ",", "\[Rho]t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1.67", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "0"}], "}"}]}], "}"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762784720225697`*^9, 3.876278680915045*^9}, {
   3.876278744865803*^9, 3.8762788563450117`*^9}, {3.876278887165505*^9, 
   3.87627893119884*^9}, {3.876278983828095*^9, 3.876279017442494*^9}, {
   3.876279055974214*^9, 3.8762790833788633`*^9}, {3.8762791209749928`*^9, 
   3.876279160750586*^9}, {3.8762792072815228`*^9, 3.876279272897011*^9}, {
   3.876279437982346*^9, 3.8762795571933002`*^9}, {3.87627963316615*^9, 
   3.876279638121461*^9}, {3.876279679056473*^9, 3.8762797845557528`*^9}, {
   3.87628003931083*^9, 3.876280097719277*^9}, {3.876284717312385*^9, 
   3.8762847327570887`*^9}, {3.876287812389793*^9, 3.876287869225124*^9}, {
   3.876297661790721*^9, 3.876297700001625*^9}, {3.876372267929987*^9, 
   3.8763722713616543`*^9}, {3.8763751662199993`*^9, 3.876375186218738*^9}, {
   3.8763963597215357`*^9, 3.876396388193994*^9}, {3.876396986498314*^9, 
   3.8763971661519814`*^9}, {3.876397285569365*^9, 3.876397317274397*^9}, {
   3.876397990558527*^9, 3.876398012729558*^9}, 3.8764081584921017`*^9, {
   3.876408499992436*^9, 3.876408535411331*^9}, {3.8764086079917583`*^9, 
   3.87640862955829*^9}, {3.876408671780756*^9, 3.8764086807124147`*^9}, {
   3.876408881496044*^9, 3.876408885523188*^9}},
 CellLabel->
  "In[359]:=",ExpressionUUID->"ad230d05-71dc-4410-9588-11c4a3edf72a"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"fun", ",", "s"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{"s", ",", "x0", ",", "k0", ",", 
      RowBox[{"vF", "=", "1"}], ",", 
      RowBox[{"\[Rho]t", "=", "1"}], ",", 
      RowBox[{"\[Alpha]", "=", 
       RowBox[{"1", "/", "2"}]}], ",", 
      RowBox[{"\[Chi]", "=", 
       RowBox[{"+", "1"}]}], ",", 
      RowBox[{"ti", "=", 
       RowBox[{"-", "100"}]}], ",", 
      RowBox[{"tf", "=", "100"}]}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plots", "=", 
    RowBox[{"makePlots2D", "[", 
     RowBox[{
     "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
      "tf", ",", "1", ",", "3", ",", "False"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"plots", "=", 
     RowBox[{"makePlots", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf"}], "]"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"plots", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "400"}]}], "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJwd0E8oQwEABvC1dtBsLYr82ZqVxUEmo4k5KGlCsx3kgNoysWY77MmUhayV
Ukz5N5cV2RsrEoVoYxMlMhfFTLONHk67LC7zvnf4+vWdvvokeovWwGaxWCI6
MHnMKjbGf1p4KpEckoelTbCHm9sOIx2pTvjRN6SFF1N/vZCqrO6HoaqsDm6L
TQZYLhcb4R2nyAKVbIqA3YdCO9RZAi7okG17YIlGugPZiRCj5z6+B09v8s6h
Nk1FoYajSEJB1icdpc1vXKuAsol50kyrqPPuwZWuk3Er9vjTk5C4tKdWaf1L
34xK7rV6nfYz26aFj4UZcpNWXu/0w5q0OgNzXsP8LdrmhgMhjF6TZZB4ixAw
GFi0QfOI9QGGbRFG98ubyUcrVD9Z4O8td4zp+3LGI29iBn45z2bhcCo2B28k
GUYi1roAC/SOZfisim3Ad6Pd42N+tvkgxXPuwlrXYBAK3ANX8B8rWwyn
  "],
 CellLabel->
  "In[361]:=",ExpressionUUID->"ba8d8622-4acf-4c36-b8a8-aa0ed56046f2"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lensing Angle", "Subsubsection",
 CellChangeTimes->{{3.876298694559404*^9, 
  3.876298697801196*^9}},ExpressionUUID->"8a19a71f-2c87-4dfe-acc9-\
c9c236223541"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "lensingAngle", ",", "x0", ",", "k0", ",", "fun", ",", "vF", ",", "rt", ",",
    "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "nti", ",", "ntf", ",", 
   "ti", ",", "tf", ",", "t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lensingAngle", "[", 
    RowBox[{
    "x0_", ",", "k0_", ",", "vF_", ",", "rt_", ",", "\[Alpha]_", ",", 
     "\[Chi]_", ",", "nti_", ",", "ntf_", ",", 
     RowBox[{"check_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "b", ",", "fun", ",", "ti", ",", "tf", ",", "rp", ",", 
       "plots", ",", "closestApproach", ",", "tp", ",", "\[Epsilon]p", ",", 
       "Lzp", ",", "\[Epsilon]diff", ",", "Lzdiff", ",", "\[Epsilon]ts", ",", 
       "Lzts", ",", "xvts", ",", "lensingAngleNumeric", ",", 
       "lensingAngleAnalytic1", ",", "lensingAngleAnalytic2", ",", 
       "lensingPlot"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ti", "=", "nti"}], ";", 
      RowBox[{"tf", "=", "ntf"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
         "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fun", "[", "b_", "]"}], ":=", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"solveSEOM", "[", 
         RowBox[{
         "b", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", "\[Alpha]", 
          ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", "periapsis"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"closestApproach", "[", "b_", "]"}], "=", 
       RowBox[{"NMinimize", "[", 
        RowBox[{
         RowBox[{"norm", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "[", "b", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{";;", "2"}], "]"}], "]"}], "]"}], ",", "b"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rp", "=", 
       RowBox[{"First", "[", 
        RowBox[{"closestApproach", "[", "t", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Print", "[", 
        RowBox[{"ToString", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<Periapsis: `1`\>\"", ",", "\[Rho]p"}], "]"}], "]"}], 
        "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tp", "=", 
       RowBox[{"t", "/.", 
        RowBox[{
         RowBox[{"closestApproach", "[", "t", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]ts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Epsilon]", "[", 
          RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]diff", "=", 
       RowBox[{"Subtract", "@@", "\[Epsilon]ts"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Lzts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Lzdiff", "=", 
       RowBox[{"Subtract", "@@", "Lzts"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"check", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"\[Epsilon]diff", "/", 
              RowBox[{"\[Epsilon]ts", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
            SuperscriptBox["10", 
             RowBox[{"-", "4"}]]}], ",", 
           RowBox[{
           "Print", "[", "\"\<Check conserved quantities.\>\"", "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Lzdiff", "/", 
              RowBox[{"Lzts", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
            SuperscriptBox["10", 
             RowBox[{"-", "4"}]]}], ",", 
           RowBox[{
           "Print", "[", "\"\<Check conserved quantities.\>\"", "]"}]}], 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", 
        RowBox[{"initial", "/", "final"}], " ", "direction", " ", "vector"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"xvts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Normalize", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "'"}], "[", "#", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lensingAngleNumeric", "=", 
       RowBox[{"VectorAngle", "@@", "xvts"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"compare", " ", "to", " ", "analytics"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"lensingAngleAnalytic1", "=", 
       RowBox[{
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"2", 
           RowBox[{"(", 
            RowBox[{"vF", "/", 
             RowBox[{"(", 
              RowBox[{"\[Sqrt]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  FractionBox["1", 
                   SuperscriptBox["rp", "2"]], 
                  RowBox[{"(", 
                   RowBox[{
                    SuperscriptBox["vF", "2"], "-", 
                    SuperscriptBox[
                    RowBox[{"u", "[", 
                    RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "rp"}], 
                    "]"}], "2"]}], ")"}], 
                  SuperscriptBox["r", "4"]}], "-", 
                 RowBox[{
                  SuperscriptBox["r", "2"], 
                  RowBox[{"(", 
                   RowBox[{
                    SuperscriptBox["vF", "2"], "-", 
                    SuperscriptBox[
                    RowBox[{"u", "[", 
                    RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "r"}], 
                    "]"}], "2"]}], ")"}]}]}], ")"}]}], ")"}]}], ")"}]}], ",", 
          
          RowBox[{"{", 
           RowBox[{"r", ",", "rp", ",", "\[Infinity]"}], "}"}]}], "]"}], "-", 
        "\[Pi]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lensingAngleAnalytic2", "=", 
       RowBox[{
        FractionBox[
         SuperscriptBox[
          RowBox[{"u", "[", 
           RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "rp"}], "]"}], "2"], 
         SuperscriptBox["vF", "2"]], 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["r", "2"], "-", 
              RowBox[{
               SuperscriptBox["rp", "2"], " ", 
               SuperscriptBox[
                RowBox[{"(", 
                 FractionBox["rp", "r"], ")"}], 
                RowBox[{"2", "\[Alpha]"}]]}]}], ")"}], 
            RowBox[{
             SuperscriptBox["r", "2"], "-", 
             SuperscriptBox["rp", "2"]}]], 
           FractionBox["rp", 
            RowBox[{"r", 
             SqrtBox[
              RowBox[{
               SuperscriptBox["r", "2"], "-", 
               SuperscriptBox["rp", "2"]}]]}]]}], ",", 
          RowBox[{"{", 
           RowBox[{"r", ",", "rp", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "result", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "rp", ",", "lensingAngleNumeric", ",", "lensingAngleAnalytic1", ",", 
        "lensingAngleAnalytic2", ",", "tp"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762994227929077`*^9, 3.8762994233079433`*^9}, {
   3.876299878318181*^9, 3.876299882582816*^9}, {3.8763004780918617`*^9, 
   3.876300478918247*^9}, {3.8763843794979887`*^9, 3.87638437957813*^9}, {
   3.8763921770034122`*^9, 3.876392223749179*^9}, {3.876399153204296*^9, 
   3.876399166645954*^9}, {3.876399222344988*^9, 3.876399407002287*^9}, 
   3.876399449402663*^9, {3.876399496871484*^9, 3.876399699372666*^9}, {
   3.8763998632833433`*^9, 3.876399907115279*^9}, 3.8764089709763527`*^9, {
   3.87640908826567*^9, 3.876409088538278*^9}, {3.8764131164456043`*^9, 
   3.8764131178854094`*^9}, {3.881910108272146*^9, 3.8819101085009127`*^9}, {
   3.881920838097323*^9, 3.8819208550985947`*^9}},
 CellLabel->
  "In[365]:=",ExpressionUUID->"2eb269a6-aef2-4b4e-8628-13f5f2b3580e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "xv", ",", "kv", ",", "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",",
      "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"3.5", "+", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762994227929077`*^9, 3.8762994233079433`*^9}, {
   3.876299878318181*^9, 3.876299882582816*^9}, {3.8763004780918617`*^9, 
   3.876300478918247*^9}, {3.8763843794979887`*^9, 3.87638437957813*^9}, {
   3.8763921770034122`*^9, 3.876392223749179*^9}, {3.876399153204296*^9, 
   3.876399166645954*^9}, {3.876399222344988*^9, 3.876399407002287*^9}, 
   3.876399449402663*^9, {3.876399496871484*^9, 3.876399699372666*^9}, {
   3.8763998632833433`*^9, 3.876399907115279*^9}, 3.8764089709763527`*^9, {
   3.87640908826567*^9, 3.876409094266225*^9}},
 CellLabel->
  "In[367]:=",ExpressionUUID->"95e1a0c5-c9eb-4ca7-9e7f-3856f08472a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"lensingAngle", "[", 
   RowBox[{"x0", ",", "k0", ",", "1", ",", "1", ",", 
    RowBox[{"1", "/", "2"}], ",", "1", ",", 
    RowBox[{"-", "200"}], ",", "200"}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762994227929077`*^9, 3.8762994233079433`*^9}, {
   3.876299878318181*^9, 3.876299882582816*^9}, {3.8763004780918617`*^9, 
   3.876300478918247*^9}, {3.8763843794979887`*^9, 3.87638437957813*^9}, {
   3.8763921770034122`*^9, 3.876392223749179*^9}, {3.876399153204296*^9, 
   3.876399166645954*^9}, {3.876399222344988*^9, 3.876399407002287*^9}, 
   3.876399449402663*^9, {3.876399496871484*^9, 3.876399699372666*^9}, {
   3.8763998632833433`*^9, 3.876399907115279*^9}, 3.8764089709763527`*^9, {
   3.87640908826567*^9, 3.876409094266225*^9}},
 CellLabel->
  "In[369]:=",ExpressionUUID->"d10d3fd9-6c76-4c1b-8fdf-b51a0e619353"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "lensingAngle2", ",", "x0", ",", "k0", ",", "fun", ",", "vF", ",", "rt", 
   ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "nti", ",", "ntf", 
   ",", "ti", ",", "tf", ",", "t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lensingAngle2", "[", 
    RowBox[{
    "s_", ",", "x0_", ",", "k0_", ",", "vF_", ",", "rt_", ",", "\[Alpha]_", 
     ",", "\[Chi]_", ",", "nti_", ",", "ntf_", ",", 
     RowBox[{"check_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "b", ",", "fun", ",", "ti", ",", "tf", ",", "rp", ",", 
       "plots", ",", "closestApproach", ",", "tp", ",", "\[Epsilon]p", ",", 
       "Lzp", ",", "\[Epsilon]diff", ",", "Lzdiff", ",", "\[Epsilon]ts", ",", 
       "Lzts", ",", "xvts", ",", "lensingAngleNumeric", ",", 
       "lensingAngleAnalytic1", ",", "lensingAngleAnalytic2", ",", 
       "lensingPlot"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ti", "=", "nti"}], ";", 
      RowBox[{"tf", "=", "ntf"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
         "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fun", "[", "b_", "]"}], ":=", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"solveSEOM", "[", 
         RowBox[{
         "b", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", "\[Alpha]", 
          ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", "periapsis"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"closestApproach", "[", "b_", "]"}], "=", 
       RowBox[{"NMinimize", "[", 
        RowBox[{
         RowBox[{"norm", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "[", "b", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{";;", "2"}], "]"}], "]"}], "]"}], ",", "b"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rp", "=", 
       RowBox[{"First", "[", 
        RowBox[{"closestApproach", "[", "t", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Print", "[", 
        RowBox[{"ToString", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<Periapsis: `1`\>\"", ",", "\[Rho]p"}], "]"}], "]"}], 
        "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tp", "=", 
       RowBox[{"t", "/.", 
        RowBox[{
         RowBox[{"closestApproach", "[", "t", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]ts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Epsilon]", "[", 
          RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]diff", "=", 
       RowBox[{"Subtract", "@@", "\[Epsilon]ts"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"check", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"\[Epsilon]diff", "/", 
              RowBox[{"\[Epsilon]ts", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
            SuperscriptBox["10", 
             RowBox[{"-", "4"}]]}], ",", 
           RowBox[{
           "Print", "[", "\"\<Check conserved quantities.\>\"", "]"}]}], 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", 
        RowBox[{"initial", "/", "final"}], " ", "direction", " ", "vector"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"xvts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Normalize", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "'"}], "[", "#", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lensingAngleNumeric", "=", 
       RowBox[{"VectorAngle", "@@", "xvts"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "result", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"tp", ",", "rp", ",", "lensingAngleNumeric", ",", " ", 
        RowBox[{"fun", "[", "s", "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762994227929077`*^9, 3.8762994233079433`*^9}, {
   3.876299878318181*^9, 3.876299882582816*^9}, {3.8763004780918617`*^9, 
   3.876300478918247*^9}, {3.8763843794979887`*^9, 3.87638437957813*^9}, {
   3.8763921770034122`*^9, 3.876392223749179*^9}, {3.876399153204296*^9, 
   3.876399166645954*^9}, {3.876399222344988*^9, 3.876399407002287*^9}, 
   3.876399449402663*^9, {3.876399496871484*^9, 3.876399699372666*^9}, {
   3.8763998632833433`*^9, 3.876399907115279*^9}, 3.8764089709763527`*^9, {
   3.87640908826567*^9, 3.876409088538278*^9}, {3.8764131164456043`*^9, 
   3.8764131178854094`*^9}, {3.881910108272146*^9, 3.8819101085009127`*^9}, {
   3.881920838097323*^9, 3.8819208550985947`*^9}, {3.881981390934716*^9, 
   3.881981402002852*^9}, {3.881981432634756*^9, 3.881981473773736*^9}, {
   3.881981550474517*^9, 3.881981550620781*^9}},
 CellLabel->
  "In[370]:=",ExpressionUUID->"cb85c9b5-7fe9-4532-8127-bd402ce00fed"]
}, Closed]],

Cell[CellGroupData[{

Cell["Transverse Shift", "Subsubsection",
 CellChangeTimes->{{3.8763722398352337`*^9, 
  3.876372243636908*^9}},ExpressionUUID->"5a03dbae-22f6-4134-950d-\
a2d224cabd7f"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "transverseShift", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", 
   "\[Alpha]", ",", "\[Chi]", ",", "nti", ",", "ntf", ",", "t"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"transverseShift", "[", 
    RowBox[{
    "x0_", ",", "k0_", ",", "vF_", ",", "rt_", ",", "\[Alpha]_", ",", 
     "\[Chi]_", ",", "nti_", ",", "ntf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "fun", ",", "f", ",", "xv", ",", "kv", ",", "ti", ",", "tf", ",", "rp", 
       ",", "t", ",", "a", ",", "plots", ",", "closestApproach", ",", "tp", 
       ",", "\[Epsilon]p", ",", "Lzp", ",", "\[Epsilon]diff", ",", "Lzdiff", 
       ",", "\[Epsilon]ts", ",", "Lzts", ",", "xvts", ",", 
       "\[CapitalDelta]zNumeric", ",", "\[CapitalDelta]zAnalytic1", ",", 
       "\[CapitalDelta]zAnalytic2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ti", "=", "nti"}], ";", 
      RowBox[{"tf", "=", "ntf"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
         "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fun", "[", "b_", "]"}], ":=", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"solveSEOM", "[", 
         RowBox[{
         "b", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", "\[Alpha]", 
          ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", "periapsis"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"closestApproach", "[", "b_", "]"}], "=", 
       RowBox[{"NMinimize", "[", 
        RowBox[{
         RowBox[{"norm", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "[", "b", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{";;", "2"}], "]"}], "]"}], "]"}], ",", "b"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rp", "=", 
       RowBox[{"First", "[", 
        RowBox[{"closestApproach", "[", "t", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Print", "[", 
        RowBox[{"ToString", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<Periapsis: `1`\>\"", ",", "\[Rho]p"}], "]"}], "]"}], 
        "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tp", "=", 
       RowBox[{"t", "/.", 
        RowBox[{
         RowBox[{"closestApproach", "[", "t", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]ts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Epsilon]", "[", 
          RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]diff", "=", 
       RowBox[{"Subtract", "@@", "\[Epsilon]ts"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Lzts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Lzdiff", "=", 
       RowBox[{"Subtract", "@@", "Lzts"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"\[Epsilon]diff", "/", 
           RowBox[{"\[Epsilon]ts", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
         SuperscriptBox["10", 
          RowBox[{"-", "4"}]]}], ",", 
        RowBox[{"Print", "[", "\"\<Check if energy conserved.\>\"", "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"Lzdiff", "/", 
           RowBox[{"Lzts", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
         SuperscriptBox["10", 
          RowBox[{"-", "4"}]]}], ",", 
        RowBox[{
        "Print", "[", 
         "\"\<Lz not conserved. Approximation will probably fail.\>\"", 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          RowBox[{"u", "[", 
           RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "rp"}], "]"}], 
          "vF"], ")"}], "2"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]zNumeric", " ", "=", " ", 
       RowBox[{"Subtract", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"tf", ",", "ti"}], "}"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"f", "[", "s_", "]"}], ":=", 
       RowBox[{
        FractionBox[
         SuperscriptBox["s", 
          RowBox[{"1", "-", 
           RowBox[{"2", "\[Alpha]"}]}]], 
         SqrtBox[
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", "a"}], ")"}], 
            SuperscriptBox["s", "2"]}], "-", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"a", " ", 
              SuperscriptBox["s", 
               RowBox[{
                RowBox[{"-", "2"}], "\[Alpha]"}]]}]}], ")"}]}]]], 
        FractionBox[
         RowBox[{"2", "-", 
          RowBox[{"a", " ", 
           SuperscriptBox["s", 
            RowBox[{
             RowBox[{"-", "2"}], "\[Alpha]"}]]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "a"}], ")"}], 
           SuperscriptBox["s", "2"]}]}], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", "a"}], ")"}], 
             SuperscriptBox["s", "2"]}], "+", 
            RowBox[{"a", " ", 
             SuperscriptBox["s", 
              RowBox[{
               RowBox[{"-", "2"}], "\[Alpha]"}]]}]}], ")"}], "2"]]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]zAnalytic1", " ", "=", 
       RowBox[{
        RowBox[{"-", 
         FractionBox[
          RowBox[{"\[Chi]", 
           RowBox[{"(", 
            RowBox[{"1", "+", "\[Alpha]"}], ")"}], "rp", " "}], 
          RowBox[{"Lzts", "[", 
           RowBox[{"[", "1", "]"}], "]"}]]}], "a", 
        SqrtBox[
         RowBox[{"1", "-", "a"}]], 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"f", "[", "s", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"s", ",", "1", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]zAnalytic2", " ", "=", 
       RowBox[{
        RowBox[{"-", 
         FractionBox[
          RowBox[{"\[Chi]", " ", "rp", " "}], 
          RowBox[{"Lzts", "[", 
           RowBox[{"[", "1", "]"}], "]"}]]}], 
        FractionBox[
         RowBox[{" ", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"Gamma", "[", 
            RowBox[{
             FractionBox["1", "2"], "+", "\[Alpha]"}], "]"}]}]}], 
         RowBox[{"2", " ", 
          RowBox[{"Gamma", "[", "\[Alpha]", "]"}]}]], 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["rt", "rp"], ")"}], 
         RowBox[{"2", "\[Alpha]"}]]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "a", ",", "rp", ",", "\[CapitalDelta]zNumeric", ",", 
        "\[CapitalDelta]zAnalytic1", ",", "\[CapitalDelta]zAnalytic2"}], 
       "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8763722583779593`*^9, 3.876372259431946*^9}, {
  3.87639095451457*^9, 3.876390956217579*^9}, {3.8763919439534407`*^9, 
  3.8763919459093246`*^9}, {3.876408944324716*^9, 3.876409113362069*^9}, {
  3.876410096541366*^9, 3.876410134709242*^9}, {3.8764130952135563`*^9, 
  3.876413097110865*^9}},
 CellLabel->
  "In[372]:=",ExpressionUUID->"fe9c22e8-f27d-42e2-b49a-0961909f16b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "xv", ",", "kv", ",", "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",",
      "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"3.5", "+", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8763722583779593`*^9, 3.876372259431946*^9}, {
  3.87639095451457*^9, 3.876390956217579*^9}, {3.8763919439534407`*^9, 
  3.8763919459093246`*^9}, {3.876408944324716*^9, 3.876409115103795*^9}},
 CellLabel->
  "In[374]:=",ExpressionUUID->"335cf137-7340-428e-8052-7ac34a2543da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"transverseShift", "[", 
   RowBox[{"x0", ",", "k0", ",", "1", ",", "1", ",", 
    RowBox[{"1", "/", "2"}], ",", "1", ",", 
    RowBox[{"-", "200"}], ",", "200"}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8763722583779593`*^9, 3.876372259431946*^9}, {
  3.87639095451457*^9, 3.876390956217579*^9}, {3.8763919439534407`*^9, 
  3.8763919459093246`*^9}, {3.876408944324716*^9, 3.876409115103795*^9}},
 CellLabel->
  "In[376]:=",ExpressionUUID->"ee7184fa-6857-44f7-8653-a7c236d8b1f1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Create data table", "Subsubsection",
 CellChangeTimes->{{3.877166261812044*^9, 3.8771662644163303`*^9}, {
  3.877166531376994*^9, 
  3.877166543119869*^9}},ExpressionUUID->"b9d05c5d-92b3-4aa7-ac20-\
4d8106c063a7"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", "ti",
    ",", "tf", ",", "Nt", ",", "createData"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"createData", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Chi]_", ",", "vF_", ",", "\[Rho]t_", ",", "fun_", ",",
     "ti_", ",", "tf_", ",", " ", 
    RowBox[{"Nt_", ":", "201"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "xs", ",", " ", "ks", ",", " ", "ts", ",", "data", ",", "header", ",", 
      "xvs", ",", "rhophizs", ",", "rhovs", ",", "rhos", ",", "phis", ",", 
      "phivs", ",", "hatrhovs", ",", "hatphivs", ",", "vvs", ",", "kvs", ",", 
      "krhos", ",", "kphis", ",", "\[Epsilon]s", ",", "us", ",", "Lzs", ",", 
      "krhosp", ",", "krhosm"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"create", " ", "all", " ", "necessary", " ", "data"}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ts", "=", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{"ti", ",", "tf", ",", 
         FractionBox[
          RowBox[{"tf", "-", "ti"}], "Nt"]}], "]"}], "//", "N"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"ts", ",", "0"}], "]"}]}], ",", 
       RowBox[{"ts", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"ts", ",", "0"}], "]"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"{", 
       RowBox[{"{", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "parameters"}], " ", "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "ts", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<t\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "\[Alpha]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\alpha\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "\[Chi]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\chi\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "vF", "}"}], "&"}], "/@", "ts"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<v_F\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "\[Rho]t", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\rho_t\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "spatial", " ", "coordinates"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"xvs", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fun", "[", "#", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", "xvs", ",", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", " ", "\"\<z\>\""}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rhophizs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"CoordinateTransform", "[", 
         RowBox[{
          RowBox[{"\"\<Cartesian\>\"", "\[Rule]", "\"\<Cylindrical\>\""}], 
          ",", "#"}], "]"}], "&"}], "/@", "xvs"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rhos", "=", 
      RowBox[{"rhophizs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "rhos", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\rho\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"phis", "=", 
      RowBox[{"rhophizs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "phis", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\phi\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"extract", " ", "useful", " ", "vectors"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"rhovs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "*", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0"}], "}"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hatrhovs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Normalize", "[", 
         RowBox[{"rhovs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"{", "hatrhovs", "}"}], "\[Transpose]"}], ",", "2"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"header", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"header", ",", 
          RowBox[{"{", "\"\<\\\\hat\\\\rho\>\"", "}"}]}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"phivs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "\[Cross]", 
           RowBox[{"hatrhovs", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "*", 
         RowBox[{"xvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hatphivs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Normalize", "[", 
         RowBox[{"phivs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"{", "hatphivs", "}"}], "\[Transpose]"}], ",", "2"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"header", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"header", ",", 
          RowBox[{"{", "\"\<\\\\hat\\\\phi\>\"", "}"}]}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "derivatives", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vvs", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"fun", "'"}], "[", "#", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", "vvs", ",", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<\\\\dot x\>\"", ",", "\"\<\\\\dot y\>\"", ",", " ", 
          "\"\<\\\\dot z\>\""}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"fun", "''"}], "[", "#", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<\\\\ddot x\>\"", ",", "\"\<\\\\ddot y\>\"", ",", " ", 
          "\"\<\\\\ddot z\>\""}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "momentum", " ", "coordinates"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"kvs", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fun", "[", "#", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", "kvs", ",", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<k_x\>\"", ",", "\"\<k_y\>\"", ",", " ", "\"\<k_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"project", " ", "onto", " ", "\[Rho]"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"krhos", " ", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"hatrhovs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", 
         RowBox[{"kvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "krhos", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\rho\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"project", " ", "onto", " ", "\[Phi]"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"kphis", " ", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"hatphivs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", 
         RowBox[{"kvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "kphis", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\phi\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"the", " ", "two", " ", 
        SubscriptBox["k", "\[Rho]"], " ", "branches", " ", "from", " ", 
        "\[Epsilon]"}], ",", " ", "Lz", ",", " ", 
       RowBox[{"and", " ", "\[Rho]"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Epsilon]s", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Epsilon]", "[", 
         RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", "ts"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"us", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", "#"}], "]"}], 
        "&"}], "/@", "rhos"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Lzs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"L", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"fun", "[", "#", "]"}]}], "]"}], "[", 
         RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"krhosp", "=", 
      FractionBox[
       RowBox[{
        RowBox[{"\[Epsilon]s", " ", "us"}], "-", 
        FractionBox[
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["us", "2"], 
             SuperscriptBox["vF", "2"]}], "-", 
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["vF", "4"]}], "+", 
            RowBox[{
             SuperscriptBox["\[Epsilon]s", "2"], 
             SuperscriptBox["vF", "2"], 
             SuperscriptBox["rhos", "2"]}]}], ")"}]}], "rhos"]}], 
       RowBox[{
        SuperscriptBox["us", "2"], "-", 
        SuperscriptBox["vF", "2"]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "krhosp", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\rho^{(+)}\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"krhosm", "=", 
      FractionBox[
       RowBox[{
        RowBox[{"\[Epsilon]s", " ", "us"}], "+", 
        FractionBox[
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["us", "2"], 
             SuperscriptBox["vF", "2"]}], "-", 
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["vF", "4"]}], "+", 
            RowBox[{
             SuperscriptBox["\[Epsilon]s", "2"], 
             SuperscriptBox["vF", "2"], 
             SuperscriptBox["rhos", "2"]}]}], ")"}]}], "rhos"]}], 
       RowBox[{
        SuperscriptBox["us", "2"], "-", 
        SuperscriptBox["vF", "2"]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "krhosm", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\rho^{(-)}\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"spin", ",", " ", 
       RowBox[{"angular", " ", "moment"}], ",", " ", 
       RowBox[{
       "total", " ", "angular", " ", "moment", " ", "and", " ", "energy"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"spin", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", "ts"}], 
        ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", " ", "\"\<s_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"L", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", "ts"}], 
        ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", " ", "\"\<L_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"J", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", "ts"}], 
        ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", " ", "\"\<J_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Epsilon]", "[", 
            RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "}"}], "&"}], "/@", 
         "ts"}], ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<E\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"data", ",", " ", "header"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8771662679909277`*^9, 3.877166516592882*^9}},
 CellLabel->
  "In[377]:=",ExpressionUUID->"fe0b4360-e270-4fdc-aaf1-d0efddd3c958"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Case Analysis", "Subsection",
 CellChangeTimes->{{3.876211684824133*^9, 3.876211687491818*^9}, {
  3.876216291171008*^9, 
  3.876216291828706*^9}},ExpressionUUID->"86b1f668-e169-4b17-a61c-\
a53b2d76c76a"],

Cell[CellGroupData[{

Cell[TextData[{
 "Lensing, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["k", "z"], "=", "0"}], TraditionalForm]],ExpressionUUID->
  "2c3d6eaa-5979-4d6a-90ef-1930d9f99632"]
}], "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 
  3.8762128357742043`*^9}},ExpressionUUID->"ddbfbf95-e699-4310-ac22-\
3ca21f7da378"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", "1"}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "40"}]}], ";", 
  RowBox[{"tf", "=", "40"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2.6", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{
       FractionBox["1", 
        SqrtBox["2"]], 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "1"}], ",", "0"}], "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf", ",", "False"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"lensingAngle", "[", 
  RowBox[{
  "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", 
   ",", "ti", ",", "tf"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"transverseShift", "[", 
  RowBox[{
  "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", 
   ",", "ti", ",", "tf"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8764491120973454`*^9, 3.876449143801107*^9}, {
   3.876449195012836*^9, 3.8764492196110764`*^9}, {3.876449251318733*^9, 
   3.876449276944387*^9}, 3.876449334421805*^9, {3.876449491263528*^9, 
   3.87644949954361*^9}, {3.8764495681287403`*^9, 3.876449578655839*^9}, {
   3.8764500274795732`*^9, 3.8764500673474693`*^9}, {3.8764515420809937`*^9, 
   3.876451544241571*^9}, {3.876452202869668*^9, 3.876452210248601*^9}, 
   3.876841014725233*^9},ExpressionUUID->"52a5c363-57b5-4f43-92d6-\
007efce1bc98"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Lensing, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["k", "z"], "\[NotEqual]", "0"}], TraditionalForm]],
  ExpressionUUID->"859b60b3-6239-4b54-b71a-e572ed33bca1"]
}], "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 3.8762128357742043`*^9}, {3.876213556691161*^9, 
  3.876213564069309*^9}},ExpressionUUID->"e400a94b-50e9-4a76-9b3f-\
7b27548d0b58"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "40"}]}], ";", 
  RowBox[{"tf", "=", "40"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "4"}], ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{
       FractionBox["1", 
        SqrtBox["2"]], 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "1"}], "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762141060781384`*^9, 
   3.8762141134561453`*^9}, {3.8762141738660383`*^9, 
   3.8762141745719967`*^9}, {3.8762158004615927`*^9, 3.876215949410845*^9}, 
   3.876216001195833*^9, {3.876216665708499*^9, 3.876216666006266*^9}, 
   3.876279327591407*^9, 3.876409198389716*^9, {3.876409329597155*^9, 
   3.8764093883778763`*^9}, {3.876409451249091*^9, 3.876409477871475*^9}, {
   3.8764097282610493`*^9, 3.876409729126554*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"be4390f1-80cd-4645-8f77-51169d87dec9"]
}, Closed]],

Cell[CellGroupData[{

Cell["Unstable Orbit", "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 3.8762128357742043`*^9}, {3.876213556691161*^9, 
  3.876213564069309*^9}, {3.876213633129332*^9, 
  3.876213635962284*^9}},ExpressionUUID->"99db847d-8409-429b-a999-\
e56108e9aafa"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", "1"}], ";", 
  RowBox[{"ti", "=", "0"}], ";", 
  RowBox[{"tf", "=", "40"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ky0", " ", "=", " ", 
   FractionBox["\[Alpha]", 
    RowBox[{"\[Alpha]", "+", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kx0", "=", 
   FractionBox["ky0", 
    SqrtBox["\[Alpha]"]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Rho]s", "[", 
         RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}], ",", "0", ",", "0"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"kx0", ",", "ky0", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"makePlots", "[", 
     RowBox[{
     "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
      "tf", ",", "False"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", 
   RowBox[{"ViewPoint", "\[Rule]", 
    RowBox[{"{", "Right", "}"}]}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots2D", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762136622150793`*^9, 
   3.876213956159441*^9}, {3.876213997747775*^9, 3.876214017224112*^9}, {
   3.876214088042946*^9, 3.876214091217634*^9}, 3.8762141870554447`*^9, {
   3.876216100615735*^9, 3.8762161090399017`*^9}, {3.876216144689081*^9, 
   3.8762162024980297`*^9}, {3.8762166661576643`*^9, 3.876216667031542*^9}, 
   3.876279345942913*^9, {3.876296990525762*^9, 3.876296998638966*^9}, {
   3.876297052290653*^9, 3.876297053332765*^9}, {3.876409233068941*^9, 
   3.876409320263236*^9}, {3.876409503367268*^9, 3.876409517533741*^9}, {
   3.8764097226920147`*^9, 3.876409723647565*^9}, {3.876452224018977*^9, 
   3.8764523251126432`*^9}, {3.876452556605994*^9, 3.876452665360774*^9}, {
   3.876452699399548*^9, 3.876452742302059*^9}, {3.876452798642294*^9, 
   3.876452830799692*^9}, {3.87645286709803*^9, 3.876452957339101*^9}, 
   3.876453027875021*^9, 3.8764533817271633`*^9, 3.8764534466458178`*^9, {
   3.876840832565462*^9, 3.876840834956294*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"f86fa1e1-9ccf-4d85-b2c6-d98abf7c18f6"]
}, Closed]],

Cell[CellGroupData[{

Cell["Capture", "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 3.8762128357742043`*^9}, {3.876213556691161*^9, 
  3.876213564069309*^9}, {3.876213633129332*^9, 3.876213635962284*^9}, {
  3.876216310132303*^9, 
  3.876216311062275*^9}},ExpressionUUID->"70471d8d-9051-45ec-b1bf-\
98b5dbc06736"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"ti", "=", "0"}], ";", 
  RowBox[{"tf", "=", "10.33"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ky0", " ", "=", " ", 
   FractionBox["\[Alpha]", 
    RowBox[{"\[Alpha]", "+", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kx0", "=", 
   FractionBox["ky0", 
    SqrtBox["\[Alpha]"]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"0.99", 
         RowBox[{"\[Rho]s", "[", 
          RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}]}], ",", "0", ",", "0"}],
        "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"kx0", ",", "ky0", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots2D", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762136622150793`*^9, 
   3.876213956159441*^9}, {3.876213997747775*^9, 3.876214017224112*^9}, {
   3.876214088042946*^9, 3.876214091217634*^9}, 3.8762141870554447`*^9, {
   3.876216100615735*^9, 3.8762161090399017`*^9}, {3.876216144689081*^9, 
   3.8762162024980297`*^9}, {3.876216320204741*^9, 3.876216343544739*^9}, {
   3.876216374749035*^9, 3.8762164285500813`*^9}, {3.876216667163705*^9, 
   3.8762166682316103`*^9}, {3.876217907399022*^9, 3.876217914087459*^9}, 
   3.8762793760226793`*^9, {3.876297077221315*^9, 3.8762971034602947`*^9}, {
   3.876409538964356*^9, 3.876409636710113*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"f61fd84f-76b3-4026-a36f-2db6bd32ce3e"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Numerics vs. Analytic Approximations", "Subsection",
 CellChangeTimes->{{3.876211684824133*^9, 3.876211687491818*^9}, {
  3.876216291171008*^9, 3.876216291828706*^9}, {3.8762804894930477`*^9, 
  3.876280500308955*^9}},ExpressionUUID->"471f9e0e-9fd6-41aa-88e7-\
07f9cf41fd74"],

Cell[CellGroupData[{

Cell["Lensing Angle", "Subsubsection",
 CellChangeTimes->{{3.876283915669186*^9, 
  3.876283919313569*^9}},ExpressionUUID->"4241d1b9-6af5-44b4-8bca-\
4bf29d0c6b6e"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Alpha]s", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "2"}], ",", "1", ",", 
     RowBox[{"3", "/", "2"}], ",", "2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "1000"}]}], ";", 
  RowBox[{"tf", "=", 
   RowBox[{"-", "ti"}]}], ";", 
  RowBox[{"\[Rho]s", "[", 
   RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"xs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"3", "*", 
      SuperscriptBox["10", "x"]}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", "2", ",", "0.05"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"x0k0s", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{
        FractionBox["1", 
         SqrtBox["2"]], 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"-", "1"}], ",", "0"}], "}"}]}]}], "}"}], "&"}], "/@", 
    "xs"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.876284665864373*^9, 3.876284694799404*^9}, {
   3.876284775866069*^9, 3.876284779855748*^9}, {3.876286858362134*^9, 
   3.876286872508885*^9}, {3.876286936534634*^9, 3.876286941167001*^9}, {
   3.876286979736411*^9, 3.876286981688355*^9}, {3.876288202080182*^9, 
   3.87628837772644*^9}, {3.876288486741686*^9, 3.87628854570193*^9}, {
   3.876288764702566*^9, 3.8762888064345217`*^9}, {3.8762897487231417`*^9, 
   3.87628978931619*^9}, {3.876290001850498*^9, 3.876290029483636*^9}, {
   3.8762901021153708`*^9, 3.87629011929996*^9}, {3.876290183202178*^9, 
   3.876290269508654*^9}, {3.876290305600251*^9, 3.876290306524467*^9}, {
   3.876291975745947*^9, 3.876292126773094*^9}, {3.876292244626021*^9, 
   3.87629224532025*^9}, {3.876292399021867*^9, 3.876292470284574*^9}, {
   3.876293262385076*^9, 3.876293265103135*^9}, {3.8762933102603817`*^9, 
   3.8762935585424767`*^9}, {3.876296322589383*^9, 3.876296440543792*^9}, {
   3.876296487027658*^9, 3.8762969468620777`*^9}, {3.87629713735493*^9, 
   3.876297390057485*^9}, {3.8762974410866127`*^9, 3.876297468192031*^9}, {
   3.876297500573731*^9, 3.876297631604609*^9}, {3.87629771640373*^9, 
   3.87629787693121*^9}, {3.876297912235538*^9, 3.8762979162186193`*^9}, {
   3.876298122811596*^9, 3.876298184485957*^9}, {3.876298446574203*^9, 
   3.8762984480491037`*^9}, {3.876298521763873*^9, 3.87629854173988*^9}, {
   3.87629859355158*^9, 3.87629862158324*^9}, {3.8762986645636063`*^9, 
   3.876298685803686*^9}, {3.8762987162478952`*^9, 3.876298838716179*^9}, {
   3.876299035675013*^9, 3.8762990360931463`*^9}, {3.87636890152318*^9, 
   3.87636891486348*^9}, {3.876369047748521*^9, 3.876369052362012*^9}, {
   3.87637059367612*^9, 3.876370593900783*^9}, {3.876371481504348*^9, 
   3.8763715087408667`*^9}, {3.8763719016074266`*^9, 3.876371901992743*^9}, {
   3.876372005853339*^9, 3.876372024151091*^9}, 3.876386553482665*^9, 
   3.876409753748417*^9, {3.876409814183021*^9, 3.8764098204966793`*^9}, {
   3.876409877019351*^9, 3.876409877407442*^9}, 3.8764131948140306`*^9, 
   3.876413723111273*^9, 3.876413774045397*^9},
 CellLabel->
  "In[156]:=",ExpressionUUID->"d47f2d2d-d412-4165-a857-008bf648df85"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "loop", " ", "takes", " ", "a", " ", "minutes", " ", "on", 
    " ", "my", " ", "laptop"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"allLensingAngles", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Monitor", "[", 
    RowBox[{
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"lensingAngles", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"lensingAngle", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "vF", ",", "\[Rho]t", ",", 
             "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], "&"}], 
          "/@", "x0k0s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"allLensingAngles", ",", "lensingAngles"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"\[Alpha]", ",", "\[Alpha]s"}], "}"}]}], "]"}], ",", 
     "\[Alpha]"}], "]"}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdxV1IU2EABuAtApdEqXhTwkabgaCJom7hwmwXUyokj0jmMQTFrspp5h+i
F4XTmIpMO8tFhYFiE2sqOpfNqK0xYYo/sZqKzrklqcxQdNLC+t7v4uG5UKJi
yk7weLw4Au8NyEUP1neuTXS7xdg1HkrA10saLmE9dyO5nDydHZGCzTGRchxV
0Ed/11mbiflh4/SlToUb/8uQ7WLf5Pe/WFojPaki32/gRFi/OROL/0h0epwu
NLzG2TL5B7xX/96ChcNWO1b2/HLgjLqfc9ivNC5jRVqKB6sct+jO1aCxgpxk
+WHFdwXdC7jxqoEuHvX4sTxmOoA1jDO3kuy9KWHw6XzHbXzEztfg9BVm7iF5
6l7kGu7yenw4lmOFVWSOjZfibdfnfNz6VVyEhRfVxZhfpC3FBwX7VZjdbmvC
9c6XWtzyNEyHA8dq+vOjO8P4sO2sGa8VL7ixQstfwv2VlzfwuSGTH2v6k3fw
5tuRXRxxKuoAO03mIP4SaAnh31uu8EfksZ5qCT4Tekz3WYyZHLm3l1Vg736Q
wfpnmjxsf5MWrSPLFq/QX0mSnuDEMZ0ah1eMmnC77RO9I2fShlObh+xYUPhC
aSCLPn7LwoKZVs8gefb8IP0/szt2cw==
  "],
 CellLabel->
  "In[160]:=",ExpressionUUID->"8af3d2f2-481f-4b92-87fc-911d38acc3fe"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"allLensingAngles", "[", 
             RowBox[{"[", 
              RowBox[{"a", ",", ";;", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"allLensingAngles", "[", 
             RowBox[{"[", 
              RowBox[{"a", ",", ";;", ",", "s"}], "]"}], "]"}]}], "}"}], 
          "\[Transpose]"}], ",", 
         RowBox[{"{", 
          RowBox[{"s", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Joined", "\[Rule]", "False"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{
            SuperscriptBox["10", 
             RowBox[{"-", "6"}]], ",", "\[Pi]"}], "}"}]}], "}"}]}], ",", " ", 
       
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"Opacity", "[", 
         RowBox[{"1", "/", "a"}], "]"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\text{periapsis }\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\text{Lensing angle }\\\\varphi\>\""}], "}"}], "]"}]}], ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.87629788303553*^9, 3.876297900689047*^9}, {
  3.876297931928604*^9, 3.8762979934385433`*^9}, {3.876298196309402*^9, 
  3.87629822729698*^9}, {3.876298257482386*^9, 3.876298351437479*^9}, {
  3.876298856387048*^9, 3.876298917843349*^9}, {3.876298968379734*^9, 
  3.8762989857284184`*^9}, {3.8762991176309633`*^9, 3.8762991186630583`*^9}, {
  3.876299154792714*^9, 3.8762991708282547`*^9}, {3.876299221629558*^9, 
  3.87629925054633*^9}, {3.876300987695215*^9, 3.876300991395934*^9}, {
  3.876368764860949*^9, 3.8763687649699574`*^9}, {3.876372480508017*^9, 
  3.876372488696578*^9}, {3.876409889718807*^9, 3.8764098902444887`*^9}},
 CellLabel->
  "In[162]:=",ExpressionUUID->"0583762d-6a2c-4743-829f-49831259bc0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "to", " ", "evaluate", " ", "this", " ", "commented", " ", "cell", " ", 
     "takes", " ", "quite", " ", "some", " ", "time"}], ",", " ", 
    RowBox[{"with", " ", "the", " ", "result", " ", 
     FractionBox[
      RowBox[{
       SqrtBox["\[Pi]"], " ", 
       RowBox[{"Gamma", "[", 
        RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
       RowBox[{"Tan", "[", 
        RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
      RowBox[{"Gamma", "[", 
       RowBox[{
        RowBox[{"-", 
         FractionBox["1", "2"]}], "-", "\[Alpha]"}], "]"}]]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"\[Rho]p", ",", "\[Alpha]"}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"Integrate", "[", 
     RowBox[{
      RowBox[{
       FractionBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Rho]", "2"], "-", 
          RowBox[{
           SuperscriptBox["\[Rho]p", "2"], " ", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["\[Rho]p", "\[Rho]"], ")"}], 
            RowBox[{"2", "\[Alpha]"}]]}]}], ")"}], 
        RowBox[{
         SuperscriptBox["\[Rho]", "2"], "-", 
         SuperscriptBox["\[Rho]p", "2"]}]], 
       FractionBox["\[Rho]p", 
        RowBox[{"\[Rho]", " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox["\[Rho]", "2"], "-", 
           SuperscriptBox["\[Rho]p", "2"]}]]}]]}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Rho]", ",", "\[Rho]p", ",", "\[Infinity]"}], "}"}], ",", 
      RowBox[{"Assumptions", "\[Rule]", 
       RowBox[{
        RowBox[{"\[Rho]p", ">", "0"}], "&&", 
        RowBox[{"\[Alpha]", ">", "0"}]}]}]}], "]"}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.87629034999949*^9, 3.876290373915039*^9}, {
  3.876290416313857*^9, 3.8762904448230257`*^9}, {3.876290500407507*^9, 
  3.876290500685296*^9}, {3.876290675808053*^9, 3.876290682265316*^9}, {
  3.8762913576913033`*^9, 3.876291378440007*^9}, {3.876291809537841*^9, 
  3.87629182992775*^9}, {3.8762923382274647`*^9, 
  3.876292368807871*^9}},ExpressionUUID->"96cd8e0f-a2b3-4cd7-a909-\
e1ef93fabc14"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pf", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Limit", "[", 
      RowBox[{
       FractionBox[
        RowBox[{
         SqrtBox["\[Pi]"], " ", 
         RowBox[{"Gamma", "[", 
          RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
         RowBox[{"Tan", "[", 
          RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
        RowBox[{"Gamma", "[", 
         RowBox[{"-", 
          RowBox[{"(", 
           RowBox[{
            FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]], ",", 
       RowBox[{"\[Alpha]", "\[Rule]", "#"}]}], "]"}], "&"}], "/@", 
    "\[Alpha]s"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   FractionBox[
    RowBox[{
     SqrtBox["\[Pi]"], " ", 
     RowBox[{"Gamma", "[", 
      RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
     RowBox[{"Tan", "[", 
      RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
    RowBox[{"Gamma", "[", 
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{
        FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]], ",", 
   RowBox[{"{", 
    RowBox[{"\[Alpha]", ",", 
     RowBox[{"-", "1"}], ",", "5"}], "}"}], ",", 
   RowBox[{"GridLines", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]s", ",", "pf"}], "}"}]}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\alpha\>\"", ",", 
       "\"\<\\\\sqrt\\\\pi\\\\frac{\\\\Gamma(-\\\\alpha)\\\\tan(\\\\pi\\\\\
alpha)}{\\\\Gamma(-(\\\\alpha+1/2))}\>\""}], "}"}], "]"}]}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.8762915233604393`*^9, 3.876291749738435*^9}, {
  3.8762917909263372`*^9, 3.876291803186165*^9}, {3.8762918937638206`*^9, 
  3.8762919419345703`*^9}, {3.876370584704348*^9, 3.876370585036272*^9}},
 CellLabel->
  "In[163]:=",ExpressionUUID->"25d2edc8-bba5-46cd-b9c0-42e2ba3ad368"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "\[Alpha]", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   FractionBox[
    RowBox[{
     SqrtBox["\[Pi]"], " ", 
     RowBox[{"Gamma", "[", 
      RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
     RowBox[{"Tan", "[", 
      RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
    RowBox[{"Gamma", "[", 
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{
        FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Gamma", "[", 
       RowBox[{"-", "\[Alpha]"}], "]"}], "\[Rule]", " ", 
      FractionBox[
       RowBox[{"\[Pi]", " ", 
        RowBox[{"Csc", "[", 
         RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
       RowBox[{"\[Alpha]", " ", 
        RowBox[{"Gamma", "[", "\[Alpha]", "]"}]}]]}], ",", 
     RowBox[{
      RowBox[{"Gamma", "[", 
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}], "\[Rule]",
       "  ", 
      FractionBox[
       RowBox[{"\[Pi]", " ", 
        RowBox[{"Csc", "[", 
         RowBox[{"\[Pi]", " ", 
          RowBox[{"(", 
           RowBox[{
            FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}], " ", 
        RowBox[{"Gamma", "[", 
         RowBox[{"(", 
          RowBox[{
           FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}], "]"}]}]]}]}], 
    "}"}]}], "//", "FullSimplify"}]}], "Input",
 CellChangeTimes->{{3.876395306436286*^9, 3.876395365540379*^9}},
 CellLabel->
  "In[165]:=",ExpressionUUID->"b57f2315-6a47-4e3b-ae1f-9a8347fb422c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"export", " ", "data", " ", "to", " ", "CSV", " ", "file"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dims", "=", 
     RowBox[{"allLensingAngles", "//", "Dimensions"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"allLensingAnglesMat", "=", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{"allLensingAngles", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"dims", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"dims", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"dims", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"\[Alpha]Column", " ", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"\[Alpha]s", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "\[Alpha]s", "]"}]}], "}"}]}], "]"}], 
        "]"}], "}"}], "\[Transpose]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", "allLensingAnglesMat"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"\[Alpha]Column", ",", "data", ",", "2"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\alpha\>\"", ",", "\"\<\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\varphi from trajectories\>\"", ",", 
       "\"\<\\\\varphi numerical integration\>\"", ",", 
       "\"\<\\\\varphi approx.\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</lensing_angle_chi_`1`_rhot_`2`_vF_`3`.csv\>\"", ",", "\[Chi]", 
         ",", "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", "data"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876369330981982*^9, 3.8763694305095463`*^9}, {
   3.87636993809477*^9, 3.876369953596612*^9}, {3.876370495328301*^9, 
   3.876370556687056*^9}, {3.8763719469979897`*^9, 3.876371986683949*^9}, 
   3.876372063949712*^9, {3.876372117792478*^9, 3.876372120152749*^9}},
 CellLabel->
  "In[167]:=",ExpressionUUID->"7d178f7e-6901-4b9d-a916-d71c597080ed"],

Cell["Export example trajectory", "Text",
 CellChangeTimes->{{3.876413223830183*^9, 
  3.8764132309263144`*^9}},ExpressionUUID->"e94f44fa-0464-4dc8-807f-\
8cdfcc7631a2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ti", "=", 
   RowBox[{"-", "20"}]}], ";", 
  RowBox[{"tf", "=", "20"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{"s", ",", 
     RowBox[{"Sequence", "@@", 
      RowBox[{"x0k0s", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ",", "vF", ",", "\[Rho]t", ",", 
     RowBox[{"\[Alpha]s", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fun", "[", "tf", "]"}], "-", 
  RowBox[{"fun", "[", "ti", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{"fun", ",", "\[Rho]t", ",", 
    RowBox[{"\[Alpha]s", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf", ",",
     "False"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.876413247393074*^9, 3.876413329037723*^9}, {
  3.876413391299411*^9, 3.876413425200783*^9}, {3.876413465407189*^9, 
  3.8764134782279673`*^9}, {3.876413519498755*^9, 3.87641364390934*^9}, {
  3.876413677747101*^9, 3.876413706350423*^9}, {3.8764137494739847`*^9, 
  3.876413759643333*^9}},
 CellLabel->
  "In[1031]:=",ExpressionUUID->"02310316-9c35-41d9-bb69-c3be73d4728d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"makePlots2D", "[", 
   RowBox[{"fun", ",", "\[Rho]t", ",", 
    RowBox[{"\[Alpha]s", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf", ",",
     "1", ",", "2"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.876413247393074*^9, 3.876413329037723*^9}, {
  3.876413391299411*^9, 3.876413425200783*^9}, {3.876413465407189*^9, 
  3.8764134782279673`*^9}, {3.876413519498755*^9, 3.87641364390934*^9}, {
  3.876413677747101*^9, 3.876413706350423*^9}, {3.8764137494739847`*^9, 
  3.8764137498352337`*^9}},ExpressionUUID->"c2b09f99-11c2-4cfc-8f37-\
6265e4d084ea"]
}, Closed]],

Cell[CellGroupData[{

Cell["Transverse Shift", "Subsubsection",
 CellChangeTimes->{{3.876283915669186*^9, 3.876283919313569*^9}, {
  3.87629927162817*^9, 
  3.8762992741305943`*^9}},ExpressionUUID->"7342a176-fb88-4a7e-aa53-\
ccd7ffc4c5c0"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t", ",", "xs", ",", "x0k0s"}], "]"}], "\n", 
 RowBox[{
  RowBox[{"\[Alpha]s", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "2"}], ",", "1", ",", 
     RowBox[{"3", "/", "2"}], ",", "2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "10000"}]}], ";", 
  RowBox[{"tf", "=", 
   RowBox[{"-", "ti"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"3", "*", 
      SuperscriptBox["10", "x"]}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", "2", ",", "0.1"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"x0k0s", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{
        FractionBox["1", 
         SqrtBox["2"]], 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], "&"}], "/@", 
    "xs"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.876299484826909*^9, 3.876299677070499*^9}, {
   3.876299708416728*^9, 3.876299814481843*^9}, {3.876299928394212*^9, 
   3.87630023486406*^9}, {3.876300286371763*^9, 3.876300455224091*^9}, {
   3.876300497651495*^9, 3.876300599018816*^9}, {3.876300633524918*^9, 
   3.876300651838739*^9}, {3.8763007289183273`*^9, 3.876300775961022*^9}, {
   3.876301312797521*^9, 3.8763015146202593`*^9}, {3.876302354665354*^9, 
   3.8763023689243517`*^9}, {3.876302471854248*^9, 3.876302507979559*^9}, {
   3.876368925039076*^9, 3.876368925714225*^9}, {3.876371913175323*^9, 
   3.87637192597616*^9}, {3.876372327692477*^9, 3.876372338532997*^9}, {
   3.87638608260809*^9, 3.876386103933674*^9}, {3.876409960548932*^9, 
   3.8764099842454967`*^9}, 
   3.876421928050329*^9},ExpressionUUID->"0870effe-ba71-4e8d-a338-\
a94599cb3c53"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "loop", " ", "takes", " ", "a", " ", "minutes", " ", "on", 
    " ", "my", " ", "laptop"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"allTransverseShifts", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"transverseShifts", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"transverseShift", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "vF", ",", "\[Rho]t", ",", 
             "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], "&"}], 
          "/@", "x0k0s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"allTransverseShifts", ",", "transverseShifts"}], "]"}], 
        ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"\[Alpha]", ",", "\[Alpha]s"}], "}"}]}], "]"}], ",", 
     "\[Alpha]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876299484826909*^9, 3.876299677070499*^9}, {
   3.876299708416728*^9, 3.876299814481843*^9}, {3.876299928394212*^9, 
   3.87630023486406*^9}, {3.876300286371763*^9, 3.876300455224091*^9}, {
   3.876300497651495*^9, 3.876300599018816*^9}, {3.876300633524918*^9, 
   3.876300651838739*^9}, {3.8763007289183273`*^9, 3.876300775961022*^9}, {
   3.876301312797521*^9, 3.8763015146202593`*^9}, {3.876302354665354*^9, 
   3.8763023689243517`*^9}, {3.876302471854248*^9, 3.876302507979559*^9}, {
   3.876368925039076*^9, 3.876368925714225*^9}, {3.876371913175323*^9, 
   3.87637192597616*^9}, {3.876372327692477*^9, 3.876372338532997*^9}, {
   3.87638608260809*^9, 3.876386103933674*^9}, {3.876409960548932*^9, 
   3.8764099716910048`*^9}, {3.8764100258865623`*^9, 3.876410026409265*^9}, {
   3.876414875651495*^9, 3.876414875842993*^9}, 3.876416481562801*^9},
 CellLabel->
  "In[1148]:=",ExpressionUUID->"86a12c82-eff1-4ff0-aec9-df6d82e127e9"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"allTransverseShifts", "[", 
             RowBox[{"[", 
              RowBox[{"a", ",", ";;", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"allTransverseShifts", "[", 
              RowBox[{"[", 
               RowBox[{"a", ",", ";;", ",", "s"}], "]"}], "]"}]}]}], "}"}], 
          "\[Transpose]"}], ",", 
         RowBox[{"{", 
          RowBox[{"s", ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4", ",", "5"}], "}"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Joined", "\[Rule]", "False"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{
            SuperscriptBox["10", 
             RowBox[{"-", "6"}]], ",", "\[Pi]"}], "}"}]}], "}"}]}]}], "]"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", 
       RowBox[{"Length", "[", "\[Alpha]s", "]"}]}], "}"}]}], "]"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\text{periapsis }\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\text{Transverse shift }\\\\Delta z\>\""}], "}"}], "]"}]}], 
   ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.87629788303553*^9, 3.876297900689047*^9}, {
   3.876297931928604*^9, 3.8762979934385433`*^9}, {3.876298196309402*^9, 
   3.87629822729698*^9}, {3.876298257482386*^9, 3.876298351437479*^9}, {
   3.876298856387048*^9, 3.876298917843349*^9}, {3.876298968379734*^9, 
   3.8762989857284184`*^9}, {3.8762991176309633`*^9, 
   3.8762991186630583`*^9}, {3.876299154792714*^9, 3.8762991708282547`*^9}, {
   3.876299221629558*^9, 3.87629925054633*^9}, {3.876300987695215*^9, 
   3.876300991395934*^9}, {3.876302536703335*^9, 3.876302544882305*^9}, {
   3.8763025763005533`*^9, 3.876302609986615*^9}, {3.8764100394001427`*^9, 
   3.8764100398855762`*^9}, 3.87641669842813*^9},
 CellLabel->
  "In[1794]:=",ExpressionUUID->"5d7730f4-65a9-493b-aa98-8da6183930da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"export", " ", "data", " ", "to", " ", "CSV", " ", "file"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dims", "=", 
     RowBox[{"allTransverseShifts", "//", "Dimensions"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"allTransverseShiftsMat", "=", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{"allTransverseShifts", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"dims", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"dims", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"dims", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"\[Alpha]Column", " ", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"\[Alpha]s", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "\[Alpha]s", "]"}]}], "}"}]}], "]"}], 
        "]"}], "}"}], "\[Transpose]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"data", "=", "allTransverseShiftsMat"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"\[Alpha]Column", ",", "data", ",", "2"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\alpha\>\"", ",", " ", "\"\<a\>\"", ",", 
       "\"\<\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\Delta z from trajectories\>\"", ",", 
       "\"\<\\\\Delta z numerical integration\>\"", ",", 
       "\"\<\\\\Delta z approx.\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</transverse_shift_chi_`1`_rhot_`2`_vF_`3`.csv\>\"", ",", 
         "\[Chi]", ",", "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", "data"}],
     "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876369330981982*^9, 3.8763694305095463`*^9}, {
   3.87636993809477*^9, 3.876369953596612*^9}, {3.876370495328301*^9, 
   3.876370556687056*^9}, {3.8763719469979897`*^9, 3.876371986683949*^9}, 
   3.876372063949712*^9, {3.876372117792478*^9, 3.876372120152749*^9}, {
   3.8763723819586287`*^9, 3.876372448918305*^9}, {3.876372942269519*^9, 
   3.8763729801447783`*^9}, {3.87638029777945*^9, 3.8763802988619432`*^9}, 
   3.876380405400898*^9},
 CellLabel->
  "In[1152]:=",ExpressionUUID->"2f506285-d9ef-4390-a2ff-000ce71b54d0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ti", "=", 
   RowBox[{"-", "30.23605"}]}], ";", 
  RowBox[{"tf", "=", "100"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"\[Alpha]s", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"transverseShift", "[", 
  RowBox[{
   RowBox[{"Sequence", "@@", 
    RowBox[{"x0k0s", "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ",", "vF", ",", "\[Rho]t", ",", 
   "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{"s", ",", 
     RowBox[{"Sequence", "@@", 
      RowBox[{"x0k0s", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ",", "vF", ",", "\[Rho]t", ",", 
     "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"makePlots2D", "[", 
     RowBox[{"fun", ",", "\[Rho]t", ",", 
      RowBox[{"\[Alpha]s", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf", 
      ",", "2", ",", "3", ",", "False"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", 
   RowBox[{"Graphics", "[", 
    RowBox[{"Arrow", "[", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"fun", "[", "ti", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"fun", "[", "tf", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}]}], "}"}], "]"}], 
     "]"}], "]"}], ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NMinimize", "[", 
  RowBox[{
   RowBox[{"norm", "[", 
    RowBox[{
     RowBox[{"fun", "[", "t", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", 
       RowBox[{";;", "2"}]}], "]"}], "]"}], "]"}], ",", "t"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.876416494657523*^9, 3.876416592186308*^9}, {
  3.87641672408426*^9, 3.876416799023837*^9}, {3.876416830041699*^9, 
  3.876416889796095*^9}, {3.876416921729144*^9, 3.8764169274188137`*^9}, {
  3.876421945365592*^9, 3.876421945662862*^9}, {3.876421982745328*^9, 
  3.876421984991989*^9}, {3.8764220303836517`*^9, 3.87642204476996*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"380db273-ef0e-45ac-b297-98c9101f331b"],

Cell[BoxData[
 RowBox[{"fun", "[", "0", "]"}]], "Input",
 CellChangeTimes->{{3.876421959612914*^9, 3.8764219660648203`*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"76b3bdbd-d9b3-47ec-9a44-86a04c64f3ed"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"create", " ", "all", " ", "necessary", " ", "data"}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"ts", ",", "Nt"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Nt", "=", "401"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ts", "=", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"ti", ",", "tf", ",", 
        FractionBox[
         RowBox[{"tf", "-", "ti"}], "Nt"]}], "]"}], "//", "N"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{"MemberQ", "[", 
        RowBox[{"ts", ",", "0"}], "]"}]}], ",", 
      RowBox[{"ts", "=", 
       RowBox[{"Sort", "[", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"ts", ",", "0"}], "]"}], "]"}]}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"add", " ", "parameters"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{"{", "ts", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<t\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "\[Alpha]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<\\\\alpha\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "\[Chi]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<\\\\chi\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "vF", "}"}], "&"}], "/@", "ts"}], ",", "2"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<v_F\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "\[Rho]t", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<\\\\rho_t\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"add", " ", "spatial", " ", "coordinates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"fun", "[", "#", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", " ", "\"\<z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"fun", "'"}], "[", "#", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{
        "\"\<\\\\dot x\>\"", ",", "\"\<\\\\dot y\>\"", ",", " ", 
         "\"\<\\\\dot z\>\""}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"fun", "''"}], "[", "#", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{
        "\"\<\\\\ddot x\>\"", ",", "\"\<\\\\ddot y\>\"", ",", " ", 
         "\"\<\\\\ddot z\>\""}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"add", " ", "momentum", " ", "coordinates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"fun", "[", "#", "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<k_x\>\"", ",", "\"\<k_y\>\"", ",", " ", "\"\<k_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"spin", ",", " ", 
     RowBox[{"angular", " ", "moment"}], ",", " ", 
     RowBox[{
     "total", " ", "angular", " ", "moment", " ", "and", " ", "energy"}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"spin", "[", 
          RowBox[{"\[Chi]", ",", 
           RowBox[{
            RowBox[{"fun", "[", "#", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", "ts"}], ",",
        "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", " ", "\"\<s_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"L", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"fun", "[", "#", "]"}]}], "]"}], "&"}], "/@", "ts"}], ",", 
       "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", " ", "\"\<L_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"J", "[", 
          RowBox[{"\[Chi]", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", "ts"}], 
       ",", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", " ", "\"\<J_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Epsilon]", "[", 
           RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "}"}], "&"}], "/@", 
        "ts"}], ",", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<E\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</transverse_shift_example_chi_`1`.csv\>\"", ",", "\[Chi]", ",", 
         "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", "data"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876214135350264*^9, 3.8762141565470552`*^9}, {3.8762160077046213`*^9, 
   3.8762160078519773`*^9}, {3.876216665273892*^9, 3.876216665559404*^9}, {
   3.876278431039276*^9, 3.87627844491685*^9}, {3.8762792000630083`*^9, 
   3.876279200212097*^9}, {3.876279294801033*^9, 3.876279301047196*^9}, {
   3.876279561623369*^9, 3.876279604254713*^9}, {3.8762801131120443`*^9, 
   3.876280129618326*^9}, {3.876280164523526*^9, 3.876280187106764*^9}, {
   3.876374609467863*^9, 3.876374687513371*^9}, 3.876374978965086*^9, {
   3.876375020809722*^9, 3.876375115849485*^9}, {3.876375230483272*^9, 
   3.876375329044094*^9}, {3.876379341386565*^9, 3.8763793415683393`*^9}, {
   3.8763805655612707`*^9, 3.876380660805534*^9}, {3.8763811433135*^9, 
   3.876381148229204*^9}, {3.87638119011854*^9, 3.8763812194903107`*^9}, {
   3.8763813815607147`*^9, 3.876381381736446*^9}, {3.876381648709656*^9, 
   3.87638165273878*^9}, {3.876382839957404*^9, 3.8763828400478487`*^9}, {
   3.876416941559304*^9, 3.87641700078365*^9}, {3.876418324204833*^9, 
   3.87641832473638*^9}},
 CellLabel->
  "In[1327]:=",ExpressionUUID->"fd9c792f-35ec-48e1-b291-b18da3c1dd50"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lattice Model: Semiclassics linear vs. lattice dispersion ", \
"Subsection",
 CellChangeTimes->{{3.876211684824133*^9, 3.876211687491818*^9}, {
  3.876216291171008*^9, 3.876216291828706*^9}, {3.8762804894930477`*^9, 
  3.876280500308955*^9}, {3.881900940765946*^9, 
  3.88190097127353*^9}},ExpressionUUID->"42be8376-f0f2-4b79-bb81-\
4a8cf0180f54"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"\[Epsilon]", ",", "vF"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Epsilon]", "[", 
   RowBox[{"kx_", ",", "ky_"}], "]"}], "=", 
  RowBox[{"s", " ", 
   FractionBox["vF", "a"], 
   SqrtBox[
    RowBox[{"6", "-", 
     RowBox[{"4", 
      RowBox[{"Cos", "[", 
       RowBox[{"ky", " ", "a"}], "]"}]}], "+", 
     RowBox[{"2", 
      RowBox[{"Cos", "[", 
       RowBox[{"kx", " ", "a"}], "]"}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Cos", "[", 
         RowBox[{"ky", " ", "a"}], "]"}], "-", "2"}], 
       ")"}]}]}]]}]}]}], "Input",
 CellChangeTimes->{{3.881985320817078*^9, 3.8819853758528957`*^9}, {
  3.881985445094502*^9, 3.881985451600972*^9}, {3.8819952150695868`*^9, 
  3.881995215724556*^9}},
 CellLabel->
  "In[379]:=",ExpressionUUID->"30e28d13-0011-4c63-b464-e774bfeff1ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "series", " ", "expansion", " ", "up", " ", "to", " ", "third", " ", 
    "order"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"x0", ",", "vF"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Series", "[", 
     RowBox[{
      RowBox[{"\[Epsilon]", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"kx", "-", "\[Kappa]x"}], ")"}], "t"}], "+", "\[Kappa]x"}],
         ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ky", "-", "\[Kappa]y"}], ")"}], "t"}], "+", 
         "\[Kappa]y"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "0"}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s0", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Normal", "[", "%", "]"}], "/.", 
        RowBox[{"t", "\[Rule]", "1"}]}], "//", "ExpandAll"}], "//", 
      "FullSimplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Series", "[", 
     RowBox[{
      RowBox[{"\[Epsilon]", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"kx", "-", "\[Kappa]x"}], ")"}], "t"}], "+", "\[Kappa]x"}],
         ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ky", "-", "\[Kappa]y"}], ")"}], "t"}], "+", 
         "\[Kappa]y"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "1"}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s1", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Normal", "[", "%", "]"}], "/.", 
        RowBox[{"t", "\[Rule]", "1"}]}], "//", "ExpandAll"}], "//", 
      "FullSimplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Series", "[", 
     RowBox[{
      RowBox[{"\[Epsilon]", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"kx", "-", "\[Kappa]x"}], ")"}], "t"}], "+", "\[Kappa]x"}],
         ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ky", "-", "\[Kappa]y"}], ")"}], "t"}], "+", 
         "\[Kappa]y"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"t", ",", "0", ",", "2"}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s2", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Normal", "[", "%", "]"}], "/.", 
        RowBox[{"t", "\[Rule]", "1"}]}], "//", "ExpandAll"}], "//", 
      "FullSimplify"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8819853914547977`*^9, 3.881985427300664*^9}, {
  3.881985470906649*^9, 3.881985472163711*^9}, {3.88198562889651*^9, 
  3.8819856309327993`*^9}, {3.8819856777978983`*^9, 3.881985678063857*^9}, {
  3.881992144773777*^9, 3.881992146892036*^9}, {3.88200355633563*^9, 
  3.882003587107288*^9}, {3.882003912512475*^9, 3.882003913155272*^9}, {
  3.88200396122075*^9, 3.882003971644752*^9}, {3.882239397009935*^9, 
  3.882239397260404*^9}, {3.882239460558972*^9, 3.88223953732943*^9}, {
  3.882239691478573*^9, 3.8822396960528307`*^9}, {3.8822397536236973`*^9, 
  3.8822397808572197`*^9}, {3.882239955976842*^9, 3.882239975004538*^9}, {
  3.882240131027164*^9, 3.882240131509408*^9}},
 CellLabel->
  "In[381]:=",ExpressionUUID->"8cf2fae8-270e-4a28-a140-485fe0664d0a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Series", "[", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"kx", "-", "\[Kappa]x"}], ")"}], "t"}], "+", "\[Kappa]x"}], 
      ",", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"ky", "-", "\[Kappa]y"}], ")"}], "t"}], "+", "\[Kappa]y"}]}],
      "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "0", ",", "1"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Normal", "[", "%", "]"}], "/.", 
  RowBox[{"t", "\[Rule]", "1"}]}]}], "Input",
 CellChangeTimes->{{3.8822401466003933`*^9, 3.882240220896194*^9}, {
  3.882242125295282*^9, 3.8822421342048264`*^9}},
 CellLabel->
  "In[150]:=",ExpressionUUID->"ea2982b1-e944-4788-9db0-1d011b45637a"],

Cell[BoxData[
 RowBox[{"Limit", "[", 
  RowBox[{
   RowBox[{"%", "/.", 
    RowBox[{"{", 
     RowBox[{"f", "->", "\[Epsilon]"}], "}"}]}], ",", 
   RowBox[{"\[Kappa]x", "->", "0"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.882242035851761*^9, 3.8822421151241693`*^9}, {
  3.882242145575054*^9, 3.8822421477634573`*^9}},
 CellLabel->
  "In[152]:=",ExpressionUUID->"ce42a0d1-3bb3-4363-8fd4-766c194c994f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"s2", "-", "s1", "-", "s0"}], "//", "FullSimplify"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Collect", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"s2", "-", "s1", "-", "s0"}], "//", "FullSimplify"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", "ky"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Collect", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"s1", "-", "s0"}], "//", "FullSimplify"}], ",", 
   RowBox[{"{", 
    RowBox[{"kx", ",", "ky"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8819853914547977`*^9, 3.881985427300664*^9}, {
  3.881985470906649*^9, 3.881985472163711*^9}, {3.88198562889651*^9, 
  3.8819856309327993`*^9}, {3.8819856777978983`*^9, 3.881985678063857*^9}, {
  3.881992144773777*^9, 3.881992146892036*^9}, {3.88200355633563*^9, 
  3.882003587107288*^9}, {3.882003912512475*^9, 3.882003913155272*^9}, {
  3.88200396122075*^9, 3.882003971644752*^9}, {3.882239397009935*^9, 
  3.882239397260404*^9}, {3.882239460558972*^9, 3.88223953732943*^9}, {
  3.882239691478573*^9, 3.8822396960528307`*^9}, {3.8822397536236973`*^9, 
  3.8822397808572197`*^9}, {3.882239955976842*^9, 3.882239983310132*^9}, {
  3.882240058813023*^9, 3.882240067509974*^9}, {3.882240281057274*^9, 
  3.882240292998624*^9}},
 CellLabel->
  "In[153]:=",ExpressionUUID->"61d1ca08-3170-4087-ab99-7ebe59064bec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"veff", "[", 
   RowBox[{"\[Kappa]x_", ",", "\[Kappa]y_"}], "]"}], ":=", 
  RowBox[{
   FractionBox[
    SuperscriptBox["vF", "2"], 
    RowBox[{"a", " ", 
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Kappa]x", ",", "\[Kappa]y"}], "]"}]}]], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{"\[Kappa]x", " ", "a"}], "]"}], 
      RowBox[{"(", 
       RowBox[{"2", "-", 
        RowBox[{"Cos", "[", 
         RowBox[{"\[Kappa]y", " ", "a"}], "]"}]}], ")"}], 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}]}], "+", 
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{"\[Kappa]y", " ", "a"}], "]"}], 
      RowBox[{"(", 
       RowBox[{"2", "-", 
        RowBox[{"Cos", "[", 
         RowBox[{"\[Kappa]x", " ", "a"}], "]"}]}], ")"}], 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"veff2", "[", 
   RowBox[{"\[Kappa]x_", ",", "\[Kappa]y_"}], "]"}], "=", 
  RowBox[{"Evaluate", "@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        SuperscriptBox["\[Epsilon]", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"1", ",", "0"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{"\[Kappa]x", ",", "\[Kappa]y"}], "]"}], ",", 
       RowBox[{
        SuperscriptBox["\[Epsilon]", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"0", ",", "1"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{"\[Kappa]x", ",", "\[Kappa]y"}], "]"}]}], "}"}], "//", 
     "Simplify"}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"veff", "[", 
      RowBox[{"\[Kappa]x", ",", "\[Kappa]y"}], "]"}], "-", 
     RowBox[{"veff2", "[", 
      RowBox[{"\[Kappa]x", ",", "\[Kappa]y"}], "]"}]}], "//", "Simplify"}], 
   ")"}], "/.", 
  RowBox[{"{", 
   RowBox[{
    SuperscriptBox["s", "2"], "->", "1"}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.881986251538787*^9, 3.881986268668193*^9}, {
   3.881986350028244*^9, 3.881986383722217*^9}, {3.881986418718481*^9, 
   3.8819864611251574`*^9}, 3.8819865375529346`*^9, {3.881986575916757*^9, 
   3.881986631927545*^9}, {3.881986701078107*^9, 3.881986701311364*^9}, {
   3.881986754085636*^9, 3.881986780901084*^9}, {3.881986843542645*^9, 
   3.881986863366673*^9}, {3.8819951082040586`*^9, 3.88199512128778*^9}, {
   3.882239570476101*^9, 3.8822395800176077`*^9}, {3.882240383973732*^9, 
   3.882240601382928*^9}, 3.8822406964968224`*^9, {3.882240785390624*^9, 
   3.8822407882348757`*^9}},
 CellLabel->
  "In[156]:=",ExpressionUUID->"1c08b9e1-4ce5-42c6-a9a5-2eb68a53c78c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vp", "=", 
   RowBox[{"StreamPlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Evaluate", "@", 
       RowBox[{"veff2", "[", 
        RowBox[{"\[Kappa]x", ",", "\[Kappa]y"}], "]"}]}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"vF", "\[Rule]", "1"}], ",", 
        RowBox[{"a", "\[Rule]", "1"}], ",", 
        RowBox[{"s", "\[Rule]", "1"}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Kappa]x", ",", 
       RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Kappa]y", ",", 
       RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
     RowBox[{"PlotRangePadding", "\[Rule]", "0"}], ",", 
     RowBox[{"Axes", "\[Rule]", "None"}], ",", 
     RowBox[{"ColorFunction", "\[Rule]", "GrayLevel"}], ",", 
     RowBox[{"StreamMarkers", "\[Rule]", "\"\<Dart\>\""}], ",", 
     RowBox[{"StreamPoints", "\[Rule]", "800"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"cp", "=", 
   RowBox[{"ContourPlot", "[", 
    RowBox[{
     RowBox[{"Evaluate", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"norm", "[", 
         RowBox[{"veff", "[", 
          RowBox[{"\[Kappa]x", ",", "\[Kappa]y"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"vF", "\[Rule]", "1"}], ",", 
          RowBox[{"a", "\[Rule]", "1"}], ",", 
          RowBox[{"s", "\[Rule]", "1"}]}], "}"}]}], ")"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Kappa]x", ",", 
       RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Kappa]y", ",", 
       RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}], ",", 
     RowBox[{"Contours", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0.99", ",", "0.9", ",", "0.8", ",", "0.7"}], "}"}]}], ",", 
     RowBox[{"PlotPoints", "\[Rule]", "100"}], ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
     RowBox[{"PlotRangePadding", "\[Rule]", "0"}], ",", 
     RowBox[{"Axes", "\[Rule]", "None"}], ",", 
     RowBox[{"ColorFunction", "\[Rule]", "GrayLevel"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{"Show", "[", 
  RowBox[{"cp", ",", "vp", ",", 
   RowBox[{"AspectRatio", "\[Rule]", 
    RowBox[{"1", "/", "GoldenRatio"}]}], ",", 
   RowBox[{"FrameStyle", "\[Rule]", "Black"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<\\\\kappa_x\>\"", ",", "\"\<\\\\kappa_y\>\""}], "}"}], 
     "]"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8819871351827993`*^9, 3.8819872759222603`*^9}, {
   3.8819873231424713`*^9, 3.881987431470477*^9}, {3.881987491921061*^9, 
   3.881987537875595*^9}, {3.881987601863017*^9, 3.881987749876279*^9}, {
   3.881987782827093*^9, 3.881987885606483*^9}, {3.88198800902612*^9, 
   3.8819880342541122`*^9}, {3.8819880858229847`*^9, 3.881988088699996*^9}, {
   3.881988326718131*^9, 3.8819884117346*^9}, {3.881988457325388*^9, 
   3.881988480715794*^9}, {3.881988523216097*^9, 3.881988526901239*^9}, {
   3.881988557625564*^9, 3.881988577840988*^9}, {3.881995334199458*^9, 
   3.881995341857855*^9}, 3.882240652290481*^9},
 CellLabel->
  "In[159]:=",ExpressionUUID->"eccefcd8-0462-408d-8534-92c1830c9c74"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"x0", ",", "vF"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Normal", "[", 
     RowBox[{"Series", "[", 
      RowBox[{
       RowBox[{"veff", "[", 
        RowBox[{
         RowBox[{"kx", " ", "t"}], ",", 
         RowBox[{"ky", " ", "t"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "1"}], "}"}]}], "]"}], "]"}], "/.", 
    RowBox[{"t", "\[Rule]", "1"}]}], "//", "ExpandAll"}], "//", 
  "FullSimplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"%", ".", 
   RowBox[{"{", 
    RowBox[{"kx", ",", "ky"}], "}"}]}], "//", "FullSimplify"}]}], "Input",
 CellChangeTimes->{{3.881986280515832*^9, 3.881986295032552*^9}, {
  3.881986899658639*^9, 3.881986903703912*^9}, {3.882005517684122*^9, 
  3.882005519184626*^9}, {3.882005551812848*^9, 3.882005558903268*^9}, {
  3.882244334232628*^9, 3.882244336719994*^9}},
 CellLabel->
  "In[162]:=",ExpressionUUID->"8f664e38-44e6-4017-beb0-93af5306dbf6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"\[CapitalOmega]", ",", "\[Chi]", ",", "v"}], "]"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "set", " ", "Berry", " ", "curvature", " ", "to", " ", "zero", " ", 
    "here"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[CapitalOmega]", "[", 
     RowBox[{"\[Chi]_", ",", "v_"}], "]"}], ":=", 
    RowBox[{"0", 
     FractionBox["\[Chi]", "2"], " ", 
     FractionBox["v", 
      SuperscriptBox[
       RowBox[{"norm", "[", "v", "]"}], "3"]]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "the", " ", "old", " ", "results", " ", "have", " ", "a", " ", "wrong", 
    " ", "factor", " ", "2"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalOmega]", "[", 
      RowBox[{"\[Chi]_", ",", "v_"}], "]"}], ":=", 
     RowBox[{"2", 
      FractionBox["\[Chi]", "2"], " ", 
      FractionBox["v", 
       SuperscriptBox[
        RowBox[{"norm", "[", "v", "]"}], "3"]]}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
     ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
     "tf", ",", "\[Rho]t"}], "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"lattice", " ", "dispersion"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "\[Epsilon]latt", ",", "\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", 
    "ks"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Epsilon]latt", "[", 
     RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"uv", "[", 
       RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
        RowBox[{"\[Rho]", "[", "xs", "]"}]}], "]"}], ".", 
      RowBox[{"Sin", "[", 
       RowBox[{"\[Rho]", "[", "ks", "]"}], "]"}]}], "+", 
     RowBox[{"vF", "*", 
      SqrtBox[
       RowBox[{"6", "-", 
        RowBox[{"4", 
         RowBox[{"Cos", "[", 
          RowBox[{"ks", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "+", 
        RowBox[{"2", 
         RowBox[{"Cos", "[", 
          RowBox[{"ks", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"ks", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "2"}], 
          ")"}]}]}]]}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"linear", " ", "isotropic", " ", "dispersion"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "\[Epsilon]lin", ",", "\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", 
    "ks"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Epsilon]lin", "[", 
     RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"uv", "[", 
       RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
        RowBox[{"\[Rho]", "[", "xs", "]"}]}], "]"}], ".", 
      RowBox[{"\[Rho]", "[", "ks", "]"}]}], "+", 
     RowBox[{"vF", "*", 
      RowBox[{"norm", "[", 
       RowBox[{"\[Rho]", "[", "ks", "]"}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"set", " ", "dispersion"}], " ", "==", " ", "lattice"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "\[Epsilon]", ",", "\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", 
    "ks"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Epsilon]", "[", 
    RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
    "]"}], ":=", 
   RowBox[{"\[Epsilon]latt", "[", 
    RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"vFs", ",", "vg"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vFs", "[", 
    RowBox[{"s_", ",", "f_", ",", "\[Epsilon]_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Grad", "[", 
     RowBox[{
      RowBox[{"\[Epsilon]", "[", 
       RowBox[{"\[Alpha]", ",", "vF", ",", "0", ",", 
        RowBox[{
         RowBox[{"f", "[", "s", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"kx", "\[Rule]", 
       RowBox[{
        RowBox[{"f", "[", "s", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"4", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
      RowBox[{"ky", "\[Rule]", 
       RowBox[{
        RowBox[{"f", "[", "s", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"4", ",", "2", ",", "2"}], "]"}], "]"}]}], ",", 
      RowBox[{"kz", "\[Rule]", 
       RowBox[{
        RowBox[{"f", "[", "s", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"4", ",", "2", ",", "3"}], "]"}], "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"vg", "[", 
     RowBox[{"s_", ",", "f_", ",", "\[Epsilon]_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Grad", "[", 
      RowBox[{
       RowBox[{"\[Epsilon]", "[", 
        RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", 
         RowBox[{
          RowBox[{"f", "[", "s", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"4", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"kx", "\[Rule]", 
        RowBox[{
         RowBox[{"f", "[", "s", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"ky", "\[Rule]", 
        RowBox[{
         RowBox[{"f", "[", "s", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "2", ",", "2"}], "]"}], "]"}]}], ",", 
       RowBox[{"kz", "\[Rule]", 
        RowBox[{
         RowBox[{"f", "[", "s", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"4", ",", "2", ",", "3"}], "]"}], "]"}]}]}], "}"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"enes", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "0.01", ",", "0.05", ",", "0.1", ",", " ", "0.2", ",", " ", "0.3", ",", 
     "0.4", ",", "0.5", ",", " ", "0.6", ",", "0.7", ",", " ", "0.8", ",", 
     " ", "0.9"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "110"}], ";", 
  RowBox[{"\[Alpha]", "=", "0.5"}], ";", 
  RowBox[{"\[Chi]", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataEnes", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k0s", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"x0", "=", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"-", "250"}], ",", "0"}], "}"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"old", " ", "picture"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"x0", "=", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"-", "260"}], ",", "0"}], "}"}]}], ";", " ", 
       RowBox[{"(*", " ", "capture", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"ksol", "=", 
        RowBox[{"Last", "[", 
         RowBox[{"Sort", "[", 
          RowBox[{
           RowBox[{"kx", "/.", 
            RowBox[{"Quiet", "[", 
             RowBox[{"Solve", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"\[Epsilon]latt", "[", 
                 RowBox[{
                 "\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", "x0", ",", 
                  RowBox[{"{", 
                   RowBox[{"kx", ",", "0", ",", "0"}], "}"}]}], "]"}], 
                "\[Equal]", "ene"}], ",", "kx"}], "]"}], "]"}]}], "//", "N"}],
           "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"k0", "=", 
        RowBox[{"{", 
         RowBox[{"ksol", ",", "0", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"k0s", ",", " ", 
         RowBox[{"{", "k0", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ti", "=", 
        RowBox[{"5", "*", 
         RowBox[{"x0", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
       RowBox[{"tf", "=", 
        RowBox[{
         RowBox[{"-", "3"}], "*", "ti"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
          "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Clear", "[", "fun1", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"fun1", "[", "s_", "]"}], "=", 
        RowBox[{"solveSEOM", "[", 
         RowBox[{
         "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", 
          "\[Alpha]", ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"data1", ",", "header1"}], "}"}], "=", 
        RowBox[{"createData", "[", 
         RowBox[{
         "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun1", 
          ",", "ti", ",", "tf", ",", "401"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"dataEnes", ",", "data1"}], "]"}], ";"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"ene", ",", "enes"}], "}"}]}], "]"}], ",", "ene"}], "]"}], 
  "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"set", " ", "dispersion"}], " ", "==", " ", "linearized"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", 
  RowBox[{"\[Epsilon]", ",", "rt", ",", "xs", ",", "ks"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Epsilon]", "[", 
     RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
     "]"}], ":=", 
    RowBox[{"\[Epsilon]lin", "[", 
     RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k0", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "0", ",", 
     RowBox[{"-", "1"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "fun2", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tf", "=", "660.522"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"tf", "=", 
     RowBox[{"-", "ti"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun2", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{
    "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
     ",", 
     RowBox[{"\[Chi]", "=", 
      RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"data2", ",", "header2"}], "}"}], "=", 
   RowBox[{"createData", "[", 
    RowBox[{
    "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun2", ",", 
     "ti", ",", "tf", ",", "401"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"dataEnes", ",", "data2"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p2", "=", 
   RowBox[{"ParametricPlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"fun2", "[", "t", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", 
        RowBox[{";;", "2"}]}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "tf"}], "}"}], ",", 
     RowBox[{"PlotStyle", "->", "Black"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"dataEnes", "[", 
    RowBox[{"[", 
     RowBox[{";;", ",", ";;", ",", 
      RowBox[{"6", ";;", "7"}]}], "]"}], "]"}], ",", 
   RowBox[{"Joined", "->", "True"}], ",", 
   RowBox[{"PlotRange", "->", 
    RowBox[{"10", "\[Rho]t", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}]}], ",", 
   RowBox[{"AspectRatio", "->", "1"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathOut", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"pathOut", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"StringForm", "[", 
       RowBox[{
       "\"\<capture_high_energies.csv\>\"", ",", "\[Chi]", ",", "\[Rho]t", 
        ",", "vF"}], "]"}], "]"}]}], ",", 
    RowBox[{"Prepend", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"dataEnes", ",", "1"}], "]"}], ",", "header2"}], "]"}]}], 
   "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762141060781384`*^9, 
   3.8762141134561453`*^9}, {3.8762141738660383`*^9, 
   3.8762141745719967`*^9}, {3.8762158004615927`*^9, 3.876215949410845*^9}, 
   3.876216001195833*^9, {3.876216665708499*^9, 3.876216666006266*^9}, 
   3.876279327591407*^9, 3.876409198389716*^9, {3.876409329597155*^9, 
   3.8764093883778763`*^9}, {3.876409451249091*^9, 3.876409477871475*^9}, {
   3.8764097282610493`*^9, 3.876409729126554*^9}, {3.881901056974374*^9, 
   3.8819010918162737`*^9}, {3.881901901478554*^9, 3.881901923966177*^9}, {
   3.881902046915411*^9, 3.88190209655989*^9}, {3.881902603332513*^9, 
   3.881902620142847*^9}, {3.881902736538953*^9, 3.8819027552948837`*^9}, {
   3.881902802757206*^9, 3.8819028104105253`*^9}, {3.881902849575664*^9, 
   3.8819028775582933`*^9}, {3.881902929875951*^9, 3.8819029955093412`*^9}, {
   3.881903041662242*^9, 3.881903050538712*^9}, {3.8819030805478354`*^9, 
   3.881903142394868*^9}, {3.881903211583119*^9, 3.881903247152931*^9}, {
   3.8819033139511127`*^9, 3.881903322389565*^9}, {3.881903375485978*^9, 
   3.881903375713231*^9}, {3.8819034369705553`*^9, 3.881903475139368*^9}, {
   3.881903505171379*^9, 3.881903505422605*^9}, {3.881903562336643*^9, 
   3.881903572968026*^9}, {3.881903768944336*^9, 3.881903787966866*^9}, {
   3.8819038350509853`*^9, 3.881903949976248*^9}, {3.881903995837186*^9, 
   3.8819040456500874`*^9}, {3.881904127768319*^9, 3.881904163176784*^9}, {
   3.881904230314434*^9, 3.881904258956979*^9}, {3.881904312813139*^9, 
   3.88190443874037*^9}, {3.881904514632134*^9, 3.881904599833557*^9}, {
   3.88190477759161*^9, 3.881904883410282*^9}, {3.88190492689888*^9, 
   3.881904931638043*^9}, {3.881905200781115*^9, 3.8819052118007803`*^9}, {
   3.881905268325974*^9, 3.881905268689443*^9}, {3.881905349425519*^9, 
   3.881905406553729*^9}, {3.88190580941253*^9, 3.881905810957035*^9}, {
   3.881905844792428*^9, 3.8819058618283777`*^9}, {3.88190589360467*^9, 
   3.881905977819755*^9}, {3.8819060158989153`*^9, 3.881906019975823*^9}, {
   3.881906068300147*^9, 3.8819060684051533`*^9}, {3.881906119755988*^9, 
   3.881906339758581*^9}, {3.8819067256527767`*^9, 3.88190678097964*^9}, {
   3.881906836003559*^9, 3.881906856836523*^9}, {3.881906887740369*^9, 
   3.88190692768757*^9}, {3.881906958770376*^9, 3.881907048132303*^9}, {
   3.881907103079173*^9, 3.881907104325692*^9}, {3.881907162983317*^9, 
   3.881907194603447*^9}, {3.881907247187056*^9, 3.8819074495159273`*^9}, {
   3.881907499535563*^9, 3.881907567669812*^9}, {3.8819076306246853`*^9, 
   3.881907924872568*^9}, {3.881907955751528*^9, 3.881908143670786*^9}, {
   3.881908176735868*^9, 3.881908246597876*^9}, {3.881908294651113*^9, 
   3.881908316744555*^9}, {3.881908795001903*^9, 3.881908795161745*^9}, {
   3.881908840067164*^9, 3.88190890933834*^9}, {3.881908943089808*^9, 
   3.881908965923357*^9}, {3.8819090089112253`*^9, 3.881909010122513*^9}, {
   3.881909064092095*^9, 3.8819090713128633`*^9}, {3.881909131918374*^9, 
   3.881909139521057*^9}, {3.8819092141648607`*^9, 3.881909269604308*^9}, {
   3.881909301835094*^9, 3.8819093032163477`*^9}, 3.88190956742045*^9, {
   3.8819096582577457`*^9, 3.881909661239786*^9}, {3.881909957661458*^9, 
   3.881910016784719*^9}, {3.881910126663623*^9, 3.8819101609102716`*^9}, {
   3.881910210902976*^9, 3.8819102116220427`*^9}, {3.88191032070268*^9, 
   3.8819103558519487`*^9}, {3.881910493389123*^9, 3.8819106629723186`*^9}, {
   3.881910707573369*^9, 3.88191075474996*^9}, {3.881910785252969*^9, 
   3.881911115633861*^9}, {3.881911547555263*^9, 3.881911554960505*^9}, {
   3.881911750984448*^9, 3.881911831193665*^9}, {3.881911862084404*^9, 
   3.881912091438858*^9}, {3.8819121693032207`*^9, 3.881912295519001*^9}, {
   3.881913512872156*^9, 3.881913554757807*^9}, {3.881913597902185*^9, 
   3.881913597977859*^9}, {3.8819137446998863`*^9, 3.881913744960554*^9}, {
   3.881913788772895*^9, 3.88191391401978*^9}, 3.881914004008996*^9, {
   3.881914051840798*^9, 3.881914086331894*^9}, {3.881914116415846*^9, 
   3.8819141721134443`*^9}, {3.88191423178434*^9, 3.8819142318824368`*^9}, {
   3.8819142645670757`*^9, 3.881914327734007*^9}, {3.881914357785511*^9, 
   3.881914358192182*^9}, {3.881914475008327*^9, 3.881914515838744*^9}, {
   3.8819145709234457`*^9, 3.8819145709931803`*^9}, {3.8819146172440853`*^9, 
   3.881914675191196*^9}, {3.881914729516918*^9, 3.881914754076757*^9}, {
   3.881916603125491*^9, 3.881916617300716*^9}, {3.881916661234671*^9, 
   3.881916691786353*^9}, {3.8819167265997267`*^9, 3.881916748587042*^9}, {
   3.881916785457983*^9, 3.881916845595028*^9}, {3.8819200820540123`*^9, 
   3.881920112016053*^9}, {3.881920148246869*^9, 3.8819202455868683`*^9}, {
   3.881920285500657*^9, 3.881920418060204*^9}, {3.881920452320704*^9, 
   3.881920507476797*^9}, {3.881920549874585*^9, 3.881920624647819*^9}, {
   3.881921829211673*^9, 3.881921926064536*^9}, {3.8819219737787027`*^9, 
   3.881921996520525*^9}, {3.881922027575631*^9, 3.881922044667472*^9}, {
   3.881924882662936*^9, 3.88192493210174*^9}, {3.881926501745393*^9, 
   3.881926562507538*^9}, {3.881926786242402*^9, 3.8819267870424843`*^9}, {
   3.881926818757985*^9, 3.881926819022996*^9}, {3.881926867896449*^9, 
   3.8819268680556803`*^9}, {3.881926964623786*^9, 3.881926964950294*^9}, {
   3.881927007480858*^9, 3.8819270597433*^9}, 3.88198148494874*^9, {
   3.881995352336216*^9, 3.88199536381464*^9}, {3.8819954914566097`*^9, 
   3.881995501431489*^9}, {3.881995539133196*^9, 3.881995623617433*^9}, {
   3.881995780061851*^9, 3.881995780417931*^9}, {3.881995834404419*^9, 
   3.881995837074552*^9}, {3.8819959177861853`*^9, 3.8819959594965153`*^9}, {
   3.881996004067731*^9, 3.88199601882484*^9}, {3.881996142729199*^9, 
   3.881996156600299*^9}, 3.881996258291658*^9, 3.88223821724745*^9, {
   3.8822382778971987`*^9, 3.882238277964046*^9}, {3.882238344377306*^9, 
   3.882238470560979*^9}, 3.882238623068103*^9, {3.882257540154585*^9, 
   3.882257943057908*^9}, {3.882258015178336*^9, 3.882258109811799*^9}, {
   3.882259373967779*^9, 3.882259447078539*^9}, {3.882259524466938*^9, 
   3.882259548054637*^9}, {3.882259600369318*^9, 3.88225966739915*^9}, {
   3.8822599704307537`*^9, 3.8822599730545483`*^9}, {3.8822600867938337`*^9, 
   3.882260119352291*^9}, {3.8822602131056147`*^9, 3.882260276199382*^9}, {
   3.8822603095417213`*^9, 3.882260430503256*^9}, {3.882260466159988*^9, 
   3.882260466315566*^9}, {3.882260547181055*^9, 3.8822605602000713`*^9}, {
   3.88226066366742*^9, 3.882260703670741*^9}, {3.882260740468397*^9, 
   3.8822607664529257`*^9}, 3.882260806829262*^9, {3.882260844403957*^9, 
   3.882260901756311*^9}, {3.882260933233158*^9, 3.88226095025743*^9}, {
   3.8822625615794897`*^9, 3.882262633204544*^9}, {3.8822628227654133`*^9, 
   3.882262830263443*^9}, {3.882262895445386*^9, 3.882263042930863*^9}, {
   3.882263075484913*^9, 3.882263101333313*^9}, {3.882263133395121*^9, 
   3.882263229337171*^9}, {3.8822633004340687`*^9, 3.882263407204452*^9}, {
   3.882263452117469*^9, 3.8822634538462467`*^9}, {3.8822635221796207`*^9, 
   3.882263524138276*^9}, {3.8822635637376204`*^9, 3.882263645316155*^9}, {
   3.8822636793180113`*^9, 3.882263679611561*^9}, {3.882263730630184*^9, 
   3.88226373839065*^9}, {3.882263773689423*^9, 3.882263914571045*^9}, {
   3.882263965017301*^9, 3.882263976640519*^9}, 3.882264072774104*^9, 
   3.88226432079954*^9, {3.8822645129008636`*^9, 3.882264542689435*^9}, {
   3.882264584850412*^9, 3.882264687045766*^9}, {3.8822648370365553`*^9, 
   3.8822649321659813`*^9}, {3.8822650343679447`*^9, 3.882265035209207*^9}, {
   3.882265131743824*^9, 3.882265131958418*^9}, {3.882265188308275*^9, 
   3.882265216772401*^9}, {3.882265257310834*^9, 3.882265280777029*^9}, {
   3.882265321264711*^9, 3.8822654237690983`*^9}, {3.882265456443561*^9, 
   3.8822654568916492`*^9}, {3.882265501055389*^9, 3.8822655185318127`*^9}, {
   3.882265569952997*^9, 3.88226557355175*^9}, {3.882265608981833*^9, 
   3.882265609057268*^9}, 3.8822656484618464`*^9, {3.882265694278076*^9, 
   3.882265703159645*^9}, {3.8822657474194717`*^9, 3.882265759151025*^9}, 
   3.882265961111693*^9, {3.88226605739437*^9, 3.882266060112731*^9}, {
   3.882266235607782*^9, 3.882266242737536*^9}, {3.882266300177924*^9, 
   3.882266329672509*^9}, {3.882266365031537*^9, 3.882266368119079*^9}, {
   3.8822664146652317`*^9, 3.88226641517036*^9}, {3.8822664474093103`*^9, 
   3.8822664476622877`*^9}, {3.882266496151195*^9, 3.882266499898877*^9}, 
   3.882266607107449*^9, {3.882266712777132*^9, 3.882266716189324*^9}, {
   3.882266790843402*^9, 3.882266791837586*^9}, {3.882266842008401*^9, 
   3.8822668426117563`*^9}, {3.88226688524757*^9, 3.882266921791926*^9}, {
   3.8823323540671577`*^9, 3.882332356029622*^9}, {3.882332612172203*^9, 
   3.882332621821596*^9}, {3.882332665789604*^9, 3.882332698120332*^9}, {
   3.882332753853593*^9, 3.8823327544396563`*^9}, {3.882332867455467*^9, 
   3.88233286764585*^9}, {3.882332961354333*^9, 3.882332961717926*^9}, {
   3.882334334887635*^9, 3.88233435416216*^9}, {3.882342204538106*^9, 
   3.882342226019148*^9}, {3.882343558962082*^9, 3.882343559412407*^9}, 
   3.8823435910930567`*^9, {3.882343643696096*^9, 3.882343651816132*^9}, {
   3.88234452098842*^9, 3.882344560633871*^9}, {3.882344598816772*^9, 
   3.8823445989033623`*^9}, {3.882344735767336*^9, 3.882344736600245*^9}, {
   3.8823450144511633`*^9, 3.8823450149231367`*^9}, {3.8823450764126377`*^9, 
   3.882345269081251*^9}, {3.882345339931519*^9, 3.882345340199741*^9}, {
   3.882345431600835*^9, 3.882345432341463*^9}, {3.8823455803625402`*^9, 
   3.882345582166814*^9}, 3.882346098834676*^9, {3.882348729925448*^9, 
   3.8823487795844584`*^9}, {3.882349781033927*^9, 3.882349846011146*^9}, {
   3.882350004078021*^9, 3.882350021965763*^9}, {3.882350455437377*^9, 
   3.882350457401009*^9}, {3.882352983740135*^9, 3.882352983911767*^9}, {
   3.882353740920904*^9, 3.882353754910584*^9}},
 CellLabel->
  "In[2989]:=",ExpressionUUID->"9e92da8b-3a6f-4232-80ad-4aac9522e175"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"set", " ", "dispersion"}], " ", "==", " ", "lattice"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"\[Epsilon]", ",", "rt", ",", "xs", ",", "ks"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{"\[Epsilon]latt", "[", 
      RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dataEnes", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0s", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"x0", "=", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "800"}], ",", "0"}], "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"weak", " ", "lensing"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ksol", "=", 
         RowBox[{"Last", "[", 
          RowBox[{"Sort", "[", 
           RowBox[{
            RowBox[{"kx", "/.", 
             RowBox[{"Quiet", "[", 
              RowBox[{"Solve", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"\[Epsilon]latt", "[", 
                  RowBox[{
                  "\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", "x0", ",", 
                   RowBox[{"{", 
                    RowBox[{"kx", ",", "0", ",", "0"}], "}"}]}], "]"}], 
                 "\[Equal]", "ene"}], ",", "kx"}], "]"}], "]"}]}], "//", 
            "N"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"k0", "=", 
           RowBox[{"{", 
            RowBox[{"ksol", ",", "0", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], ";"}], "*)"}], " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "to", " ", "recover", " ", "the", " ", "old", " ", "result"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"k0", "=", 
         RowBox[{"{", 
          RowBox[{"ksol", ",", "0", ",", "0"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"k0s", ",", " ", "k0"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ti", "=", 
         RowBox[{"5", "*", 
          RowBox[{"x0", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
        RowBox[{"tf", "=", 
         RowBox[{
          RowBox[{"-", "3"}], "*", "ti"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
           "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", "fun1", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fun1", "[", "s_", "]"}], "=", 
         RowBox[{"solveSEOM", "[", 
          RowBox[{
          "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", 
           "\[Alpha]", ",", 
           RowBox[{"\[Chi]", "=", 
            RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"data1", ",", "header1"}], "}"}], "=", 
         RowBox[{"createData", "[", 
          RowBox[{
          "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun1", 
           ",", "ti", ",", "tf", ",", "401"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"dataEnes", ",", "data1"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"ene", ",", "enes"}], "}"}]}], "]"}], ",", "ene"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"set", " ", "dispersion"}], " ", "==", " ", "linearized"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{"\[Epsilon]", ",", "rt", ",", "xs", ",", "ks"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{"\[Epsilon]lin", "[", 
      RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
      "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", "=", 
     RowBox[{"{", 
      RowBox[{"2", ",", "0", ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", "fun2", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fun2", "[", "s_", "]"}], "=", 
     RowBox[{"solveSEOM", "[", 
      RowBox[{
      "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
       ",", 
       RowBox[{"\[Chi]", "=", 
        RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data2", ",", "header2"}], "}"}], "=", 
     RowBox[{"createData", "[", 
      RowBox[{
      "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun2", ",", 
       "ti", ",", "tf", ",", "401"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AppendTo", "[", 
     RowBox[{"dataEnes", ",", "data2"}], "]"}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"p2", "=", 
     RowBox[{"ParametricPlot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"fun2", "[", "t", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{";;", "2"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", "tf"}], "}"}], ",", 
       RowBox[{"PlotStyle", "->", "Black"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"dataEnes", "[", 
      RowBox[{"[", 
       RowBox[{";;", ",", ";;", ",", 
        RowBox[{"6", ";;", "7"}]}], "]"}], "]"}], ",", 
     RowBox[{"Joined", "->", "True"}], ",", 
     RowBox[{"PlotRange", "->", 
      RowBox[{"10", "\[Rho]t", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}]}], ",", 
     RowBox[{"AspectRatio", "->", "1"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"pathOut", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{"StringForm", "[", 
         RowBox[{
         "\"\<weak_lensing_high_energies.csv\>\"", ",", "\[Chi]", ",", 
          "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"dataEnes", ",", "1"}], "]"}], ",", "header2"}], "]"}]}], 
     "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762141060781384`*^9, 
   3.8762141134561453`*^9}, {3.8762141738660383`*^9, 
   3.8762141745719967`*^9}, {3.8762158004615927`*^9, 3.876215949410845*^9}, 
   3.876216001195833*^9, {3.876216665708499*^9, 3.876216666006266*^9}, 
   3.876279327591407*^9, 3.876409198389716*^9, {3.876409329597155*^9, 
   3.8764093883778763`*^9}, {3.876409451249091*^9, 3.876409477871475*^9}, {
   3.8764097282610493`*^9, 3.876409729126554*^9}, {3.881901056974374*^9, 
   3.8819010918162737`*^9}, {3.881901901478554*^9, 3.881901923966177*^9}, {
   3.881902046915411*^9, 3.88190209655989*^9}, {3.881902603332513*^9, 
   3.881902620142847*^9}, {3.881902736538953*^9, 3.8819027552948837`*^9}, {
   3.881902802757206*^9, 3.8819028104105253`*^9}, {3.881902849575664*^9, 
   3.8819028775582933`*^9}, {3.881902929875951*^9, 3.8819029955093412`*^9}, {
   3.881903041662242*^9, 3.881903050538712*^9}, {3.8819030805478354`*^9, 
   3.881903142394868*^9}, {3.881903211583119*^9, 3.881903247152931*^9}, {
   3.8819033139511127`*^9, 3.881903322389565*^9}, {3.881903375485978*^9, 
   3.881903375713231*^9}, {3.8819034369705553`*^9, 3.881903475139368*^9}, {
   3.881903505171379*^9, 3.881903505422605*^9}, {3.881903562336643*^9, 
   3.881903572968026*^9}, {3.881903768944336*^9, 3.881903787966866*^9}, {
   3.8819038350509853`*^9, 3.881903949976248*^9}, {3.881903995837186*^9, 
   3.8819040456500874`*^9}, {3.881904127768319*^9, 3.881904163176784*^9}, {
   3.881904230314434*^9, 3.881904258956979*^9}, {3.881904312813139*^9, 
   3.88190443874037*^9}, {3.881904514632134*^9, 3.881904599833557*^9}, {
   3.88190477759161*^9, 3.881904883410282*^9}, {3.88190492689888*^9, 
   3.881904931638043*^9}, {3.881905200781115*^9, 3.8819052118007803`*^9}, {
   3.881905268325974*^9, 3.881905268689443*^9}, {3.881905349425519*^9, 
   3.881905406553729*^9}, {3.88190580941253*^9, 3.881905810957035*^9}, {
   3.881905844792428*^9, 3.8819058618283777`*^9}, {3.88190589360467*^9, 
   3.881905977819755*^9}, {3.8819060158989153`*^9, 3.881906019975823*^9}, {
   3.881906068300147*^9, 3.8819060684051533`*^9}, {3.881906119755988*^9, 
   3.881906339758581*^9}, {3.8819067256527767`*^9, 3.88190678097964*^9}, {
   3.881906836003559*^9, 3.881906856836523*^9}, {3.881906887740369*^9, 
   3.88190692768757*^9}, {3.881906958770376*^9, 3.881907048132303*^9}, {
   3.881907103079173*^9, 3.881907104325692*^9}, {3.881907162983317*^9, 
   3.881907194603447*^9}, {3.881907247187056*^9, 3.8819074495159273`*^9}, {
   3.881907499535563*^9, 3.881907567669812*^9}, {3.8819076306246853`*^9, 
   3.881907924872568*^9}, {3.881907955751528*^9, 3.881908143670786*^9}, {
   3.881908176735868*^9, 3.881908246597876*^9}, {3.881908294651113*^9, 
   3.881908316744555*^9}, {3.881908795001903*^9, 3.881908795161745*^9}, {
   3.881908840067164*^9, 3.88190890933834*^9}, {3.881908943089808*^9, 
   3.881908965923357*^9}, {3.8819090089112253`*^9, 3.881909010122513*^9}, {
   3.881909064092095*^9, 3.8819090713128633`*^9}, {3.881909131918374*^9, 
   3.881909139521057*^9}, {3.8819092141648607`*^9, 3.881909269604308*^9}, {
   3.881909301835094*^9, 3.8819093032163477`*^9}, 3.88190956742045*^9, {
   3.8819096582577457`*^9, 3.881909661239786*^9}, {3.881909957661458*^9, 
   3.881910016784719*^9}, {3.881910126663623*^9, 3.8819101609102716`*^9}, {
   3.881910210902976*^9, 3.8819102116220427`*^9}, {3.88191032070268*^9, 
   3.8819103558519487`*^9}, {3.881910493389123*^9, 3.8819106629723186`*^9}, {
   3.881910707573369*^9, 3.88191075474996*^9}, {3.881910785252969*^9, 
   3.881911115633861*^9}, {3.881911547555263*^9, 3.881911554960505*^9}, {
   3.881911750984448*^9, 3.881911831193665*^9}, {3.881911862084404*^9, 
   3.881912091438858*^9}, {3.8819121693032207`*^9, 3.881912295519001*^9}, {
   3.881913512872156*^9, 3.881913554757807*^9}, {3.881913597902185*^9, 
   3.881913597977859*^9}, {3.8819137446998863`*^9, 3.881913744960554*^9}, {
   3.881913788772895*^9, 3.88191391401978*^9}, 3.881914004008996*^9, {
   3.881914051840798*^9, 3.881914086331894*^9}, {3.881914116415846*^9, 
   3.8819141721134443`*^9}, {3.88191423178434*^9, 3.8819142318824368`*^9}, {
   3.8819142645670757`*^9, 3.881914327734007*^9}, {3.881914357785511*^9, 
   3.881914358192182*^9}, {3.881914475008327*^9, 3.881914515838744*^9}, {
   3.8819145709234457`*^9, 3.8819145709931803`*^9}, {3.8819146172440853`*^9, 
   3.881914675191196*^9}, {3.881914729516918*^9, 3.881914754076757*^9}, {
   3.881916603125491*^9, 3.881916617300716*^9}, {3.881916661234671*^9, 
   3.881916691786353*^9}, {3.8819167265997267`*^9, 3.881916748587042*^9}, {
   3.881916785457983*^9, 3.881916845595028*^9}, {3.8819200820540123`*^9, 
   3.881920112016053*^9}, {3.881920148246869*^9, 3.8819202455868683`*^9}, {
   3.881920285500657*^9, 3.881920418060204*^9}, {3.881920452320704*^9, 
   3.881920507476797*^9}, {3.881920549874585*^9, 3.881920624647819*^9}, {
   3.881921829211673*^9, 3.881921926064536*^9}, {3.8819219737787027`*^9, 
   3.881921996520525*^9}, {3.881922027575631*^9, 3.881922044667472*^9}, {
   3.881924882662936*^9, 3.88192493210174*^9}, {3.881926501745393*^9, 
   3.881926562507538*^9}, {3.881926786242402*^9, 3.8819267870424843`*^9}, {
   3.881926818757985*^9, 3.881926819022996*^9}, {3.881926867896449*^9, 
   3.8819268680556803`*^9}, {3.881926964623786*^9, 3.881926964950294*^9}, {
   3.881927007480858*^9, 3.8819270597433*^9}, 3.88198148494874*^9, {
   3.881995352336216*^9, 3.88199536381464*^9}, {3.8819954914566097`*^9, 
   3.881995501431489*^9}, {3.881995539133196*^9, 3.881995623617433*^9}, {
   3.881995780061851*^9, 3.881995780417931*^9}, {3.881995834404419*^9, 
   3.881995837074552*^9}, {3.8819959177861853`*^9, 3.8819959594965153`*^9}, {
   3.881996004067731*^9, 3.88199601882484*^9}, {3.881996142729199*^9, 
   3.881996156600299*^9}, 3.881996258291658*^9, 3.88223821724745*^9, {
   3.8822382778971987`*^9, 3.882238277964046*^9}, {3.882238344377306*^9, 
   3.882238470560979*^9}, 3.882238623068103*^9, {3.882257540154585*^9, 
   3.882257943057908*^9}, {3.882258015178336*^9, 3.882258109811799*^9}, {
   3.882259373967779*^9, 3.882259447078539*^9}, {3.882259524466938*^9, 
   3.882259548054637*^9}, {3.882259600369318*^9, 3.88225966739915*^9}, {
   3.8822599704307537`*^9, 3.8822599730545483`*^9}, {3.8822600867938337`*^9, 
   3.882260119352291*^9}, {3.8822602131056147`*^9, 3.882260276199382*^9}, {
   3.8822603095417213`*^9, 3.882260430503256*^9}, {3.882260466159988*^9, 
   3.882260466315566*^9}, {3.882260547181055*^9, 3.8822605602000713`*^9}, {
   3.88226066366742*^9, 3.882260703670741*^9}, {3.882260740468397*^9, 
   3.8822607664529257`*^9}, 3.882260806829262*^9, {3.882260844403957*^9, 
   3.882260901756311*^9}, {3.882260933233158*^9, 3.88226095025743*^9}, {
   3.8822625615794897`*^9, 3.882262633204544*^9}, {3.8822628227654133`*^9, 
   3.882262830263443*^9}, {3.882262895445386*^9, 3.882263042930863*^9}, {
   3.882263075484913*^9, 3.882263101333313*^9}, {3.882263133395121*^9, 
   3.882263229337171*^9}, {3.8822633004340687`*^9, 3.882263407204452*^9}, {
   3.882263452117469*^9, 3.8822634538462467`*^9}, {3.8822635221796207`*^9, 
   3.882263524138276*^9}, {3.8822635637376204`*^9, 3.882263645316155*^9}, {
   3.8822636793180113`*^9, 3.882263679611561*^9}, {3.882263730630184*^9, 
   3.88226373839065*^9}, {3.882263773689423*^9, 3.882263914571045*^9}, {
   3.882263965017301*^9, 3.882263976640519*^9}, 3.882264072774104*^9, 
   3.88226432079954*^9, {3.8822645129008636`*^9, 3.882264542689435*^9}, {
   3.882264584850412*^9, 3.882264687045766*^9}, {3.8822648370365553`*^9, 
   3.8822649321659813`*^9}, {3.8822650343679447`*^9, 3.882265035209207*^9}, {
   3.882265131743824*^9, 3.882265131958418*^9}, {3.882265188308275*^9, 
   3.882265216772401*^9}, {3.882265257310834*^9, 3.882265280777029*^9}, {
   3.882265321264711*^9, 3.8822654237690983`*^9}, {3.882265456443561*^9, 
   3.8822654568916492`*^9}, {3.882265501055389*^9, 3.8822655185318127`*^9}, {
   3.882265569952997*^9, 3.88226557355175*^9}, {3.882265608981833*^9, 
   3.882265609057268*^9}, 3.8822656484618464`*^9, {3.882265694278076*^9, 
   3.882265703159645*^9}, {3.8822657474194717`*^9, 3.882265759151025*^9}, 
   3.882265961111693*^9, {3.88226605739437*^9, 3.882266060112731*^9}, {
   3.882266235607782*^9, 3.882266242737536*^9}, {3.882266300177924*^9, 
   3.882266329672509*^9}, {3.882266365031537*^9, 3.882266368119079*^9}, {
   3.8822664146652317`*^9, 3.88226641517036*^9}, {3.8822664474093103`*^9, 
   3.8822664476622877`*^9}, {3.882266496151195*^9, 3.882266499898877*^9}, 
   3.882266607107449*^9, {3.882266712777132*^9, 3.882266716189324*^9}, {
   3.882266790843402*^9, 3.882266791837586*^9}, {3.882266842008401*^9, 
   3.8822668426117563`*^9}, {3.88226688524757*^9, 3.882266921791926*^9}, {
   3.8823323540671577`*^9, 3.882332356029622*^9}, {3.882332612172203*^9, 
   3.882332621821596*^9}, {3.882332665789604*^9, 3.882332698120332*^9}, {
   3.882332753853593*^9, 3.8823327544396563`*^9}, {3.882332867455467*^9, 
   3.88233286764585*^9}, {3.882332961354333*^9, 3.882332961717926*^9}, {
   3.882334334887635*^9, 3.88233435416216*^9}, {3.882342204538106*^9, 
   3.882342226019148*^9}, {3.882343558962082*^9, 3.882343559412407*^9}, 
   3.8823435910930567`*^9, {3.882343643696096*^9, 3.882343651816132*^9}, {
   3.88234452098842*^9, 3.882344560633871*^9}, {3.882344598816772*^9, 
   3.8823445989033623`*^9}, {3.882344735767336*^9, 3.882344736600245*^9}, {
   3.8823450144511633`*^9, 3.8823450149231367`*^9}, {3.8823450764126377`*^9, 
   3.882345269081251*^9}, {3.882345339931519*^9, 3.882345340199741*^9}, {
   3.882345431600835*^9, 3.882345432341463*^9}, {3.8823455803625402`*^9, 
   3.882345582166814*^9}, 3.882346098834676*^9, {3.882347052214759*^9, 
   3.882347052417603*^9}, {3.882347096969308*^9, 3.882347122024836*^9}, {
   3.882347307414907*^9, 3.882347307747937*^9}, {3.882347627293895*^9, 
   3.8823476281711893`*^9}, {3.882348162346373*^9, 3.8823482031376543`*^9}, {
   3.882348647694776*^9, 3.882348662566011*^9}, {3.882348756238821*^9, 
   3.8823487770689383`*^9}, {3.8823498269050007`*^9, 3.882349835032895*^9}, {
   3.88234989346171*^9, 3.882349893807289*^9}, {3.882350010872199*^9, 
   3.882350012109426*^9}, {3.8823504492106733`*^9, 3.88235047838376*^9}},
 CellLabel->
  "In[3018]:=",ExpressionUUID->"6f9d1ce0-6dc3-4f58-b637-504ebf65104b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"set", " ", "lattice", " ", "dispersion"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Epsilon]", ",", "rt", ",", "xs", ",", "ks", ",", "ys", ",", "x0s"}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{"\[Epsilon]latt", "[", 
      RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ys", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"300", "*", 
        SuperscriptBox["10", "x"]}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", "6", ",", "0.2"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"x0s", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "#"}], ",", "0"}], "}"}], "&"}], "/@", "ys"}]}], ";"}], 
   "\n", 
   RowBox[{"Clear", "[", 
    RowBox[{"lensingAngles", ",", "trajs"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lensingAngles", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"trajs", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Clear", "[", 
         RowBox[{"lensingAnglesLatt", ",", " ", "data"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"lensingAnglesLatt", "[", "t_", "]"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{"lensingAngle2", "[", 
            RowBox[{
            "t", ",", "#", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", 
             "\[Alpha]", ",", "\[Chi]", ",", 
             RowBox[{"ti", "=", 
              RowBox[{"1000000", "*", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
             RowBox[{"-", "ti"}], ",", "False"}], "]"}], "&"}], "/@", 
          "x0s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vFeff", "=", 
         RowBox[{"norm", "[", 
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{
             RowBox[{"\[Epsilon]", "[", 
              RowBox[{"\[Alpha]", ",", "vF", ",", "0", ",", 
               RowBox[{"x0s", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"kx", "->", 
              RowBox[{"k0", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"ky", "->", 
              RowBox[{"k0", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"kz", "->", 
              RowBox[{"k0", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"lensingAnglesLatt", "[", "t", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "2"}], "]"}], "]"}], "/", "\[Rho]t"}], ",", 
            
            RowBox[{
             RowBox[{"lensingAnglesLatt", "[", "t", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "3"}], "]"}], "]"}]}], "}"}], 
          "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"lensingAngles", ",", "data"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"trajs", ",", 
          RowBox[{
           RowBox[{"lensingAnglesLatt", "[", "t", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "4"}], "]"}], "]"}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"k0", ",", "k0s"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
     ",", "k0"}], "]"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"set", " ", "dispersion"}], " ", "==", " ", "linearized"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{"\[Epsilon]", ",", "rt", ",", "xs", ",", "ks"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{"\[Epsilon]lin", "[", 
      RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
      "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", "=", 
     RowBox[{"{", 
      RowBox[{"2", ",", "0", ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"lensingAnglesLin", ",", " ", "data"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lensingAnglesLin", "[", "t_", "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"lensingAngle2", "[", 
        RowBox[{
        "t", ",", "#", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
         ",", "\[Chi]", ",", 
         RowBox[{"ti", "=", 
          RowBox[{"1000000", "*", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
         RowBox[{"-", "ti"}], ",", "False"}], "]"}], "&"}], "/@", "x0s"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"lensingAnglesLin", "[", "t", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}], "/", "\[Rho]t"}], ",", 
        RowBox[{
         RowBox[{"lensingAnglesLin", "[", "t", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "3"}], "]"}], "]"}]}], "}"}], "\[Transpose]"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{"AppendTo", "[", 
     RowBox[{"lensingAngles", ",", " ", "data"}], "]"}], ";"}], "\n", 
   RowBox[{"ListLogLogPlot", "[", 
    RowBox[{
     RowBox[{"lensingAngles", "[", 
      RowBox[{"[", 
       RowBox[{";;", 
        RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", 
          RowBox[{"5", "*", "1*^4"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1*^-5", ",", "2"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"Joined", "->", "True"}], ",", 
     RowBox[{"PlotLegends", "->", 
      RowBox[{"Placed", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"enes", ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Right", ",", "Top"}], "}"}]}], "]"}]}], ",", 
     RowBox[{"FrameLabel", "->", 
      RowBox[{"MaTeX", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<\\\\rho_p/\\\\rho_t\>\"", ",", "\"\<\\\\varphi\>\""}], 
        "}"}], "]"}]}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"export", " ", "data", " ", "to", " ", "CSV", " ", "file"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dims", "=", 
     RowBox[{"lensingAngles", "//", "Dimensions"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lensingAnglesMat", "=", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{"lensingAngles", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"dims", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"dims", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"dims", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"eneslbl", " ", "=", " ", 
     RowBox[{"Join", "[", 
      RowBox[{"enes", ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"esColumn", " ", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"eneslbl", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "eneslbl", "]"}]}], "}"}]}], "]"}], "]"}], 
       "}"}], "\[Transpose]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", "lensingAnglesMat"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"esColumn", ",", "data", ",", "2"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", 
      RowBox[{
      "\"\<E\>\"", ",", "\"\<\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\varphi\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"pathOut", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{"StringForm", "[", 
         RowBox[{
         "\"\</lensing_angle_high_energies_KX_chi_`1`_rhot_`2`_vF_`3`.csv\>\"\
", ",", "\[Chi]", ",", "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", "data"}], 
     "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762141060781384`*^9, 
   3.8762141134561453`*^9}, {3.8762141738660383`*^9, 
   3.8762141745719967`*^9}, {3.8762158004615927`*^9, 3.876215949410845*^9}, 
   3.876216001195833*^9, {3.876216665708499*^9, 3.876216666006266*^9}, 
   3.876279327591407*^9, 3.876409198389716*^9, {3.876409329597155*^9, 
   3.8764093883778763`*^9}, {3.876409451249091*^9, 3.876409477871475*^9}, {
   3.8764097282610493`*^9, 3.876409729126554*^9}, {3.881901056974374*^9, 
   3.8819010918162737`*^9}, {3.881901901478554*^9, 3.881901923966177*^9}, {
   3.881902046915411*^9, 3.88190209655989*^9}, {3.881902603332513*^9, 
   3.881902620142847*^9}, {3.881902736538953*^9, 3.8819027552948837`*^9}, {
   3.881902802757206*^9, 3.8819028104105253`*^9}, {3.881902849575664*^9, 
   3.8819028775582933`*^9}, {3.881902929875951*^9, 3.8819029955093412`*^9}, {
   3.881903041662242*^9, 3.881903050538712*^9}, {3.8819030805478354`*^9, 
   3.881903142394868*^9}, {3.881903211583119*^9, 3.881903247152931*^9}, {
   3.8819033139511127`*^9, 3.881903322389565*^9}, {3.881903375485978*^9, 
   3.881903375713231*^9}, {3.8819034369705553`*^9, 3.881903475139368*^9}, {
   3.881903505171379*^9, 3.881903505422605*^9}, {3.881903562336643*^9, 
   3.881903572968026*^9}, {3.881903768944336*^9, 3.881903787966866*^9}, {
   3.8819038350509853`*^9, 3.881903949976248*^9}, {3.881903995837186*^9, 
   3.8819040456500874`*^9}, {3.881904127768319*^9, 3.881904163176784*^9}, {
   3.881904230314434*^9, 3.881904258956979*^9}, {3.881904312813139*^9, 
   3.88190443874037*^9}, {3.881904514632134*^9, 3.881904599833557*^9}, {
   3.88190477759161*^9, 3.881904883410282*^9}, {3.88190492689888*^9, 
   3.881904931638043*^9}, {3.881905200781115*^9, 3.8819052118007803`*^9}, {
   3.881905268325974*^9, 3.881905268689443*^9}, {3.881905349425519*^9, 
   3.881905406553729*^9}, {3.88190580941253*^9, 3.881905810957035*^9}, {
   3.881905844792428*^9, 3.8819058618283777`*^9}, {3.88190589360467*^9, 
   3.881905977819755*^9}, {3.8819060158989153`*^9, 3.881906019975823*^9}, {
   3.881906068300147*^9, 3.8819060684051533`*^9}, {3.881906119755988*^9, 
   3.881906339758581*^9}, {3.8819067256527767`*^9, 3.88190678097964*^9}, {
   3.881906836003559*^9, 3.881906856836523*^9}, {3.881906887740369*^9, 
   3.88190692768757*^9}, {3.881906958770376*^9, 3.881907048132303*^9}, {
   3.881907103079173*^9, 3.881907104325692*^9}, {3.881907162983317*^9, 
   3.881907194603447*^9}, {3.881907247187056*^9, 3.8819074495159273`*^9}, {
   3.881907499535563*^9, 3.881907567669812*^9}, {3.8819076306246853`*^9, 
   3.881907924872568*^9}, {3.881907955751528*^9, 3.881908143670786*^9}, {
   3.881908176735868*^9, 3.881908246597876*^9}, {3.881908294651113*^9, 
   3.881908316744555*^9}, {3.881908795001903*^9, 3.881908795161745*^9}, {
   3.881908840067164*^9, 3.88190890933834*^9}, {3.881908943089808*^9, 
   3.881908965923357*^9}, {3.8819090089112253`*^9, 3.881909010122513*^9}, {
   3.881909064092095*^9, 3.8819090713128633`*^9}, {3.881909131918374*^9, 
   3.881909139521057*^9}, {3.8819092141648607`*^9, 3.881909269604308*^9}, {
   3.881909301835094*^9, 3.8819093032163477`*^9}, 3.88190956742045*^9, {
   3.8819096582577457`*^9, 3.881909661239786*^9}, {3.881909957661458*^9, 
   3.881910016784719*^9}, {3.881910126663623*^9, 3.8819101609102716`*^9}, {
   3.881910210902976*^9, 3.8819102116220427`*^9}, {3.88191032070268*^9, 
   3.8819103558519487`*^9}, {3.881910493389123*^9, 3.8819106629723186`*^9}, {
   3.881910707573369*^9, 3.88191075474996*^9}, {3.881910785252969*^9, 
   3.881911115633861*^9}, {3.881911547555263*^9, 3.881911554960505*^9}, {
   3.881911750984448*^9, 3.881911831193665*^9}, {3.881911862084404*^9, 
   3.881912091438858*^9}, {3.8819121693032207`*^9, 3.881912295519001*^9}, {
   3.881913512872156*^9, 3.881913554757807*^9}, {3.881913597902185*^9, 
   3.881913597977859*^9}, {3.8819137446998863`*^9, 3.881913744960554*^9}, {
   3.881913788772895*^9, 3.88191391401978*^9}, 3.881914004008996*^9, {
   3.881914051840798*^9, 3.881914086331894*^9}, {3.881914116415846*^9, 
   3.8819141721134443`*^9}, {3.88191423178434*^9, 3.8819142318824368`*^9}, {
   3.8819142645670757`*^9, 3.881914327734007*^9}, {3.881914357785511*^9, 
   3.881914358192182*^9}, {3.881914475008327*^9, 3.881914515838744*^9}, {
   3.8819145709234457`*^9, 3.8819145709931803`*^9}, {3.8819146172440853`*^9, 
   3.881914675191196*^9}, {3.881914729516918*^9, 3.881914754076757*^9}, {
   3.881916603125491*^9, 3.881916617300716*^9}, {3.881916661234671*^9, 
   3.881916691786353*^9}, {3.8819167265997267`*^9, 3.881916748587042*^9}, {
   3.881916785457983*^9, 3.881916845595028*^9}, {3.8819200820540123`*^9, 
   3.881920112016053*^9}, {3.881920148246869*^9, 3.8819202455868683`*^9}, {
   3.881920285500657*^9, 3.881920418060204*^9}, {3.881920452320704*^9, 
   3.881920507476797*^9}, {3.881920549874585*^9, 3.881920624647819*^9}, {
   3.8819206562826347`*^9, 3.881920745929261*^9}, 3.8819207837485733`*^9, {
   3.881921147360778*^9, 3.881921147660798*^9}, {3.88192121260499*^9, 
   3.881921372750038*^9}, {3.8819214418169394`*^9, 3.881921653180365*^9}, {
   3.881921696306621*^9, 3.8819217594316607`*^9}, {3.881921797776503*^9, 
   3.8819217982112837`*^9}, {3.88192208178329*^9, 3.881922082025902*^9}, {
   3.881922275350829*^9, 3.881922330693527*^9}, {3.881924677098288*^9, 
   3.8819247711088667`*^9}, {3.8819248110636587`*^9, 3.881924811272694*^9}, {
   3.881924978961749*^9, 3.881925000141386*^9}, {3.8819251367886744`*^9, 
   3.881925226934806*^9}, {3.881925333521744*^9, 3.8819255506458693`*^9}, {
   3.8819257059123287`*^9, 3.881925712411305*^9}, {3.8819257922911673`*^9, 
   3.881925797366892*^9}, {3.8819259654259777`*^9, 3.881925965945524*^9}, {
   3.88192610780265*^9, 3.88192610853471*^9}, {3.881996317057208*^9, 
   3.881996317490193*^9}, {3.881997137622096*^9, 3.881997154833693*^9}, 
   3.881997186348131*^9, {3.881997633726542*^9, 3.88199768978885*^9}, {
   3.881997962785234*^9, 3.881997967108283*^9}, 3.881999203911378*^9, {
   3.8819992458654947`*^9, 3.881999246701494*^9}, {3.882005934641765*^9, 
   3.882005971495863*^9}, 3.882006238530081*^9, {3.882006340274953*^9, 
   3.8820063423766003`*^9}, 3.8820064022377567`*^9, {3.882006456782794*^9, 
   3.8820064940940723`*^9}, {3.882006541572809*^9, 3.882006561145829*^9}, {
   3.882006686579151*^9, 3.8820066967331057`*^9}, {3.882007365128418*^9, 
   3.8820073659118013`*^9}, {3.882007401333827*^9, 3.882007401653338*^9}, {
   3.882007964800036*^9, 3.8820079656931543`*^9}, {3.8820080012961283`*^9, 
   3.882008001563252*^9}, {3.882008046265747*^9, 3.882008046581955*^9}, 
   3.882008162873742*^9, {3.882008421575426*^9, 3.882008441477491*^9}, {
   3.882008550801298*^9, 3.882008558702291*^9}, {3.8820085927619753`*^9, 
   3.882008621758832*^9}, 3.882009650485311*^9, 3.882009964683176*^9, {
   3.8822447641502438`*^9, 3.8822447643586483`*^9}, {3.882246266408255*^9, 
   3.8822462928377523`*^9}, 3.882246341344296*^9, {3.88224661214948*^9, 
   3.882246613707961*^9}, {3.882248569524137*^9, 3.882248576692032*^9}, {
   3.882249009078991*^9, 3.882249010337604*^9}, 3.882249140299271*^9, {
   3.882249686629685*^9, 3.882249686866613*^9}, {3.882249799790389*^9, 
   3.882249803387817*^9}, 3.882249905389864*^9, 3.8822502656822557`*^9, 
   3.882250349237566*^9, {3.882347536978676*^9, 3.882347551448442*^9}, {
   3.882347591602975*^9, 3.882347606480052*^9}, {3.882347680595675*^9, 
   3.8823476806760883`*^9}, {3.8823477678116007`*^9, 
   3.8823478070703917`*^9}, {3.882347870767357*^9, 3.882347875644569*^9}, {
   3.8823479111570883`*^9, 3.8823479183085423`*^9}, {3.882348142123536*^9, 
   3.882348146703693*^9}, {3.882348228657885*^9, 3.8823482337508383`*^9}, {
   3.882348306486258*^9, 3.88234831937087*^9}, 3.8823486314632874`*^9, {
   3.882348817410706*^9, 3.8823488289090767`*^9}, {3.8823504393779507`*^9, 
   3.882350439602693*^9}, {3.882350506261876*^9, 3.882350523069211*^9}, {
   3.882350598574737*^9, 3.882350692746359*^9}, {3.882350731653985*^9, 
   3.8823507353259706`*^9}, {3.88235078473413*^9, 3.882350794896929*^9}, {
   3.882350905220961*^9, 3.882350905602393*^9}, 3.8823510068992662`*^9, {
   3.882351042853703*^9, 3.8823510529579678`*^9}, {3.882352045345579*^9, 
   3.882352059048661*^9}},
 CellLabel->
  "In[3034]:=",ExpressionUUID->"abd63ee3-fd32-475e-a8e5-7a0e80b721df"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"set", " ", "lattice", " ", "dispersion"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "\[Epsilon]", ",", "rt", ",", "xs", ",", "ks", ",", "ys", ",", "x0s"}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{"\[Epsilon]latt", "[", 
      RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ys", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"300", "*", 
        SuperscriptBox["10", "x"]}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", "6", ",", "0.2"}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"x0s", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "#"}], ",", "0"}], "}"}], "&"}], "/@", "ys"}]}], ";"}], 
   "\n", 
   RowBox[{"Clear", "[", 
    RowBox[{"lensingAngles", ",", "trajs"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lensingAngles", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"trajs", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"ksol", "=", 
         RowBox[{"Last", "[", 
          RowBox[{"Sort", "[", 
           RowBox[{
            RowBox[{"k", "/.", 
             RowBox[{"Quiet", "[", 
              RowBox[{"Solve", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"\[Epsilon]latt", "[", 
                  RowBox[{
                  "\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", "x0", ",", 
                   RowBox[{"{", 
                    RowBox[{"k", ",", "k", ",", "0"}], "}"}]}], "]"}], 
                 "\[Equal]", "ene"}], ",", "k"}], "]"}], "]"}]}], "//", "N"}],
            "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"k0", "=", 
           RowBox[{"{", 
            RowBox[{"ksol", ",", "0", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], ";"}], "*)"}], " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "to", " ", "recover", " ", "the", " ", "old", " ", "result"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"k0", "=", 
         RowBox[{"{", 
          RowBox[{"ksol", ",", 
           RowBox[{"-", "ksol"}], ",", "0"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Clear", "[", 
         RowBox[{"lensingAnglesLatt", ",", " ", "data"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"lensingAnglesLatt", "[", "t_", "]"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{"lensingAngle2", "[", 
            RowBox[{
            "t", ",", "#", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", 
             "\[Alpha]", ",", "\[Chi]", ",", 
             RowBox[{"ti", "=", 
              RowBox[{"1000000", "*", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
             RowBox[{"-", "ti"}], ",", "False"}], "]"}], "&"}], "/@", 
          "x0s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vFeff", "=", 
         RowBox[{"norm", "[", 
          RowBox[{
           RowBox[{"Grad", "[", 
            RowBox[{
             RowBox[{"\[Epsilon]", "[", 
              RowBox[{"\[Alpha]", ",", "vF", ",", "0", ",", 
               RowBox[{"x0s", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}], "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"kx", "->", 
              RowBox[{"k0", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"ky", "->", 
              RowBox[{"k0", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"kz", "->", 
              RowBox[{"k0", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"lensingAnglesLatt", "[", "t", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "2"}], "]"}], "]"}], "/", "\[Rho]t"}], ",", 
            
            RowBox[{
             RowBox[{"lensingAnglesLatt", "[", "t", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "3"}], "]"}], "]"}]}], "}"}], 
          "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"lensingAngles", ",", "data"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"trajs", ",", 
          RowBox[{
           RowBox[{"lensingAnglesLatt", "[", "t", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "4"}], "]"}], "]"}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"ene", ",", "enes"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
     ",", "k0"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"set", " ", "dispersion"}], " ", "==", " ", "linearized"}], " ", 
    "*)"}], "\n", 
   RowBox[{"Clear", "[", 
    RowBox[{"\[Epsilon]", ",", "rt", ",", "xs", ",", "ks"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{"\[Epsilon]lin", "[", 
      RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "xs", ",", "ks"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
      "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k0", "=", 
     RowBox[{"{", 
      RowBox[{"2", ",", "0", ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"lensingAnglesLin", ",", " ", "data"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lensingAnglesLin", "[", "t_", "]"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"lensingAngle2", "[", 
        RowBox[{
        "t", ",", "#", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
         ",", "\[Chi]", ",", 
         RowBox[{"ti", "=", 
          RowBox[{"1000000", "*", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ",", 
         RowBox[{"-", "ti"}], ",", "False"}], "]"}], "&"}], "/@", "x0s"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"lensingAnglesLin", "[", "t", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "2"}], "]"}], "]"}], "/", "\[Rho]t"}], ",", 
        RowBox[{
         RowBox[{"lensingAnglesLin", "[", "t", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "3"}], "]"}], "]"}]}], "}"}], "\[Transpose]"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{"AppendTo", "[", 
     RowBox[{"lensingAngles", ",", " ", "data"}], "]"}], ";"}], "\n", 
   RowBox[{"ListLogLogPlot", "[", 
    RowBox[{
     RowBox[{"lensingAngles", "[", 
      RowBox[{"[", 
       RowBox[{";;", 
        RowBox[{"-", "2"}]}], "]"}], "]"}], ",", 
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", 
          RowBox[{"5", "*", "1*^4"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1*^-5", ",", "2"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"Joined", "->", "True"}], ",", 
     RowBox[{"PlotLegends", "->", 
      RowBox[{"Placed", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"enes", ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"Right", ",", "Top"}], "}"}]}], "]"}]}], ",", 
     RowBox[{"FrameLabel", "->", 
      RowBox[{"MaTeX", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<\\\\rho_p/\\\\rho_t\>\"", ",", "\"\<\\\\varphi\>\""}], 
        "}"}], "]"}]}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"export", " ", "data", " ", "to", " ", "CSV", " ", "file"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dims", "=", 
     RowBox[{"lensingAngles", "//", "Dimensions"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lensingAnglesMat", "=", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{"lensingAngles", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"dims", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"dims", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"dims", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"eneslbl", " ", "=", " ", 
     RowBox[{"Join", "[", 
      RowBox[{"enes", ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"esColumn", " ", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"eneslbl", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "eneslbl", "]"}]}], "}"}]}], "]"}], "]"}], 
       "}"}], "\[Transpose]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", "lensingAnglesMat"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"esColumn", ",", "data", ",", "2"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", 
      RowBox[{
      "\"\<E\>\"", ",", "\"\<\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\varphi\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"pathOut", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{"StringForm", "[", 
         RowBox[{
         "\"\</lensing_angle_high_energies_diag_chi_`1`_rhot_`2`_vF_`3`.csv\>\
\"", ",", "\[Chi]", ",", "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", 
      "data"}], "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762141060781384`*^9, 
   3.8762141134561453`*^9}, {3.8762141738660383`*^9, 
   3.8762141745719967`*^9}, {3.8762158004615927`*^9, 3.876215949410845*^9}, 
   3.876216001195833*^9, {3.876216665708499*^9, 3.876216666006266*^9}, 
   3.876279327591407*^9, 3.876409198389716*^9, {3.876409329597155*^9, 
   3.8764093883778763`*^9}, {3.876409451249091*^9, 3.876409477871475*^9}, {
   3.8764097282610493`*^9, 3.876409729126554*^9}, {3.881901056974374*^9, 
   3.8819010918162737`*^9}, {3.881901901478554*^9, 3.881901923966177*^9}, {
   3.881902046915411*^9, 3.88190209655989*^9}, {3.881902603332513*^9, 
   3.881902620142847*^9}, {3.881902736538953*^9, 3.8819027552948837`*^9}, {
   3.881902802757206*^9, 3.8819028104105253`*^9}, {3.881902849575664*^9, 
   3.8819028775582933`*^9}, {3.881902929875951*^9, 3.8819029955093412`*^9}, {
   3.881903041662242*^9, 3.881903050538712*^9}, {3.8819030805478354`*^9, 
   3.881903142394868*^9}, {3.881903211583119*^9, 3.881903247152931*^9}, {
   3.8819033139511127`*^9, 3.881903322389565*^9}, {3.881903375485978*^9, 
   3.881903375713231*^9}, {3.8819034369705553`*^9, 3.881903475139368*^9}, {
   3.881903505171379*^9, 3.881903505422605*^9}, {3.881903562336643*^9, 
   3.881903572968026*^9}, {3.881903768944336*^9, 3.881903787966866*^9}, {
   3.8819038350509853`*^9, 3.881903949976248*^9}, {3.881903995837186*^9, 
   3.8819040456500874`*^9}, {3.881904127768319*^9, 3.881904163176784*^9}, {
   3.881904230314434*^9, 3.881904258956979*^9}, {3.881904312813139*^9, 
   3.88190443874037*^9}, {3.881904514632134*^9, 3.881904599833557*^9}, {
   3.88190477759161*^9, 3.881904883410282*^9}, {3.88190492689888*^9, 
   3.881904931638043*^9}, {3.881905200781115*^9, 3.8819052118007803`*^9}, {
   3.881905268325974*^9, 3.881905268689443*^9}, {3.881905349425519*^9, 
   3.881905406553729*^9}, {3.88190580941253*^9, 3.881905810957035*^9}, {
   3.881905844792428*^9, 3.8819058618283777`*^9}, {3.88190589360467*^9, 
   3.881905977819755*^9}, {3.8819060158989153`*^9, 3.881906019975823*^9}, {
   3.881906068300147*^9, 3.8819060684051533`*^9}, {3.881906119755988*^9, 
   3.881906339758581*^9}, {3.8819067256527767`*^9, 3.88190678097964*^9}, {
   3.881906836003559*^9, 3.881906856836523*^9}, {3.881906887740369*^9, 
   3.88190692768757*^9}, {3.881906958770376*^9, 3.881907048132303*^9}, {
   3.881907103079173*^9, 3.881907104325692*^9}, {3.881907162983317*^9, 
   3.881907194603447*^9}, {3.881907247187056*^9, 3.8819074495159273`*^9}, {
   3.881907499535563*^9, 3.881907567669812*^9}, {3.8819076306246853`*^9, 
   3.881907924872568*^9}, {3.881907955751528*^9, 3.881908143670786*^9}, {
   3.881908176735868*^9, 3.881908246597876*^9}, {3.881908294651113*^9, 
   3.881908316744555*^9}, {3.881908795001903*^9, 3.881908795161745*^9}, {
   3.881908840067164*^9, 3.88190890933834*^9}, {3.881908943089808*^9, 
   3.881908965923357*^9}, {3.8819090089112253`*^9, 3.881909010122513*^9}, {
   3.881909064092095*^9, 3.8819090713128633`*^9}, {3.881909131918374*^9, 
   3.881909139521057*^9}, {3.8819092141648607`*^9, 3.881909269604308*^9}, {
   3.881909301835094*^9, 3.8819093032163477`*^9}, 3.88190956742045*^9, {
   3.8819096582577457`*^9, 3.881909661239786*^9}, {3.881909957661458*^9, 
   3.881910016784719*^9}, {3.881910126663623*^9, 3.8819101609102716`*^9}, {
   3.881910210902976*^9, 3.8819102116220427`*^9}, {3.88191032070268*^9, 
   3.8819103558519487`*^9}, {3.881910493389123*^9, 3.8819106629723186`*^9}, {
   3.881910707573369*^9, 3.88191075474996*^9}, {3.881910785252969*^9, 
   3.881911115633861*^9}, {3.881911547555263*^9, 3.881911554960505*^9}, {
   3.881911750984448*^9, 3.881911831193665*^9}, {3.881911862084404*^9, 
   3.881912091438858*^9}, {3.8819121693032207`*^9, 3.881912295519001*^9}, {
   3.881913512872156*^9, 3.881913554757807*^9}, {3.881913597902185*^9, 
   3.881913597977859*^9}, {3.8819137446998863`*^9, 3.881913744960554*^9}, {
   3.881913788772895*^9, 3.88191391401978*^9}, 3.881914004008996*^9, {
   3.881914051840798*^9, 3.881914086331894*^9}, {3.881914116415846*^9, 
   3.8819141721134443`*^9}, {3.88191423178434*^9, 3.8819142318824368`*^9}, {
   3.8819142645670757`*^9, 3.881914327734007*^9}, {3.881914357785511*^9, 
   3.881914358192182*^9}, {3.881914475008327*^9, 3.881914515838744*^9}, {
   3.8819145709234457`*^9, 3.8819145709931803`*^9}, {3.8819146172440853`*^9, 
   3.881914675191196*^9}, {3.881914729516918*^9, 3.881914754076757*^9}, {
   3.881916603125491*^9, 3.881916617300716*^9}, {3.881916661234671*^9, 
   3.881916691786353*^9}, {3.8819167265997267`*^9, 3.881916748587042*^9}, {
   3.881916785457983*^9, 3.881916845595028*^9}, {3.8819200820540123`*^9, 
   3.881920112016053*^9}, {3.881920148246869*^9, 3.8819202455868683`*^9}, {
   3.881920285500657*^9, 3.881920418060204*^9}, {3.881920452320704*^9, 
   3.881920507476797*^9}, {3.881920549874585*^9, 3.881920624647819*^9}, {
   3.8819206562826347`*^9, 3.881920745929261*^9}, 3.8819207837485733`*^9, {
   3.881921147360778*^9, 3.881921147660798*^9}, {3.88192121260499*^9, 
   3.881921372750038*^9}, {3.8819214418169394`*^9, 3.881921653180365*^9}, {
   3.881921696306621*^9, 3.8819217594316607`*^9}, {3.881921797776503*^9, 
   3.8819217982112837`*^9}, {3.88192208178329*^9, 3.881922082025902*^9}, {
   3.881922275350829*^9, 3.881922330693527*^9}, {3.881924677098288*^9, 
   3.8819247711088667`*^9}, {3.8819248110636587`*^9, 3.881924811272694*^9}, {
   3.881924978961749*^9, 3.881925000141386*^9}, {3.8819251367886744`*^9, 
   3.881925226934806*^9}, {3.881925333521744*^9, 3.8819255506458693`*^9}, {
   3.8819257059123287`*^9, 3.881925712411305*^9}, {3.8819257922911673`*^9, 
   3.881925797366892*^9}, {3.8819259654259777`*^9, 3.881925965945524*^9}, {
   3.88192610780265*^9, 3.88192610853471*^9}, {3.881996317057208*^9, 
   3.881996317490193*^9}, {3.881997137622096*^9, 3.881997154833693*^9}, 
   3.881997186348131*^9, {3.881997633726542*^9, 3.88199768978885*^9}, {
   3.881997962785234*^9, 3.881997967108283*^9}, 3.881999203911378*^9, {
   3.8819992458654947`*^9, 3.881999246701494*^9}, {3.882005934641765*^9, 
   3.882005971495863*^9}, 3.882006238530081*^9, {3.882006340274953*^9, 
   3.8820063423766003`*^9}, 3.8820064022377567`*^9, {3.882006456782794*^9, 
   3.8820064940940723`*^9}, {3.882006541572809*^9, 3.882006561145829*^9}, {
   3.882006686579151*^9, 3.8820066967331057`*^9}, {3.882007365128418*^9, 
   3.8820073659118013`*^9}, {3.882007401333827*^9, 3.882007401653338*^9}, {
   3.882007964800036*^9, 3.8820079656931543`*^9}, {3.8820080012961283`*^9, 
   3.882008001563252*^9}, {3.882008046265747*^9, 3.882008046581955*^9}, 
   3.882008162873742*^9, {3.882008421575426*^9, 3.882008441477491*^9}, {
   3.882008550801298*^9, 3.882008558702291*^9}, {3.8820085927619753`*^9, 
   3.882008621758832*^9}, 3.882009650485311*^9, 3.882009964683176*^9, {
   3.8822447641502438`*^9, 3.8822447643586483`*^9}, {3.882246266408255*^9, 
   3.8822462928377523`*^9}, 3.882246341344296*^9, {3.88224661214948*^9, 
   3.882246613707961*^9}, {3.882248569524137*^9, 3.882248576692032*^9}, {
   3.882249009078991*^9, 3.882249010337604*^9}, 3.882249140299271*^9, {
   3.882249686629685*^9, 3.882249686866613*^9}, {3.882249799790389*^9, 
   3.882249803387817*^9}, 3.882249905389864*^9, 3.8822502656822557`*^9, 
   3.882250349237566*^9, {3.882347536978676*^9, 3.882347551448442*^9}, {
   3.882347591602975*^9, 3.882347606480052*^9}, {3.882347680595675*^9, 
   3.8823476806760883`*^9}, {3.8823477678116007`*^9, 
   3.8823478070703917`*^9}, {3.882347870767357*^9, 3.882347875644569*^9}, {
   3.8823479111570883`*^9, 3.8823479183085423`*^9}, {3.882348142123536*^9, 
   3.882348146703693*^9}, {3.882348228657885*^9, 3.8823482337508383`*^9}, {
   3.882348306486258*^9, 3.88234831937087*^9}, 3.8823486314632874`*^9, {
   3.882348817410706*^9, 3.8823488289090767`*^9}, {3.8823504393779507`*^9, 
   3.882350439602693*^9}, {3.882350506261876*^9, 3.882350523069211*^9}, {
   3.882350598574737*^9, 3.882350692746359*^9}, {3.882350731653985*^9, 
   3.8823507353259706`*^9}, {3.88235078473413*^9, 3.882350794896929*^9}, {
   3.882350905220961*^9, 3.882350905602393*^9}, 3.8823510068992662`*^9, {
   3.882351042853703*^9, 3.8823510529579678`*^9}, {3.882352045345579*^9, 
   3.882352059048661*^9}, {3.882352101087469*^9, 3.8823521399898453`*^9}, 
   3.882352383777286*^9},
 CellLabel->
  "In[3060]:=",ExpressionUUID->"2b171f1a-9e36-4ac8-8300-79e464e27f52"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export example trajectories for python / blender scripts", "Subsection",
 CellChangeTimes->{{3.876211684824133*^9, 3.876211687491818*^9}, {
  3.876216291171008*^9, 3.876216291828706*^9}, {3.876278401973187*^9, 
  3.8762784154034863`*^9}, {3.87628050876005*^9, 3.876280509659204*^9}, {
  3.876372998181967*^9, 
  3.876373021645277*^9}},ExpressionUUID->"49117bdc-ab77-4159-8667-\
916cd02a010c"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t", ",", "data", ",", "header1", ",", "header2", ",", 
   "data1", ",", "data2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vF", "=", "1"}], ";", 
   RowBox[{"\[Rho]t", "=", "1"}], ";", 
   RowBox[{"\[Alpha]", "=", 
    RowBox[{"1", "/", "2"}]}], ";", 
   RowBox[{"ti", "=", "0"}], ";", 
   RowBox[{"tf", "=", 
    RowBox[{"31.5", "*", "\[Rho]t"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "20"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.1644", ",", "1", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "20"}], ",", "0"}], "}"}], "*", "\[Rho]t"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.167", ",", "1", ",", "0"}], "}"}], "/", "\[Rho]t"}]}], 
     "}"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{
    "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
     ",", 
     RowBox[{"\[Chi]", "=", 
      RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots2D", "[", 
    RowBox[{
    "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
     "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"data1", ",", "header1"}], "}"}], "=", 
   RowBox[{"createData", "[", 
    RowBox[{
    "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
     "ti", ",", "tf", ",", " ", "201"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{
    "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
     ",", 
     RowBox[{"\[Chi]", "=", 
      RowBox[{"-", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots2D", "[", 
    RowBox[{
    "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
     "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"data2", ",", "header2"}], "}"}], "=", 
   RowBox[{"createData", "[", 
    RowBox[{
    "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
     "ti", ",", "tf", ",", " ", "201"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"data1", ",", "data2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Prepend", "[", 
    RowBox[{"data", ",", "header1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathOut", "=", 
   RowBox[{"SetDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathOut", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"StringForm", "[", 
      RowBox[{
      "\"\</lensing.csv\>\"", ",", "\[Chi]", ",", "\[Rho]t", ",", "vF"}], 
      "]"}], "]"}]}], ",", "data"}], "]"}]}], "Input",
 CellChangeTimes->{{3.876841001755007*^9, 3.876841003791091*^9}, {
   3.876841077168263*^9, 3.8768412694202957`*^9}, 3.876841381719429*^9, {
   3.876841453157504*^9, 3.876841465234432*^9}, 3.876841502419917*^9, {
   3.876841621690765*^9, 3.876841644033751*^9}, {3.876841698497971*^9, 
   3.876841826170759*^9}, {3.8768418615887737`*^9, 3.8768419595586233`*^9}, {
   3.876842006834156*^9, 3.876842035254355*^9}, {3.876842381977064*^9, 
   3.876842401064389*^9}, 3.8768433097657757`*^9, {3.8768444210736647`*^9, 
   3.876844425617117*^9}, {3.876844531512841*^9, 3.876844539530815*^9}, 
   3.8768447496788807`*^9, {3.8768449087333717`*^9, 3.876844916846984*^9}, {
   3.876845004653029*^9, 3.8768450360766697`*^9}, 3.8768830536224203`*^9, 
   3.876883257773134*^9, 3.876883794424837*^9, {3.876884032447543*^9, 
   3.876884046928669*^9}, {3.8768840960950737`*^9, 3.8768841249113398`*^9}, {
   3.876884371755968*^9, 3.876884373662796*^9}, {3.8768845150511503`*^9, 
   3.876884517490637*^9}, {3.876887544757514*^9, 3.8768875477501993`*^9}, 
   3.8768896500960827`*^9, {3.876889692722703*^9, 3.8768896974452972`*^9}, {
   3.876889734355641*^9, 3.876889737496272*^9}, {3.8768901374531603`*^9, 
   3.8768901492514677`*^9}, {3.876909991565831*^9, 3.876910004547984*^9}, {
   3.8769929265649843`*^9, 3.876993053126361*^9}, {3.876993535462082*^9, 
   3.876993618563311*^9}, {3.876994485591386*^9, 3.8769944905584507`*^9}, 
   3.8771655623326607`*^9, 3.877166572045574*^9, {3.877166631355433*^9, 
   3.877166695417758*^9}, {3.877166739468849*^9, 3.877166790977713*^9}, {
   3.87716703501562*^9, 3.877167072978856*^9}, {3.877167297658736*^9, 
   3.8771672981628647`*^9}},
 CellLabel->
  "In[386]:=",ExpressionUUID->"e0e5eeca-8ee6-465c-805e-e075833c129c"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "\[Epsilon]peff", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Epsilon]peff", "[", 
   RowBox[{
   "\[Rho]_", ",", "Lz_", ",", "vF_", ",", "\[Alpha]_", ",", "\[Rho]t_"}], 
   "]"}], ":=", 
  RowBox[{
   FractionBox[
    SuperscriptBox["Lz", "2"], 
    SuperscriptBox["\[Rho]", "2"]], 
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["vF", "2"], "-", 
     SuperscriptBox[
      RowBox[{"u", "[", 
       RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", "\[Rho]"}], "]"}], 
      "2"]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.876909839798931*^9, 3.8769099026515636`*^9}, {
  3.8769109456086683`*^9, 3.8769109488574266`*^9}, {3.876911035173243*^9, 
  3.876911035382072*^9}},
 CellLabel->
  "In[982]:=",ExpressionUUID->"a2e5d6a7-4025-46d0-9533-cce607299c6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Epsilon]peffs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"\[Epsilon]peff", "[", 
      RowBox[{
       RowBox[{"norm", "[", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"xvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"Lzs", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", "vF", ",", "\[Alpha]", ",", 
       "\[Rho]t"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.876909533239388*^9, 3.876909562656561*^9}, {
  3.876909612381916*^9, 3.8769096211105633`*^9}, {3.876909658957049*^9, 
  3.876909659337927*^9}, {3.8769097927752457`*^9, 3.876909819816079*^9}, {
  3.876909912860282*^9, 3.876909942520022*^9}, {3.876910515474333*^9, 
  3.8769105178930607`*^9}, {3.876910649247176*^9, 3.876910685099617*^9}, {
  3.876910847517892*^9, 3.876910854861659*^9}, {3.876910968310522*^9, 
  3.876911002542387*^9}},
 CellLabel->
  "In[984]:=",ExpressionUUID->"3d8ddd2c-b4ac-443e-a207-09d5f816007f"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Epsilon]peff", "[", 
    RowBox[{
     RowBox[{"norm", "[", 
      RowBox[{"\[Rho]", "[", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", "0"}], "}"}], "]"}], "]"}], ",", 
     RowBox[{"Lzs", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "vF", ",", "\[Alpha]", ",", 
     "\[Rho]t"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "1", ",", "10"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.876911456224819*^9, 3.876911460146995*^9}, {
  3.876911660950986*^9, 3.876911664963983*^9}, {3.876911696983629*^9, 
  3.876911697947524*^9}},
 CellLabel->
  "In[1032]:=",ExpressionUUID->"7bca24e4-a67f-4bb9-bc98-50ff0fc9a1ef"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"DensityPlot", "[", 
    RowBox[{
     RowBox[{"\[Epsilon]peff", "[", 
      RowBox[{
       RowBox[{"norm", "[", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"{", 
          RowBox[{"x", ",", "y", ",", "0"}], "}"}], "]"}], "]"}], ",", 
       RowBox[{"Lzs", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "vF", ",", "\[Alpha]", ",", 
       "\[Rho]t"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", 
       RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
     RowBox[{"Frame", "->", "False"}], ",", 
     RowBox[{"MaxRecursion", "->", "15"}], ",", 
     RowBox[{"PlotPoints", "->", "100"}], ",", 
     RowBox[{"ClippingStyle", "->", "Black"}], ",", 
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{"0", ",", "2.5"}], "}"}]}], ",", 
     RowBox[{"PlotTheme", "->", "\"\<Scientific\>\""}], ",", 
     RowBox[{"PlotRangePadding", "->", "0"}]}], "]"}], ",", 
   RowBox[{"Graphics", "[", 
    RowBox[{"Arrow", "[", 
     RowBox[{"Line", "[", 
      RowBox[{"xvs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", 
         RowBox[{";;", "2"}]}], "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
   RowBox[{"GridLines", "->", "None"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8769111393335667`*^9, 3.876911289113914*^9}, {
  3.876911367867474*^9, 3.876911374794229*^9}, {3.876911426106331*^9, 
  3.876911443216055*^9}, {3.876911674922196*^9, 3.8769117634667*^9}, {
  3.8769120160103683`*^9, 3.876912083337117*^9}},
 CellLabel->
  "In[1033]:=",ExpressionUUID->"a01e2b63-80bb-49d6-a5f8-2f8943890a36"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dtrhosqsLHS", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      SuperscriptBox[
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"norm", "[", 
          RowBox[{"\[Rho]", "[", 
           RowBox[{
            RowBox[{"fun", "[", "s", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "s"}], "]"}], 
       "2"], "/.", 
      RowBox[{"{", 
       RowBox[{"s", "->", "#"}], "}"}]}], "&"}], "/@", "ts"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dtrhosqsRHS", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["\[Epsilon]s", "2"], "-", "\[Epsilon]peffs"}], ")"}], 
    "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SuperscriptBox[
        RowBox[{"norm", "[", "#", "]"}], "2"], "&"}], "/@", "kvs"}], 
     ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"dtrhosqsLHS", ",", "dtrhosqsRHS"}], "}"}], "//", 
  "ListPlot"}]}], "Input",
 CellChangeTimes->{{3.876910011934535*^9, 3.87691009243574*^9}, {
  3.87691032531509*^9, 3.876910385005013*^9}, {3.876910707399872*^9, 
  3.8769107738067713`*^9}, {3.87691083326567*^9, 3.8769109315191298`*^9}, {
  3.87691104520516*^9, 3.876911115359598*^9}},
 CellLabel->
  "In[1034]:=",ExpressionUUID->"08165883-7568-439f-81d9-de138afe44cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"norm", "[", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{
               RowBox[{"fun", "[", "s", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "s"}], 
           "]"}], "2"], "/.", 
         RowBox[{"{", 
          RowBox[{"s", "->", "#"}], "}"}]}], "&"}], "/@", "ts"}], ")"}], "*", 
     
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox[
         RowBox[{"norm", "[", "#", "]"}], "2"], "&"}], "/@", "kvs"}], ")"}]}],
     ",", "\[Epsilon]peffs", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"norm", "[", 
              RowBox[{"\[Rho]", "[", 
               RowBox[{
                RowBox[{"fun", "[", "s", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "s"}], 
            "]"}], "2"], "/.", 
          RowBox[{"{", 
           RowBox[{"s", "->", "#"}], "}"}]}], "&"}], "/@", "ts"}], ")"}], "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"norm", "[", "#", "]"}], "2"], "&"}], "/@", "kvs"}], 
       ")"}]}], "+", "\[Epsilon]peffs"}]}], "}"}], "//", 
  "ListPlot"}]], "Input",
 CellChangeTimes->{{3.876912185241496*^9, 3.8769122912141647`*^9}},
 CellLabel->
  "In[1045]:=",ExpressionUUID->"fe1e313c-38bd-4a68-aa83-73a53096a910"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t", ",", "data", ",", "header1", ",", "header2", ",", 
   "data1", ",", "data2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"ti", "=", "0"}], ";", 
  RowBox[{"tf", "=", "30"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ky0", " ", "=", " ", 
   FractionBox["\[Alpha]", 
    RowBox[{"\[Alpha]", "+", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kx0", "=", 
   FractionBox["ky0", 
    SqrtBox["\[Alpha]"]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"x0", ",", "k0"}], "}"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Rho]s", "[", 
       RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}], ",", "0", ",", "0"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kx0", ",", "ky0", ",", "0"}], "}"}], "/", "\[Rho]t"}]}], 
   "}"}]}]}], "Input",
 CellChangeTimes->{{3.876841001755007*^9, 3.876841003791091*^9}, {
   3.876841077168263*^9, 3.8768412694202957`*^9}, 3.876841381719429*^9, {
   3.876841453157504*^9, 3.876841465234432*^9}, 3.876841502419917*^9, {
   3.876841621690765*^9, 3.876841644033751*^9}, {3.876841698497971*^9, 
   3.876841826170759*^9}, {3.8768418615887737`*^9, 3.8768419595586233`*^9}, {
   3.876842006834156*^9, 3.876842035254355*^9}, {3.876842381977064*^9, 
   3.876842401064389*^9}, 3.8768433097657757`*^9, {3.8768444210736647`*^9, 
   3.876844425617117*^9}, {3.876844531512841*^9, 3.876844539530815*^9}, 
   3.8768447496788807`*^9, {3.8768449087333717`*^9, 3.876844916846984*^9}, {
   3.876845004653029*^9, 3.8768450360766697`*^9}, 3.8768830536224203`*^9, 
   3.876883257773134*^9, 3.876883794424837*^9, {3.876884032447543*^9, 
   3.876884046928669*^9}, {3.8768840960950737`*^9, 3.8768841249113398`*^9}, {
   3.876884259403254*^9, 3.8768843213564157`*^9}, {3.876884425074397*^9, 
   3.8768844507384853`*^9}, {3.876884494660097*^9, 3.8768844973591137`*^9}, 
   3.8768845276242037`*^9, {3.876886818231607*^9, 3.876886822374219*^9}, {
   3.876907410399376*^9, 3.876907411522505*^9}, 3.876993313982235*^9, {
   3.8769933578815327`*^9, 3.876993461662043*^9}, {3.8769949595483007`*^9, 
   3.876994991409333*^9}, {3.87699508720268*^9, 3.876995218755274*^9}, {
   3.876996237648796*^9, 3.876996247065325*^9}, {3.876996289604611*^9, 
   3.876996355813283*^9}, {3.877167838880122*^9, 3.8771678632294617`*^9}, {
   3.877167905143476*^9, 3.877167929541995*^9}, {3.877168231342227*^9, 
   3.877168231391014*^9}},
 CellLabel->
  "In[457]:=",ExpressionUUID->"f942659e-6621-49ba-9c08-cbe017c8fb1e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"fun", "[", "s_", "]"}], "=", 
     RowBox[{"solveSEOM", "[", 
      RowBox[{
      "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
       ",", 
       RowBox[{"\[Chi]", "=", 
        RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"makePlots", "[", 
        RowBox[{
        "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",",
          "tf", ",", "False"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"ViewPoint", "\[Rule]", 
       RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots2D", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data1", ",", "header1"}], "}"}], "=", 
     RowBox[{"createData", "[", 
      RowBox[{
      "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
       "ti", ",", "tf", ",", " ", "201"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fun", "[", "s_", "]"}], "=", 
     RowBox[{"solveSEOM", "[", 
      RowBox[{
      "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
       ",", 
       RowBox[{"\[Chi]", "=", 
        RowBox[{"-", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"makePlots", "[", 
        RowBox[{
        "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",",
          "tf", ",", "False"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"ViewPoint", "\[Rule]", 
       RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots2D", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data2", ",", "header2"}], "}"}], "=", 
     RowBox[{"createData", "[", 
      RowBox[{
      "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
       "ti", ",", "tf", ",", " ", "201"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data1", ",", "data2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</unstable_orbit.csv\>\"", ",", "\[Chi]", ",", "\[Rho]t", ",", 
         "vF"}], "]"}], "]"}]}], ",", "data"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876841001755007*^9, 3.876841003791091*^9}, {
   3.876841077168263*^9, 3.8768412694202957`*^9}, 3.876841381719429*^9, {
   3.876841453157504*^9, 3.876841465234432*^9}, 3.876841502419917*^9, {
   3.876841621690765*^9, 3.876841644033751*^9}, {3.876841698497971*^9, 
   3.876841826170759*^9}, {3.8768418615887737`*^9, 3.8768419595586233`*^9}, {
   3.876842006834156*^9, 3.876842035254355*^9}, {3.876842381977064*^9, 
   3.876842401064389*^9}, 3.8768433097657757`*^9, {3.8768444210736647`*^9, 
   3.876844425617117*^9}, {3.876844531512841*^9, 3.876844539530815*^9}, 
   3.8768447496788807`*^9, {3.8768449087333717`*^9, 3.876844916846984*^9}, {
   3.876845004653029*^9, 3.8768450360766697`*^9}, 3.8768830536224203`*^9, 
   3.876883257773134*^9, 3.876883794424837*^9, {3.876884032447543*^9, 
   3.876884046928669*^9}, {3.8768840960950737`*^9, 3.8768841249113398`*^9}, {
   3.876884371755968*^9, 3.876884373662796*^9}, {3.8768845150511503`*^9, 
   3.876884517490637*^9}, {3.876887544757514*^9, 3.8768875477501993`*^9}, 
   3.8768896500960827`*^9, {3.876889692722703*^9, 3.8768896974452972`*^9}, {
   3.876889734355641*^9, 3.876889737496272*^9}, {3.8768901374531603`*^9, 
   3.8768901492514677`*^9}, {3.876909991565831*^9, 3.876910004547984*^9}, {
   3.8769929265649843`*^9, 3.876993053126361*^9}, {3.876993535462082*^9, 
   3.876993618563311*^9}, {3.876994485591386*^9, 3.8769944905584507`*^9}, 
   3.8771655623326607`*^9, 3.877166572045574*^9, {3.877166631355433*^9, 
   3.877166695417758*^9}, {3.877166739468849*^9, 3.877166790977713*^9}, {
   3.87716703501562*^9, 3.877167072978856*^9}, {3.877167297658736*^9, 
   3.8771672981628647`*^9}, {3.87716782703633*^9, 3.8771678679722433`*^9}},
 CellLabel->
  "In[462]:=",ExpressionUUID->"6b3cf5e4-61f5-4f83-8d1b-bdb9a534f25d"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1920, 1027},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> True}, "TryRealOnly" -> False},
Magnification:>1.5 Inherited,
FrontEndVersion->"13.1 for Mac OS X ARM (64-bit) (June 16, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"a6ccc10e-d63f-42dc-8cb4-736dc525cd0d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 678, 15, 138, "Subtitle",ExpressionUUID->"85bcbaea-da79-47a9-8841-3e5fd17331cb"],
Cell[1261, 39, 588, 17, 89, "Text",ExpressionUUID->"972199aa-7d14-4887-b813-b221dd610ba3",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1874, 60, 227, 4, 81, "Subsection",ExpressionUUID->"16834aeb-6dc8-44ad-b1a3-534a9027c016"],
Cell[CellGroupData[{
Cell[2126, 68, 165, 3, 67, "Subsubsection",ExpressionUUID->"bf937a19-27d2-4354-aaf4-706dd50f00fe"],
Cell[2294, 73, 19869, 443, 1726, "Input",ExpressionUUID->"8c845484-fbdb-440b-9c72-f8615d0ef9dd",
 InitializationCell->True],
Cell[22166, 518, 6515, 107, 133, "Input",ExpressionUUID->"4f22d022-b777-4da8-bee6-99a5ec583125",
 InitializationCell->True],
Cell[28684, 627, 5931, 86, 70, "Input",ExpressionUUID->"f2a61410-9d2d-4663-9dde-d0f4096b7917",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[34652, 718, 159, 3, 67, "Subsubsection",ExpressionUUID->"7ef52e73-a8a0-414d-bc87-366b20317915"],
Cell[34814, 723, 16952, 424, 1555, "Input",ExpressionUUID->"8993ef5f-aa5a-4840-baed-a3ef0d44ff0c",
 InitializationCell->True],
Cell[51769, 1149, 2122, 48, 133, "Input",ExpressionUUID->"07001438-fc15-4819-b89d-bdc34fe5fe08",
 InitializationCell->True],
Cell[53894, 1199, 1093, 27, 102, "Input",ExpressionUUID->"c1f8ba6c-be24-45f4-8e20-fdef409918cf",
 InitializationCell->True],
Cell[54990, 1228, 719, 16, 70, "Input",ExpressionUUID->"339cc039-9676-4aeb-a571-7f0325e2b968",
 InitializationCell->True],
Cell[55712, 1246, 16687, 409, 1132, "Input",ExpressionUUID->"32b1e47c-a4b0-4d8a-9e85-6e3c67104036",
 InitializationCell->True],
Cell[72402, 1657, 1989, 40, 133, "Input",ExpressionUUID->"ad230d05-71dc-4410-9588-11c4a3edf72a",
 InitializationCell->True],
Cell[74394, 1699, 1998, 52, 195, "Input",ExpressionUUID->"ba8d8622-4acf-4c36-b8a8-aa0ed56046f2",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[76429, 1756, 164, 3, 67, "Subsubsection",ExpressionUUID->"8a19a71f-2c87-4dfe-acc9-c9c236223541"],
Cell[76596, 1761, 9261, 227, 1106, "Input",ExpressionUUID->"2eb269a6-aef2-4b4e-8628-13f5f2b3580e",
 InitializationCell->True],
Cell[85860, 1990, 1657, 42, 133, "Input",ExpressionUUID->"95e1a0c5-c9eb-4ca7-9e7f-3856f08472a4",
 InitializationCell->True],
Cell[87520, 2034, 914, 17, 70, "Input",ExpressionUUID->"d10d3fd9-6c76-4c1b-8fdf-b51a0e619353",
 InitializationCell->True],
Cell[88437, 2053, 5862, 134, 800, "Input",ExpressionUUID->"cb85c9b5-7fe9-4532-8127-bd402ce00fed",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[94336, 2192, 169, 3, 53, "Subsubsection",ExpressionUUID->"5a03dbae-22f6-4134-950d-a2d224cabd7f"],
Cell[94508, 2197, 8671, 228, 1100, "Input",ExpressionUUID->"fe9c22e8-f27d-42e2-b49a-0961909f16b1",
 InitializationCell->True],
Cell[103182, 2427, 1308, 37, 133, "Input",ExpressionUUID->"335cf137-7340-428e-8052-7ac34a2543da",
 InitializationCell->True],
Cell[104493, 2466, 568, 12, 70, "Input",ExpressionUUID->"ee7184fa-6857-44f7-8653-a7c236d8b1f1",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[105098, 2483, 219, 4, 53, "Subsubsection",ExpressionUUID->"b9d05c5d-92b3-4aa7-ac20-4d8106c063a7"],
Cell[105320, 2489, 19483, 531, 2667, "Input",ExpressionUUID->"fe0b4360-e270-4fdc-aaf1-d0efddd3c958",
 InitializationCell->True]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[124852, 3026, 210, 4, 55, "Subsection",ExpressionUUID->"86b1f668-e169-4b17-a61c-a53b2d76c76a"],
Cell[CellGroupData[{
Cell[125087, 3034, 382, 11, 68, "Subsubsection",ExpressionUUID->"ddbfbf95-e699-4310-ac22-3ca21f7da378"],
Cell[125472, 3047, 2667, 69, 334, "Input",ExpressionUUID->"52a5c363-57b5-4f43-92d6-007efce1bc98"]
}, Closed]],
Cell[CellGroupData[{
Cell[128176, 3121, 438, 11, 54, "Subsubsection",ExpressionUUID->"e400a94b-50e9-4a76-9b3f-7b27548d0b58"],
Cell[128617, 3134, 3398, 76, 273, "Input",ExpressionUUID->"be4390f1-80cd-4645-8f77-51169d87dec9"]
}, Closed]],
Cell[CellGroupData[{
Cell[132052, 3215, 311, 5, 53, "Subsubsection",ExpressionUUID->"99db847d-8409-429b-a999-e56108e9aafa"],
Cell[132366, 3222, 4577, 99, 698, "Input",ExpressionUUID->"f86fa1e1-9ccf-4d85-b2c6-d98abf7c18f6"]
}, Closed]],
Cell[CellGroupData[{
Cell[136980, 3326, 353, 6, 53, "Subsubsection",ExpressionUUID->"70471d8d-9051-45ec-b1bf-98b5dbc06736"],
Cell[137336, 3334, 3827, 85, 359, "Input",ExpressionUUID->"f61fd84f-76b3-4026-a36f-2db6bd32ce3e"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[141212, 3425, 281, 4, 81, "Subsection",ExpressionUUID->"471f9e0e-9fd6-41aa-88e7-07f9cf41fd74"],
Cell[CellGroupData[{
Cell[141518, 3433, 164, 3, 67, "Subsubsection",ExpressionUUID->"4241d1b9-6af5-44b4-8bca-4bf29d0c6b6e"],
Cell[141685, 3438, 3597, 76, 209, "Input",ExpressionUUID->"d47f2d2d-d412-4165-a857-008bf648df85"],
Cell[145285, 3516, 1957, 46, 202, "Input",ExpressionUUID->"8af3d2f2-481f-4b92-87fc-911d38acc3fe"],
Cell[147245, 3564, 2276, 54, 149, "Input",ExpressionUUID->"0583762d-6a2c-4743-829f-49831259bc0b"],
Cell[149524, 3620, 2193, 58, 158, "Input",ExpressionUUID->"96cd8e0f-a2b3-4cd7-a909-e1ef93fabc14"],
Cell[151720, 3680, 1843, 53, 263, "Input",ExpressionUUID->"25d2edc8-bba5-46cd-b9c0-42e2ba3ad368"],
Cell[153566, 3735, 1714, 52, 178, "Input",ExpressionUUID->"b57f2315-6a47-4e3b-ae1f-9a8347fb422c"],
Cell[155283, 3789, 2996, 81, 388, "Input",ExpressionUUID->"7d178f7e-6901-4b9d-a916-d71c597080ed"],
Cell[158282, 3872, 169, 3, 53, "Text",ExpressionUUID->"e94f44fa-0464-4dc8-807f-8cdfcc7631a2"],
Cell[158454, 3877, 1313, 32, 140, "Input",ExpressionUUID->"02310316-9c35-41d9-bb69-c3be73d4728d"],
Cell[159770, 3911, 620, 12, 46, "Input",ExpressionUUID->"c2b09f99-11c2-4cfc-8f37-6265e4d084ea"]
}, Closed]],
Cell[CellGroupData[{
Cell[160427, 3928, 217, 4, 53, "Subsubsection",ExpressionUUID->"7342a176-fb88-4a7e-aa53-ccd7ffc4c5c0"],
Cell[160647, 3934, 2170, 55, 209, "Input",ExpressionUUID->"0870effe-ba71-4e8d-a338-a94599cb3c53"],
Cell[162820, 3991, 2186, 45, 233, "Input",ExpressionUUID->"86a12c82-eff1-4ff0-aec9-df6d82e127e9"],
Cell[165009, 4038, 2274, 55, 184, "Input",ExpressionUUID->"5d7730f4-65a9-493b-aa98-8da6183930da"],
Cell[167286, 4095, 3229, 85, 419, "Input",ExpressionUUID->"2f506285-d9ef-4390-a2ff-000ce71b54d0"],
Cell[170518, 4182, 2568, 68, 202, "Input",ExpressionUUID->"380db273-ef0e-45ac-b297-98c9101f331b"],
Cell[173089, 4252, 203, 3, 46, "Input",ExpressionUUID->"76b3bdbd-d9b3-47ec-9a44-86a04c64f3ed"],
Cell[173295, 4257, 11543, 314, 1318, "Input",ExpressionUUID->"fd9c792f-35ec-48e1-b291-b18da3c1dd50"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[184887, 4577, 353, 6, 81, "Subsection",ExpressionUUID->"42be8376-f0f2-4b79-bb81-4a8cf0180f54"],
Cell[185243, 4585, 861, 25, 103, "Input",ExpressionUUID->"30e28d13-0011-4c63-b464-e774bfeff1ca"],
Cell[186107, 4612, 3423, 98, 264, "Input",ExpressionUUID->"8cf2fae8-270e-4a28-a140-485fe0664d0a"],
Cell[189533, 4712, 803, 25, 78, "Input",ExpressionUUID->"ea2982b1-e944-4788-9db0-1d011b45637a"],
Cell[190339, 4739, 402, 10, 46, "Input",ExpressionUUID->"ce42a0d1-3bb3-4363-8fd4-766c194c994f"],
Cell[190744, 4751, 1385, 31, 109, "Input",ExpressionUUID->"61d1ca08-3170-4087-ab99-7ebe59064bec"],
Cell[192132, 4784, 2747, 77, 151, "Input",ExpressionUUID->"1c08b9e1-4ce5-42c6-a9a5-2eb68a53c78c"],
Cell[194882, 4863, 3258, 76, 171, "Input",ExpressionUUID->"eccefcd8-0462-408d-8534-92c1830c9c74"],
Cell[198143, 4941, 1008, 26, 109, "Input",ExpressionUUID->"8f664e38-44e6-4017-beb0-93af5306dbf6"],
Cell[199154, 4969, 24893, 544, 1675, "Input",ExpressionUUID->"9e92da8b-3a6f-4232-80ad-4aac9522e175"],
Cell[224050, 5515, 18800, 357, 1008, "Input",ExpressionUUID->"6f9d1ce0-6dc3-4f58-b637-504ebf65104b"],
Cell[242853, 5874, 19580, 414, 1259, "Input",ExpressionUUID->"abd63ee3-fd32-475e-a8e5-7a0e80b721df"],
Cell[262436, 6290, 20863, 446, 1352, "Input",ExpressionUUID->"2b171f1a-9e36-4ac8-8300-79e464e27f52"]
}, Open  ]],
Cell[CellGroupData[{
Cell[283336, 6741, 398, 6, 81, "Subsection",ExpressionUUID->"49117bdc-ab77-4159-8667-916cd02a010c"],
Cell[283737, 6749, 6593, 168, 543, "Input",ExpressionUUID->"e0e5eeca-8ee6-465c-805e-e075833c129c"],
Cell[290333, 6919, 813, 22, 112, "Input",ExpressionUUID->"a2e5d6a7-4025-46d0-9533-cce607299c6f"],
Cell[291149, 6943, 1104, 26, 46, "Input",ExpressionUUID->"3d8ddd2c-b4ac-443e-a207-09d5f816007f"],
Cell[292256, 6971, 703, 18, 46, "Input",ExpressionUUID->"7bca24e4-a67f-4bb9-bc98-50ff0fc9a1ef"],
Cell[292962, 6991, 1687, 42, 109, "Input",ExpressionUUID->"a01e2b63-80bb-49d6-a5f8-2f8943890a36"],
Cell[294652, 7035, 1327, 40, 112, "Input",ExpressionUUID->"08165883-7568-439f-81d9-de138afe44cf"],
Cell[295982, 7077, 1676, 53, 81, "Input",ExpressionUUID->"fe1e313c-38bd-4a68-aa83-73a53096a910"],
Cell[297661, 7132, 2875, 59, 235, "Input",ExpressionUUID->"f942659e-6621-49ba-9c08-cbe017c8fb1e"],
Cell[300539, 7193, 5450, 128, 419, "Input",ExpressionUUID->"6b3cf5e4-61f5-4f83-8d1b-bdb9a534f25d"]
}, Open  ]]
}, Open  ]]
}
]
*)

