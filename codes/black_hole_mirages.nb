(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    210109,       5172]
NotebookOptionsPosition[    201995,       5034]
NotebookOutlinePosition[    202514,       5053]
CellTagsIndexPosition[    202471,       5050]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 ButtonBox[
  RowBox[{"Black", " ", "Hole", " ", 
   RowBox[{"Mirages", ":", " ", 
    RowBox[{
    "electron", " ", "lensing", " ", "and", " ", "Berry", " ", "curvature", 
     " ", "effects", " ", "in", " ", "inhomogeneously", " ", "tilted", " ", 
     "Weyl", " ", "semimetals"}]}]}],
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://arxiv.org/abs/2210.16254"], None},
  ButtonNote->"https://arxiv.org/abs/2210.16254"]], "Subtitle",
 CellChangeTimes->{{3.876372690381579*^9, 3.87637269737879*^9}, {
  3.876372767311132*^9, 3.876372805634338*^9}, {3.876372903415181*^9, 
  3.87637290525632*^9}},ExpressionUUID->"85bcbaea-da79-47a9-8841-\
3e5fd17331cb"],

Cell[TextData[{
 "Andreas ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["Haller", "*"], TraditionalForm]],ExpressionUUID->
  "219cf1b3-2d59-466a-abf7-c03e5d96bcf2"],
 ", Suraj Hegde, Chen Xu, Christophe De Beule, Thomas L. Schmidt, Tobias Meng\
\n* ",
 ButtonBox["andreas.haller@uni.lu",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["mailto:andreas.haller@uni.lu"], None},
  ButtonNote->"mailto:andreas.haller@uni.lu"]
}], "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.87637281627984*^9, 
  3.876372889055265*^9}},ExpressionUUID->"972199aa-7d14-4887-b813-\
b221dd610ba3"],

Cell[CellGroupData[{

Cell["Auxiliary Functions and Modules", "Subsection",
 CellChangeTimes->{{3.8762116731676607`*^9, 3.87621168019105*^9}, {
  3.8763726780972*^9, 
  3.876372683856434*^9}},ExpressionUUID->"16834aeb-6dc8-44ad-b1a3-\
534a9027c016"],

Cell[CellGroupData[{

Cell["SEOM Solutions", "Subsubsection",
 CellChangeTimes->{{3.876278450395162*^9, 
  3.876278455223147*^9}},ExpressionUUID->"bf937a19-27d2-4354-aaf4-\
706dd50f00fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"some", " ", "auxiliary", " ", "functions"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "norm", ",", "hat", ",", "\[Rho]", ",", "\[Rho]s", ",", "v", ",", 
     "\[Alpha]", ",", "r"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"norm", "[", "v_", "]"}], ":=", 
     SqrtBox[
      RowBox[{"v", ".", "v"}]]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"convenient", " ", "norm"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"hat", "[", "v_", "]"}], ":=", 
     FractionBox["v", 
      RowBox[{"norm", "[", "v", "]"}]]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"unit", " ", "vector"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Rho]", "[", "v_", "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"v", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"0", 
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"sph", "."}], "\[TwoWayRule]", 
     RowBox[{
      RowBox[{
       RowBox[{"cyl", "."}], " ", ":", " ", 
       RowBox[{"0", 
        RowBox[{"v", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], " ", "\[TwoWayRule]", " ", 
      RowBox[{"v", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Rho]s", "[", 
      RowBox[{"r_", ",", "\[Alpha]_"}], "]"}], ":=", 
     RowBox[{"r", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
       FractionBox["1", 
        RowBox[{"2", " ", "\[Alpha]"}]]]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{
    "L", ",", "spin", ",", "J", ",", " ", "xv", ",", "kv", ",", "\[Chi]"}], 
    "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"L", "[", 
      RowBox[{"xv_", ",", "kv_"}], "]"}], ":=", 
     RowBox[{"xv", "\[Cross]", "kv"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"angular", " ", "momentum"}], " ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"spin", "[", 
      RowBox[{"\[Chi]_", ",", "kv_"}], "]"}], ":=", 
     RowBox[{
      FractionBox["\[Chi]", "2"], 
      RowBox[{"hat", "[", "kv", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"J", "[", 
      RowBox[{"\[Chi]_", ",", "xv_", ",", "kv_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"L", "[", 
       RowBox[{"xv", ",", "kv"}], "]"}], "+", 
      RowBox[{"spin", "[", 
       RowBox[{"\[Chi]", ",", "kv"}], "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"total", " ", "angular", " ", "momentum"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{
    "u", ",", "r", ",", "vF", ",", "rt", ",", "r", ",", "\[Alpha]", ",", 
     "v"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"u", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "r_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"-", "vF"}], 
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox["rt", "r"], ")"}], "\[Alpha]"]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"scalar", " ", "part", " ", "of", " ", "the", " ", "tilt"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"uv", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "v_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"u", "[", 
       RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
        RowBox[{"norm", "[", 
         RowBox[{"\[Rho]", "[", "v", "]"}], "]"}]}], "]"}], "*", 
      RowBox[{"hat", "[", 
       RowBox[{"\[Rho]", "[", "v", "]"}], "]"}]}]}], ";"}], " ", 
   RowBox[{"(*", " ", "tilt", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalOmega]", "[", 
      RowBox[{"\[Chi]_", ",", "v_"}], "]"}], ":=", 
     RowBox[{
      FractionBox[
       RowBox[{"\[Chi]", " "}], "2"], 
      FractionBox["v", 
       SuperscriptBox[
        RowBox[{"norm", "[", "v", "]"}], "3"]]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"Berry", " ", "curvature"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "[", 
      RowBox[{"\[Alpha]_", ",", "vF_", ",", "rt_", ",", "xs_", ",", "ks_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"uv", "[", 
        RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
         RowBox[{"\[Rho]", "[", "xs", "]"}]}], "]"}], ".", "ks"}], "+", 
      RowBox[{"vF", "*", 
       RowBox[{"norm", "[", "ks", "]"}]}]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"energy", " ", "dispersion"}], " ", "*)"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "the", " ", "main", " ", "module", " ", "for", " ", "solving", " ", "the",
      " ", "SEOM"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Clear", "[", 
    RowBox[{
    "solveSEOM", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", "\[Alpha]", 
     ",", "\[Chi]", ",", "ti", ",", "tf", ",", "t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"solveSEOM", "[", 
      RowBox[{
      "s_", ",", "x0_", ",", "k0_", ",", "vF_", ",", "rt_", ",", "\[Alpha]_", 
       ",", "\[Chi]_", ",", 
       RowBox[{"ti_", ":", 
        RowBox[{"-", "20"}]}], ",", 
       RowBox[{"tf_", ":", "20"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "define", " ", "variables", " ", "in", " ", "module", " ", "scope"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "xv", ",", "kv", ",", " ", "r", ",", "x", ",", "y", ",", "z", ",", 
         "kx", ",", "ky", ",", "kz", ",", "eq1", ",", "eq2", ",", "eq3", ",", 
         "eq4", ",", " ", "problem", ",", " ", "solution", ",", "xvs", ",", 
         "kvs", ",", "tstop", ",", "return", ",", "t"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"module", " ", "body"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"xv", "[", "t_", "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "[", "t", "]"}], ",", 
           RowBox[{"y", "[", "t", "]"}], ",", 
           RowBox[{"z", "[", "t", "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"kv", "[", "t_", "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"kx", "[", "t", "]"}], ",", 
           RowBox[{"ky", "[", "t", "]"}], ",", 
           RowBox[{"kz", "[", "t", "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"eq1", "[", "t_", "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"xv", "'"}], "[", "t", "]"}], "\[Equal]", 
           RowBox[{
            RowBox[{"+", 
             RowBox[{"D", "[", 
              RowBox[{
               RowBox[{"\[Epsilon]", "[", 
                RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
                 RowBox[{"xv", "[", "t", "]"}], ",", 
                 RowBox[{"kv", "[", "t", "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"kv", "[", "t", "]"}], ",", "1"}], "}"}]}], "]"}]}], 
            "+", 
            RowBox[{
             RowBox[{
              RowBox[{"kv", "'"}], "[", "t", "]"}], "\[Cross]", 
             RowBox[{"\[CapitalOmega]", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"kv", "[", "t", "]"}]}], "]"}]}]}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"eq2", "[", "t_", "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"kv", "'"}], "[", "t", "]"}], "\[Equal]", 
           RowBox[{"-", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{"\[Epsilon]", "[", 
               RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
                RowBox[{"xv", "[", "t", "]"}], ",", 
                RowBox[{"kv", "[", "t", "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"xv", "[", "t", "]"}], ",", "1"}], "}"}]}], "]"}]}]}],
           ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"set", " ", "initial", " ", "conditions"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"eq4", ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"kv", "[", "0", "]"}], "\[Equal]", "k0"}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eq3", ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"xv", "[", "0", "]"}], "\[Equal]", "x0"}], ")"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"combine", " ", "the", " ", 
          RowBox[{"eq", "'"}], "s", " ", "defined", " ", "above", " ", "with",
           " ", "a", " ", "stopping", " ", "criterion"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tstop", "=", "\[Infinity]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"problem", "[", "t_", "]"}], ":=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "j"}], "]"}], "]"}], "\[Equal]", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "j"}], "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "&"}], "/@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"eq1", "[", "t", "]"}], ",", 
               RowBox[{"eq2", "[", "t", "]"}], ",", "eq3", ",", "eq4"}], 
              "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"WhenEvent", "[", 
             RowBox[{
              RowBox[{
               SqrtBox[
                RowBox[{
                 SuperscriptBox[
                  RowBox[{
                   RowBox[{"x", "'"}], "[", "t", "]"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{
                   RowBox[{"y", "'"}], "[", "t", "]"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{
                   RowBox[{"z", "'"}], "[", "t", "]"}], "2"]}]], 
               "\[GreaterEqual]", "5"}], ",", 
              RowBox[{
               RowBox[{"tstop", "=", "t"}], ";", 
               "\"\<StopIntegration\>\""}]}], "]"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "numerically", " ", "solve", " ", "the", " ", "coupled", " ", 
          "differential", " ", "equation"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"solution", "[", "t_", "]"}], "=", 
         RowBox[{"First", "[", 
          RowBox[{"NDSolve", "[", 
           RowBox[{
            RowBox[{"problem", "[", "t", "]"}], ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"xv", "[", "t", "]"}], ",", 
               RowBox[{"kv", "[", "t", "]"}]}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"t", ",", "ti", ",", "tf"}], "}"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "this", " ", "might", " ", "not", " ", "catch", " ", "all", " ", 
           "errors"}], ",", " ", 
          RowBox[{"but", " ", 
           RowBox[{"it", "'"}], "ll", " ", "do", " ", "for", " ", "the", " ", 
           "examples", " ", "in", " ", "this", " ", "notebook"}]}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tstop", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"{", 
           RowBox[{"tstop", ",", "tf"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"tstop", "<", "tf"}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<WATCHOUT: tstop=\>\"", "<>", 
            RowBox[{"ToString", "[", "tstop", "]"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"return", "[", "t_", "]"}], ":=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"xv", "[", "t", "]"}], "/.", 
            RowBox[{"solution", "[", "t", "]"}]}], ",", " ", 
           RowBox[{
            RowBox[{"kv", "[", "t", "]"}], "/.", 
            RowBox[{"solution", "[", "t", "]"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "return", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"return", "[", "s", "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8753718139163637`*^9, 3.87537248883603*^9}, {
   3.875372521731038*^9, 3.875372598948813*^9}, {3.875372638071093*^9, 
   3.875372667444627*^9}, {3.875372723166608*^9, 3.875372725279752*^9}, {
   3.875372775786047*^9, 3.875372839413402*^9}, {3.87537298938726*^9, 
   3.875372996196085*^9}, {3.875373266701687*^9, 3.875373269475806*^9}, {
   3.8753740342706327`*^9, 3.875374062303205*^9}, {3.875374107478236*^9, 
   3.875374129561631*^9}, {3.8753742235618763`*^9, 3.875374288559656*^9}, {
   3.8753745212889833`*^9, 3.8753745214028177`*^9}, {3.8753745527154493`*^9, 
   3.8753745541002493`*^9}, {3.87537468585247*^9, 3.875374737670253*^9}, {
   3.8753749416599703`*^9, 3.875374942554412*^9}, {3.8753749973764257`*^9, 
   3.8753750783600807`*^9}, {3.875385775677775*^9, 3.8753860496047564`*^9}, {
   3.87538609156984*^9, 3.875386336073556*^9}, {3.8753867452336473`*^9, 
   3.875386763139112*^9}, 3.8753893224917*^9, 3.8753895341269903`*^9, {
   3.8753895909044533`*^9, 3.87538959120335*^9}, {3.875392584653295*^9, 
   3.875392610046296*^9}, {3.87539265307832*^9, 3.8753928085458117`*^9}, {
   3.875392870917982*^9, 3.875393012844138*^9}, {3.8753930547353086`*^9, 
   3.8753932657394238`*^9}, {3.875393308527615*^9, 3.8753934868131733`*^9}, {
   3.875393568798623*^9, 3.875393674799918*^9}, {3.87539373456922*^9, 
   3.875393906421476*^9}, {3.875394055285266*^9, 3.87539410019022*^9}, {
   3.875394147263425*^9, 3.875394218317411*^9}, {3.8754297523229313`*^9, 
   3.875429813412734*^9}, {3.875429913463326*^9, 3.8754299373395357`*^9}, {
   3.875610005315555*^9, 3.875610056741839*^9}, {3.875610418681381*^9, 
   3.875610418744589*^9}, 3.875610631099875*^9, {3.875610931587153*^9, 
   3.875610952400519*^9}, {3.875701282068931*^9, 3.875701335833992*^9}, {
   3.875701390734514*^9, 3.8757014500530787`*^9}, {3.8757014851493073`*^9, 
   3.875701490376498*^9}, {3.875701538720487*^9, 3.8757016382435913`*^9}, {
   3.875701682009058*^9, 3.875701738438554*^9}, {3.875701931633971*^9, 
   3.875702002830406*^9}, {3.875702037280258*^9, 3.875702180350152*^9}, {
   3.875702287017178*^9, 3.875702308255604*^9}, {3.8757175804769773`*^9, 
   3.8757176223524218`*^9}, 3.875717922657584*^9, {3.875719570359198*^9, 
   3.875719680025148*^9}, {3.875719970007078*^9, 3.875719989423703*^9}, {
   3.875720023744266*^9, 3.8757200836177692`*^9}, {3.87572011934797*^9, 
   3.875720188052978*^9}, {3.875720223638438*^9, 3.875720224402527*^9}, {
   3.876199546274818*^9, 3.87619958991718*^9}, {3.8762005183223143`*^9, 
   3.876200531014008*^9}, {3.876200562943416*^9, 3.876200571262085*^9}, {
   3.876200653525708*^9, 3.876200703673315*^9}, {3.87620085949335*^9, 
   3.8762008688634443`*^9}, {3.8762017617851057`*^9, 3.876202438947668*^9}, {
   3.8762025340809603`*^9, 3.8762025400643463`*^9}, {3.87620261709443*^9, 
   3.876202669832224*^9}, {3.8762027197741833`*^9, 3.876202730904736*^9}, {
   3.8762028556244097`*^9, 3.876202927107202*^9}, {3.876203001875944*^9, 
   3.876203043946033*^9}, {3.8762031327067633`*^9, 3.876203148035384*^9}, {
   3.8762032528849792`*^9, 3.876203262675536*^9}, {3.876209233851369*^9, 
   3.876209236504562*^9}, {3.8762112685729303`*^9, 3.876211309596569*^9}, {
   3.876211346880439*^9, 3.876211470947081*^9}, 3.876211731402624*^9, 
   3.876212046401372*^9, 3.8762121612878437`*^9, {3.876212215525592*^9, 
   3.876212247524146*^9}, {3.876212391383792*^9, 3.8762124905947*^9}, 
   3.876212543760313*^9, 3.876212765713426*^9, {3.876212959406522*^9, 
   3.876212959994162*^9}, {3.876213018074327*^9, 3.876213044438684*^9}, 
   3.876213090689808*^9, {3.8762132649719067`*^9, 3.876213276804166*^9}, 
   3.876214214167169*^9, {3.8762142974467373`*^9, 3.876214437745427*^9}, {
   3.876214667689506*^9, 3.876214721049564*^9}, {3.876214760241654*^9, 
   3.8762147721363792`*^9}, {3.876215351659543*^9, 3.876215417140147*^9}, {
   3.876215459066053*^9, 3.8762155730949163`*^9}, {3.876215612514304*^9, 
   3.87621574769133*^9}, 3.876216085475499*^9, {3.876216120107068*^9, 
   3.8762161246353683`*^9}, {3.876216664690085*^9, 3.876216665123727*^9}, {
   3.8762167172075768`*^9, 3.876216734773028*^9}, {3.876217319776656*^9, 
   3.8762173634314747`*^9}, {3.876278663197618*^9, 3.876278663752372*^9}, {
   3.876279664735392*^9, 3.876279675165155*^9}, {3.8762861288801317`*^9, 
   3.87628644839167*^9}, {3.8762969655162487`*^9, 3.876297027238597*^9}, {
   3.876372279038331*^9, 3.8763722834853373`*^9}, {3.876391067642168*^9, 
   3.876391091153441*^9}, {3.876391138881234*^9, 3.876391144434504*^9}, {
   3.876391224655499*^9, 3.876391228491456*^9}, {3.8763912902745333`*^9, 
   3.8763913010295277`*^9}, {3.8763913312444973`*^9, 3.876391350577849*^9}, {
   3.876391438056376*^9, 3.8763915012070007`*^9}, {3.876391578542211*^9, 
   3.8763915811039143`*^9}, {3.876391613774961*^9, 3.8763916138562803`*^9}, {
   3.876391678910523*^9, 3.8763916807994213`*^9}, {3.876391736937585*^9, 
   3.8763918200235233`*^9}, {3.876391873759432*^9, 3.876391893624824*^9}, {
   3.8763919738151417`*^9, 3.876391987899564*^9}, {3.87639211186754*^9, 
   3.87639214124658*^9}, {3.8763949285654497`*^9, 3.876395170928577*^9}, {
   3.876395805331493*^9, 3.876396028796269*^9}, {3.8763960600592833`*^9, 
   3.876396084704054*^9}, {3.876396254328445*^9, 3.876396257921694*^9}, {
   3.87639647434933*^9, 3.876396501191517*^9}, {3.876396618809451*^9, 
   3.8763966285658197`*^9}, {3.876396677693253*^9, 3.876396684601419*^9}, {
   3.876396743043913*^9, 3.876396743136544*^9}, {3.876396804582081*^9, 
   3.8763968432424593`*^9}, {3.8763984583003273`*^9, 3.87639848287786*^9}, {
   3.8763985186919928`*^9, 3.876398550987537*^9}, {3.8763986112464523`*^9, 
   3.876398611382667*^9}, {3.876398747694291*^9, 3.876398819063278*^9}, {
   3.876399485324885*^9, 3.8763994854302807`*^9}, {3.876408008268139*^9, 
   3.876408010272365*^9}, {3.876408043193219*^9, 3.876408050939942*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"8c845484-fbdb-440b-9c72-f8615d0ef9dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",", "\[Alpha]", ",", 
     "\[Chi]", ",", "ti", ",", "tf", ",", "\[Rho]t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "5"}], ",", "5"}], "}"}], "]"}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8753718139163637`*^9, 3.87537248883603*^9}, {
   3.875372521731038*^9, 3.875372598948813*^9}, {3.875372638071093*^9, 
   3.875372667444627*^9}, {3.875372723166608*^9, 3.875372725279752*^9}, {
   3.875372775786047*^9, 3.875372839413402*^9}, {3.87537298938726*^9, 
   3.875372996196085*^9}, {3.875373266701687*^9, 3.875373269475806*^9}, {
   3.8753740342706327`*^9, 3.875374062303205*^9}, {3.875374107478236*^9, 
   3.875374129561631*^9}, {3.8753742235618763`*^9, 3.875374288559656*^9}, {
   3.8753745212889833`*^9, 3.8753745214028177`*^9}, {3.8753745527154493`*^9, 
   3.8753745541002493`*^9}, {3.87537468585247*^9, 3.875374737670253*^9}, {
   3.8753749416599703`*^9, 3.875374942554412*^9}, {3.8753749973764257`*^9, 
   3.8753750783600807`*^9}, {3.875385775677775*^9, 3.8753860496047564`*^9}, {
   3.87538609156984*^9, 3.875386336073556*^9}, {3.8753867452336473`*^9, 
   3.875386763139112*^9}, 3.8753893224917*^9, 3.8753895341269903`*^9, {
   3.8753895909044533`*^9, 3.87538959120335*^9}, {3.875392584653295*^9, 
   3.875392610046296*^9}, {3.87539265307832*^9, 3.8753928085458117`*^9}, {
   3.875392870917982*^9, 3.875393012844138*^9}, {3.8753930547353086`*^9, 
   3.8753932657394238`*^9}, {3.875393308527615*^9, 3.8753934868131733`*^9}, {
   3.875393568798623*^9, 3.875393674799918*^9}, {3.87539373456922*^9, 
   3.875393906421476*^9}, {3.875394055285266*^9, 3.87539410019022*^9}, {
   3.875394147263425*^9, 3.875394218317411*^9}, {3.8754297523229313`*^9, 
   3.875429813412734*^9}, {3.875429913463326*^9, 3.8754299373395357`*^9}, {
   3.875610005315555*^9, 3.875610056741839*^9}, {3.875610418681381*^9, 
   3.875610418744589*^9}, 3.875610631099875*^9, {3.875610931587153*^9, 
   3.875610952400519*^9}, {3.875701282068931*^9, 3.875701335833992*^9}, {
   3.875701390734514*^9, 3.8757014500530787`*^9}, {3.8757014851493073`*^9, 
   3.875701490376498*^9}, {3.875701538720487*^9, 3.8757016382435913`*^9}, {
   3.875701682009058*^9, 3.875701738438554*^9}, {3.875701931633971*^9, 
   3.875702002830406*^9}, {3.875702037280258*^9, 3.875702180350152*^9}, {
   3.875702287017178*^9, 3.875702308255604*^9}, {3.8757175804769773`*^9, 
   3.8757176223524218`*^9}, 3.875717922657584*^9, {3.875719570359198*^9, 
   3.875719680025148*^9}, {3.875719970007078*^9, 3.875719989423703*^9}, {
   3.875720023744266*^9, 3.8757200836177692`*^9}, {3.87572011934797*^9, 
   3.875720188052978*^9}, {3.875720223638438*^9, 3.875720224402527*^9}, {
   3.876199546274818*^9, 3.87619958991718*^9}, {3.8762005183223143`*^9, 
   3.876200531014008*^9}, {3.876200562943416*^9, 3.876200571262085*^9}, {
   3.876200653525708*^9, 3.876200703673315*^9}, {3.87620085949335*^9, 
   3.8762008688634443`*^9}, {3.8762017617851057`*^9, 3.876202438947668*^9}, {
   3.8762025340809603`*^9, 3.8762025400643463`*^9}, {3.87620261709443*^9, 
   3.876202669832224*^9}, {3.8762027197741833`*^9, 3.876202730904736*^9}, {
   3.8762028556244097`*^9, 3.876202927107202*^9}, {3.876203001875944*^9, 
   3.876203043946033*^9}, {3.8762031327067633`*^9, 3.876203148035384*^9}, {
   3.8762032528849792`*^9, 3.876203262675536*^9}, {3.876209233851369*^9, 
   3.876209236504562*^9}, {3.8762112685729303`*^9, 3.876211309596569*^9}, {
   3.876211346880439*^9, 3.876211470947081*^9}, 3.876211731402624*^9, 
   3.876212046401372*^9, 3.8762121612878437`*^9, {3.876212215525592*^9, 
   3.876212247524146*^9}, {3.876212391383792*^9, 3.8762124905947*^9}, 
   3.876212543760313*^9, 3.876212765713426*^9, {3.876212959406522*^9, 
   3.876212959994162*^9}, {3.876213018074327*^9, 3.876213044438684*^9}, 
   3.876213090689808*^9, {3.8762132649719067`*^9, 3.876213276804166*^9}, 
   3.876214214167169*^9, {3.8762142974467373`*^9, 3.876214437745427*^9}, {
   3.876214667689506*^9, 3.876214721049564*^9}, {3.876214760241654*^9, 
   3.8762147721363792`*^9}, {3.876215351659543*^9, 3.876215417140147*^9}, {
   3.876215459066053*^9, 3.8762155730949163`*^9}, {3.876215612514304*^9, 
   3.87621574769133*^9}, 3.876216085475499*^9, {3.876216120107068*^9, 
   3.8762161246353683`*^9}, {3.876216664690085*^9, 3.876216665123727*^9}, {
   3.8762167172075768`*^9, 3.876216734773028*^9}, {3.876217319776656*^9, 
   3.8762173634314747`*^9}, {3.876278663197618*^9, 3.876278663752372*^9}, {
   3.876279664735392*^9, 3.876279675165155*^9}, {3.8762861288801317`*^9, 
   3.87628644839167*^9}, {3.8762969655162487`*^9, 3.876297027238597*^9}, {
   3.876372279038331*^9, 3.8763722834853373`*^9}, {3.876391067642168*^9, 
   3.876391091153441*^9}, {3.876391138881234*^9, 3.876391144434504*^9}, {
   3.876391224655499*^9, 3.876391228491456*^9}, {3.8763912902745333`*^9, 
   3.8763913010295277`*^9}, {3.8763913312444973`*^9, 3.876391350577849*^9}, {
   3.876391438056376*^9, 3.8763915012070007`*^9}, {3.876391578542211*^9, 
   3.8763915811039143`*^9}, {3.876391613774961*^9, 3.8763916138562803`*^9}, {
   3.876391678910523*^9, 3.8763916807994213`*^9}, {3.876391736937585*^9, 
   3.8763918200235233`*^9}, {3.876391873759432*^9, 3.876391893624824*^9}, {
   3.8763919738151417`*^9, 3.876391987899564*^9}, {3.87639211186754*^9, 
   3.87639214124658*^9}, {3.8763949285654497`*^9, 3.876395170928577*^9}, {
   3.876395805331493*^9, 3.876396028796269*^9}, {3.8763960600592833`*^9, 
   3.876396060442668*^9}, {3.876396104472725*^9, 3.876396109291532*^9}, {
   3.876396278380163*^9, 3.876396281581484*^9}, {3.8763963225950413`*^9, 
   3.876396323685813*^9}, {3.8763985818779173`*^9, 3.876398587080241*^9}, {
   3.8764081157731743`*^9, 3.8764081527830763`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"4f22d022-b777-4da8-bee6-99a5ec583125"],

Cell[BoxData[
 RowBox[{
  RowBox[{"solveSEOM", "[", 
   RowBox[{"s", ",", "x0", ",", "k0", ",", 
    RowBox[{"vF", "=", "1"}], ",", 
    RowBox[{"\[Rho]t", "=", "1"}], ",", 
    RowBox[{"\[Alpha]", "=", 
     RowBox[{"1", "/", "2"}]}], ",", 
    RowBox[{"\[Chi]", "=", 
     RowBox[{"+", "1"}]}]}], "]"}], "//", "AbsoluteTiming"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8753718139163637`*^9, 3.87537248883603*^9}, {
   3.875372521731038*^9, 3.875372598948813*^9}, {3.875372638071093*^9, 
   3.875372667444627*^9}, {3.875372723166608*^9, 3.875372725279752*^9}, {
   3.875372775786047*^9, 3.875372839413402*^9}, {3.87537298938726*^9, 
   3.875372996196085*^9}, {3.875373266701687*^9, 3.875373269475806*^9}, {
   3.8753740342706327`*^9, 3.875374062303205*^9}, {3.875374107478236*^9, 
   3.875374129561631*^9}, {3.8753742235618763`*^9, 3.875374288559656*^9}, {
   3.8753745212889833`*^9, 3.8753745214028177`*^9}, {3.8753745527154493`*^9, 
   3.8753745541002493`*^9}, {3.87537468585247*^9, 3.875374737670253*^9}, {
   3.8753749416599703`*^9, 3.875374942554412*^9}, {3.8753749973764257`*^9, 
   3.8753750783600807`*^9}, {3.875385775677775*^9, 3.8753860496047564`*^9}, {
   3.87538609156984*^9, 3.875386336073556*^9}, {3.8753867452336473`*^9, 
   3.875386763139112*^9}, 3.8753893224917*^9, 3.8753895341269903`*^9, {
   3.8753895909044533`*^9, 3.87538959120335*^9}, {3.875392584653295*^9, 
   3.875392610046296*^9}, {3.87539265307832*^9, 3.8753928085458117`*^9}, {
   3.875392870917982*^9, 3.875393012844138*^9}, {3.8753930547353086`*^9, 
   3.8753932657394238`*^9}, {3.875393308527615*^9, 3.8753934868131733`*^9}, {
   3.875393568798623*^9, 3.875393674799918*^9}, {3.87539373456922*^9, 
   3.875393906421476*^9}, {3.875394055285266*^9, 3.87539410019022*^9}, {
   3.875394147263425*^9, 3.875394218317411*^9}, {3.8754297523229313`*^9, 
   3.875429813412734*^9}, {3.875429913463326*^9, 3.8754299373395357`*^9}, {
   3.875610005315555*^9, 3.875610056741839*^9}, {3.875610418681381*^9, 
   3.875610418744589*^9}, 3.875610631099875*^9, {3.875610931587153*^9, 
   3.875610952400519*^9}, {3.875701282068931*^9, 3.875701335833992*^9}, {
   3.875701390734514*^9, 3.8757014500530787`*^9}, {3.8757014851493073`*^9, 
   3.875701490376498*^9}, {3.875701538720487*^9, 3.8757016382435913`*^9}, {
   3.875701682009058*^9, 3.875701738438554*^9}, {3.875701931633971*^9, 
   3.875702002830406*^9}, {3.875702037280258*^9, 3.875702180350152*^9}, {
   3.875702287017178*^9, 3.875702308255604*^9}, {3.8757175804769773`*^9, 
   3.8757176223524218`*^9}, 3.875717922657584*^9, {3.875719570359198*^9, 
   3.875719680025148*^9}, {3.875719970007078*^9, 3.875719989423703*^9}, {
   3.875720023744266*^9, 3.8757200836177692`*^9}, {3.87572011934797*^9, 
   3.875720188052978*^9}, {3.875720223638438*^9, 3.875720224402527*^9}, {
   3.876199546274818*^9, 3.87619958991718*^9}, {3.8762005183223143`*^9, 
   3.876200531014008*^9}, {3.876200562943416*^9, 3.876200571262085*^9}, {
   3.876200653525708*^9, 3.876200703673315*^9}, {3.87620085949335*^9, 
   3.8762008688634443`*^9}, {3.8762017617851057`*^9, 3.876202438947668*^9}, {
   3.8762025340809603`*^9, 3.8762025400643463`*^9}, {3.87620261709443*^9, 
   3.876202669832224*^9}, {3.8762027197741833`*^9, 3.876202730904736*^9}, {
   3.8762028556244097`*^9, 3.876202927107202*^9}, {3.876203001875944*^9, 
   3.876203043946033*^9}, {3.8762031327067633`*^9, 3.876203148035384*^9}, {
   3.8762032528849792`*^9, 3.876203262675536*^9}, {3.876209233851369*^9, 
   3.876209236504562*^9}, {3.8762112685729303`*^9, 3.876211309596569*^9}, {
   3.876211346880439*^9, 3.876211470947081*^9}, 3.876211731402624*^9, 
   3.876212046401372*^9, 3.8762121612878437`*^9, {3.876212215525592*^9, 
   3.876212247524146*^9}, {3.876212391383792*^9, 3.8762124905947*^9}, 
   3.876212543760313*^9, 3.876212765713426*^9, {3.876212959406522*^9, 
   3.876212959994162*^9}, {3.876213018074327*^9, 3.876213044438684*^9}, 
   3.876213090689808*^9, {3.8762132649719067`*^9, 3.876213276804166*^9}, 
   3.876214214167169*^9, {3.8762142974467373`*^9, 3.876214437745427*^9}, {
   3.876214667689506*^9, 3.876214721049564*^9}, {3.876214760241654*^9, 
   3.8762147721363792`*^9}, {3.876215351659543*^9, 3.876215417140147*^9}, {
   3.876215459066053*^9, 3.8762155730949163`*^9}, {3.876215612514304*^9, 
   3.87621574769133*^9}, 3.876216085475499*^9, {3.876216120107068*^9, 
   3.8762161246353683`*^9}, {3.876216664690085*^9, 3.876216665123727*^9}, {
   3.8762167172075768`*^9, 3.876216734773028*^9}, {3.876217319776656*^9, 
   3.8762173634314747`*^9}, {3.876278663197618*^9, 3.876278663752372*^9}, {
   3.876279664735392*^9, 3.876279675165155*^9}, {3.8762861288801317`*^9, 
   3.87628644839167*^9}, {3.8762969655162487`*^9, 3.876297027238597*^9}, {
   3.876372279038331*^9, 3.8763722834853373`*^9}, {3.876391067642168*^9, 
   3.876391091153441*^9}, {3.876391138881234*^9, 3.876391144434504*^9}, {
   3.876391224655499*^9, 3.876391228491456*^9}, {3.8763912902745333`*^9, 
   3.8763913010295277`*^9}, {3.8763913312444973`*^9, 3.876391350577849*^9}, {
   3.876391438056376*^9, 3.8763915012070007`*^9}, {3.876391578542211*^9, 
   3.8763915811039143`*^9}, {3.876391613774961*^9, 3.8763916138562803`*^9}, {
   3.876391678910523*^9, 3.8763916807994213`*^9}, {3.876391736937585*^9, 
   3.8763918200235233`*^9}, {3.876391873759432*^9, 3.876391893624824*^9}, {
   3.8763919738151417`*^9, 3.876391987899564*^9}, {3.87639211186754*^9, 
   3.87639214124658*^9}, {3.8763949285654497`*^9, 3.876395170928577*^9}, {
   3.876395805331493*^9, 3.876396028796269*^9}, {3.8763960600592833`*^9, 
   3.876396060442668*^9}, {3.876396104472725*^9, 3.876396109291532*^9}, {
   3.876396278380163*^9, 3.876396308989497*^9}, {3.876396702588406*^9, 
   3.876396726764045*^9}, 3.876396768085444*^9, {3.876396839058584*^9, 
   3.876396839140345*^9}, {3.876408097060121*^9, 3.8764081337103148`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"f2a61410-9d2d-4663-9dde-d0f4096b7917"]
}, Closed]],

Cell[CellGroupData[{

Cell["Plotting", "Subsubsection",
 CellChangeTimes->{{3.876278461749938*^9, 
  3.876278464783457*^9}},ExpressionUUID->"7ef52e73-a8a0-414d-bc87-\
366b20317915"],

Cell[BoxData[{
 RowBox[{"<<", "MaTeX`"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"Plot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"ParametricPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"LogLinearPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"LogLogPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"ListPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"ListLogLinearPlot", ",", 
    RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", 
    RowBox[{"ListLogLogPlot", ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Scientific\>\""}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "makePlots", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots", "[", 
    RowBox[{"xk_", ",", "\[Rho]t_", ",", "\[Alpha]_", ",", "\[Chi]_", ",", 
     RowBox[{"ti_", ":", 
      RowBox[{"-", "20"}]}], ",", 
     RowBox[{"tf_", ":", "20"}], ",", 
     RowBox[{"print_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "allPlots", ",", "photonSphere", ",", "photonCylinder", ",", "inset", 
       ",", "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", 
       "sPlot", ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ", ",", "t",
        ",", "tpr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"photonSphere", "=", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Sphere", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "#"}], "]"}], 
          "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"\[Rho]t", ",", 
           RowBox[{"\[Rho]t", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
             FractionBox["1", 
              RowBox[{"2", "\[Alpha]"}]]]}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"photonCylinder", "=", 
       RowBox[{"Graphics3D", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Cylinder", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"xk", "[", "#", "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "&"}], "/@", 
             RowBox[{"{", 
              RowBox[{"ti", ",", "tf"}], "}"}]}], ",", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
            FractionBox["1", 
             RowBox[{"2", "\[Alpha]"}]]]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\[Rho]", "[", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "\[Equal]", "1"}], ",", 
        RowBox[{"inset", "=", "photonSphere"}], ",", 
        RowBox[{"inset", "=", "photonCylinder"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"trajXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot3D", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"AxesLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
             "}"}]}], ",", 
           RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}], ",", 
         RowBox[{"Graphics3D", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"xk", "[", "t", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", "inset", ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{spatial trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajDTXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot3D", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", 
           RowBox[{"AxesLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
             "}"}]}]}], "]"}], ",", 
         RowBox[{"Graphics3D", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{velocity trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajKV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot3D", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", 
           RowBox[{"AxesLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
             "}"}]}]}], "]"}], ",", 
         RowBox[{"Graphics3D", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Tube", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"xk", "[", "t", "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{momentum trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"angMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"xk", "[", "t", "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", "\"\<L_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sPlot", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"spin", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Spin}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", "\"\<s_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"totAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"J", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{Total angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", "\"\<J_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtTotAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"J", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], ",", "tpr"}], "]"}],
            "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of total angular moment}\>\"", 
           "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot J_x\>\"", ",", "\"\<\\\\dot J_y\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtJLSZ", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"spin", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{
                   RowBox[{"xk", "[", "tpr", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"L", "[", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"xk", "[", "tpr", "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"J", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of z-components of $\\\\bf J$, \
$\\\\bf L$ and $\\\\bf S$}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot s_z\>\"", ",", "\"\<\\\\dot L_z\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"allPlots", "=", 
       RowBox[{"{", 
        RowBox[{
        "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", "sPlot",
          ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ"}], "}"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"print", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Print", "[", "#", "]"}], "&"}], "/@", "allPlots"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "allPlots"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQ/WQHg2TWwzeOPB6yxiB6xRZpaxAdxsXtCaIvej/1
AdHPYtKCQPTB+l8RIPqlhl4siD6s8z8RRC+Tz0kF0SrG8lkg+iyLRD6ItmF6
WQKiA7bI1ILoxPz9E0F0i/6yBSBaKlB1FYhmenwYTC8493A9iN51QnAviA76
9PIOiA5kMX8Covn/r1TNBdJCVjPUQbR+Zc+KPCBtbrJ8PYie5ruzvBhkH29D
DYguOVT7dDqQXjPpNZi24TruPxNIP//vFgSiL4l9X7EYSBubtq0B0Qaf/L+D
aI67R3iXAGlbi00yIPrO8RUKILrk/sUSEP3M27AURNub264F0SviDoBp+YXh
x0D0jDNp50C0wpIzhSuBtJ5bZRGI7g581wKiF7CLtIJoAPdu18Y=
  "],
 CellLabel->"In[20]:=",ExpressionUUID->"8993ef5f-aa5a-4840-baed-a3ef0d44ff0c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",", "\[Alpha]", ",", 
     "\[Chi]", ",", "ti", ",", "tf", ",", "\[Rho]t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"8", "+", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "5"}], ",", "5"}], "}"}], "]"}]}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762784720225697`*^9, 3.876278680915045*^9}, {
   3.876278744865803*^9, 3.8762788563450117`*^9}, {3.876278887165505*^9, 
   3.87627893119884*^9}, {3.876278983828095*^9, 3.876279017442494*^9}, {
   3.876279055974214*^9, 3.8762790833788633`*^9}, {3.8762791209749928`*^9, 
   3.876279160750586*^9}, {3.8762792072815228`*^9, 3.876279272897011*^9}, {
   3.876279437982346*^9, 3.8762795571933002`*^9}, {3.87627963316615*^9, 
   3.876279638121461*^9}, {3.876279679056473*^9, 3.8762797845557528`*^9}, {
   3.87628003931083*^9, 3.876280097719277*^9}, {3.876284717312385*^9, 
   3.8762847327570887`*^9}, {3.876287812389793*^9, 3.876287869225124*^9}, {
   3.876297661790721*^9, 3.876297700001625*^9}, {3.876372267929987*^9, 
   3.8763722713616543`*^9}, {3.8763751662199993`*^9, 3.876375186218738*^9}, {
   3.8763963597215357`*^9, 3.876396388193994*^9}, {3.876396986498314*^9, 
   3.8763971661519814`*^9}, {3.876397285569365*^9, 3.876397317274397*^9}, {
   3.876397990558527*^9, 3.876398012729558*^9}, 3.8764081584921017`*^9},
 CellLabel->"In[30]:=",ExpressionUUID->"07001438-fc15-4819-b89d-bdc34fe5fe08"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"fun", ",", "s"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{"s", ",", "x0", ",", "k0", ",", 
      RowBox[{"vF", "=", "1"}], ",", 
      RowBox[{"\[Rho]t", "=", "1"}], ",", 
      RowBox[{"\[Alpha]", "=", 
       RowBox[{"1", "/", "2"}]}], ",", 
      RowBox[{"\[Chi]", "=", 
       RowBox[{"+", "1"}]}]}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQ/WQHg2TWwzeOPB6yxiB6xRZpaxAdxsXtCaIvej/1
AdHPYtKCQPTB+l8RIPqlhl4siD6s8z8RRC+Tz0kF0SrG8lkg+iyLRD6ItmF6
WQKiA7bI1ILoxPz9E0F0i/6yBSBaKlB1FYhmenwYTC8493A9iN51QnAviA76
9PIOiA5kMX8Covn/r1TNBdJCVjPUQbR+Zc+KPCBtbrJ8PYie5ruzvBhkH29D
DYguOVT7dDqQXjPpNZi24TruPxNIP//vFgSiL4l9X7EYSBubtq0B0Qaf/L+D
aI67R3iXAGlbi00yIPrO8RUKILrk/sUSEH1g/4QKEJ2XWXwBRB+puAimZ92+
n7MSSMv4X88H0T9Pc5WC+RuMwTS3+qwaEH3mrH49iAYAd8TZ+A==
  "],
 CellLabel->"In[32]:=",ExpressionUUID->"c1f8ba6c-be24-45f4-8e20-fdef409918cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{"fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]"}], "]"}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQ/WQHg2TWwzeOPB6yxiB6xRZpaxAdxsXtCaIvej/1
AdHPYtKCQPTB+l8RIPqlhl4siD6s8z8RRC+Tz0kF0SrG8lkg+iyLRD6ItmF6
WQKiA7bI1ILoxPz9E0F0i/6yBSBaKlB1FYhmenwYTC8493A9iN51QnAviA76
9PIOiA5kMX8Covn/r1TNBdJCVjPUQbR+Zc+KPCBtbrJ8PYie5ruzvBhkH29D
DYguOVT7dDqQXjPpNZi24TruPxNIP//vFgSiL4l9X7EYSBubtq0B0Qaf/L+D
aI67R3iXAGlbi00yIPrO8RUKILrk/sUSEH1g/4QKEJ2XWXwBRM97cfQiiH7T
xF2yEkgXXpMD0wrbI+tAtMPWcjA9Y8mzVhAtsUGlDUQDAGv/2fc=
  "],
 CellLabel->"In[34]:=",ExpressionUUID->"339cc039-9676-4aeb-a571-7f0325e2b968"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "makePlots2D", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "xk", 
   ",", "ti", ",", "tf", ",", "ax1", ",", "ax2", ",", "print"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots2D", "[", 
    RowBox[{"xk_", ",", "\[Rho]t_", ",", "\[Alpha]_", ",", "\[Chi]_", ",", 
     RowBox[{"ti_", ":", 
      RowBox[{"-", "20"}]}], ",", 
     RowBox[{"tf_", ":", "20"}], ",", 
     RowBox[{"ax1_", ":", "1"}], ",", 
     RowBox[{"ax2_", ":", "2"}], ",", 
     RowBox[{"print_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "allPlots", ",", "photonSphere", ",", "photonCylinder", ",", "inset", 
       ",", "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", 
       "sPlot", ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ", ",", "t",
        ",", "tpr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"inset", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ax1", ",", "ax2"}], "}"}], "\[Equal]", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "||", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ax1", ",", "ax2"}], "}"}], "\[Equal]", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}]}], ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Opacity", "[", "0.3", "]"}], ",", 
              RowBox[{"Disk", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}], ",", "#"}], "]"}]}], "}"}], 
            "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{"\[Rho]t", ",", 
             RowBox[{"\[Rho]t", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "+", "\[Alpha]"}], ")"}], 
               FractionBox["1", 
                RowBox[{"2", "\[Alpha]"}]]]}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"xk", "[", "t", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
              "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}]}]}], "]"}], 
         ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Line", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"xk", "[", "t", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", "inset", ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{spatial trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajDTXV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
              "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}]}]}], "]"}], 
         ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Line", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"xk", "'"}], "[", "t", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{velocity trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trajKV", "=", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"ParametricPlot", "[", 
          RowBox[{
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"xk", "[", "t", "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
              "}"}], "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}]}]}], "]"}], 
         ",", 
         RowBox[{"Graphics", "[", 
          RowBox[{"Arrow", "[", 
           RowBox[{"Line", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"xk", "[", "t", "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"ax1", ",", "ax2"}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox[
                   RowBox[{"tf", "+", "ti"}], "2"], ",", 
                  RowBox[{
                   FractionBox[
                    RowBox[{"tf", "+", "ti"}], "2"], "+", 
                   RowBox[{"0.001", "*", 
                    RowBox[{"(", 
                    RowBox[{"tf", "-", "ti"}], ")"}]}]}]}], "}"}]}], "}"}]}], 
             "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"ViewPoint", "\[Rule]", "Top"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{momentum trajectory}\>\"", "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"angMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"xk", "[", "t", "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", "\"\<L_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sPlot", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"spin", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{
             RowBox[{"xk", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", "\"\<\\\\text{Spin}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", "\"\<s_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"totAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"J", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", "\"\<\\\\text{Total angular moment}\>\"", "]"}]}], 
         ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", "\"\<J_z\>\""}], 
            "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtTotAngMom", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"J", "[", 
              RowBox[{"\[Chi]", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"xk", "[", "tpr", "]"}]}]}], "]"}], ",", "tpr"}], 
            "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of total angular moment}\>\"", 
           "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot J_x\>\"", ",", "\"\<\\\\dot J_y\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dtJLSZ", "=", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"spin", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{
                   RowBox[{"xk", "[", "tpr", "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"L", "[", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"xk", "[", "tpr", "]"}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"J", "[", 
                 RowBox[{"\[Chi]", ",", 
                  RowBox[{"Sequence", "@@", 
                   RowBox[{"xk", "[", "t", "]"}]}]}], "]"}], ",", "tpr"}], 
               "]"}], "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "/.", 
           RowBox[{"{", 
            RowBox[{"tpr", "\[Rule]", "t"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "ti", ",", "tf"}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{
          "MaTeX", "[", 
           "\"\<\\\\text{Time derivative of z-components of $\\\\bf J$, \
$\\\\bf L$ and $\\\\bf S$}\>\"", "]"}]}], ",", 
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", 
            RowBox[{
            "\"\<\\\\dot s_z\>\"", ",", "\"\<\\\\dot L_z\>\"", ",", 
             "\"\<\\\\dot J_z\>\""}], "}"}], "]"}]}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"MaTeX", "[", 
           RowBox[{"{", "\"\<\\\\text{time (a.u.)}\>\"", "}"}], "]"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"allPlots", "=", 
       RowBox[{"{", 
        RowBox[{
        "trajXV", ",", "trajDTXV", ",", "trajKV", ",", "angMom", ",", "sPlot",
          ",", "totAngMom", ",", "dtTotAngMom", ",", "dtJLSZ"}], "}"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"print", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Print", "[", "#", "]"}], "&"}], "/@", "allPlots"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "allPlots"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762784720225697`*^9, 3.876278680915045*^9}, {
   3.876278744865803*^9, 3.8762788563450117`*^9}, {3.876278887165505*^9, 
   3.87627893119884*^9}, {3.876278983828095*^9, 3.876279017442494*^9}, {
   3.876279055974214*^9, 3.8762790833788633`*^9}, {3.8762791209749928`*^9, 
   3.876279160750586*^9}, {3.8762792072815228`*^9, 3.876279272897011*^9}, {
   3.876279437982346*^9, 3.8762795571933002`*^9}, {3.87627963316615*^9, 
   3.876279638121461*^9}, {3.876279679056473*^9, 3.8762797845557528`*^9}, {
   3.87628003931083*^9, 3.876280097719277*^9}, {3.876284717312385*^9, 
   3.8762847327570887`*^9}, {3.876287812389793*^9, 3.876287869225124*^9}, {
   3.876297661790721*^9, 3.876297700001625*^9}, {3.876372267929987*^9, 
   3.8763722713616543`*^9}, {3.8763751662199993`*^9, 3.876375186218738*^9}, {
   3.8763963597215357`*^9, 3.876396388193994*^9}, {3.876398046127877*^9, 
   3.876398149609194*^9}, 3.8763982983150873`*^9, {3.87639891238721*^9, 
   3.876398950768055*^9}, {3.876399031203125*^9, 3.8763990910400248`*^9}, {
   3.8764082554715643`*^9, 3.8764082581261997`*^9}, {3.876408375057629*^9, 
   3.876408376131711*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"32b1e47c-a4b0-4d8a-9e85-6e3c67104036"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"test", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",", "\[Alpha]", ",", 
     "\[Chi]", ",", "ti", ",", "tf", ",", "\[Rho]t"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1.67", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "0"}], "}"}]}], "}"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762784720225697`*^9, 3.876278680915045*^9}, {
   3.876278744865803*^9, 3.8762788563450117`*^9}, {3.876278887165505*^9, 
   3.87627893119884*^9}, {3.876278983828095*^9, 3.876279017442494*^9}, {
   3.876279055974214*^9, 3.8762790833788633`*^9}, {3.8762791209749928`*^9, 
   3.876279160750586*^9}, {3.8762792072815228`*^9, 3.876279272897011*^9}, {
   3.876279437982346*^9, 3.8762795571933002`*^9}, {3.87627963316615*^9, 
   3.876279638121461*^9}, {3.876279679056473*^9, 3.8762797845557528`*^9}, {
   3.87628003931083*^9, 3.876280097719277*^9}, {3.876284717312385*^9, 
   3.8762847327570887`*^9}, {3.876287812389793*^9, 3.876287869225124*^9}, {
   3.876297661790721*^9, 3.876297700001625*^9}, {3.876372267929987*^9, 
   3.8763722713616543`*^9}, {3.8763751662199993`*^9, 3.876375186218738*^9}, {
   3.8763963597215357`*^9, 3.876396388193994*^9}, {3.876396986498314*^9, 
   3.8763971661519814`*^9}, {3.876397285569365*^9, 3.876397317274397*^9}, {
   3.876397990558527*^9, 3.876398012729558*^9}, 3.8764081584921017`*^9, {
   3.876408499992436*^9, 3.876408535411331*^9}, {3.8764086079917583`*^9, 
   3.87640862955829*^9}, {3.876408671780756*^9, 3.8764086807124147`*^9}, {
   3.876408881496044*^9, 3.876408885523188*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"ad230d05-71dc-4410-9588-11c4a3edf72a"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"fun", ",", "s"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{"s", ",", "x0", ",", "k0", ",", 
      RowBox[{"vF", "=", "1"}], ",", 
      RowBox[{"\[Rho]t", "=", "1"}], ",", 
      RowBox[{"\[Alpha]", "=", 
       RowBox[{"1", "/", "2"}]}], ",", 
      RowBox[{"\[Chi]", "=", 
       RowBox[{"+", "1"}]}], ",", 
      RowBox[{"ti", "=", 
       RowBox[{"-", "100"}]}], ",", 
      RowBox[{"tf", "=", "100"}]}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plots", "=", 
    RowBox[{"makePlots2D", "[", 
     RowBox[{
     "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
      "tf", ",", "1", ",", "3", ",", "False"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"plots", "=", 
     RowBox[{"makePlots", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf"}], "]"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"plots", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "400"}]}], "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJwd0E8oQwEABvC1dtBsLYr82ZqVxUEmo4k5KGlCsx3kgNoysWY77MmUhayV
Ukz5N5cV2RsrEoVoYxMlMhfFTLONHk67LC7zvnf4+vWdvvokeovWwGaxWCI6
MHnMKjbGf1p4KpEckoelTbCHm9sOIx2pTvjRN6SFF1N/vZCqrO6HoaqsDm6L
TQZYLhcb4R2nyAKVbIqA3YdCO9RZAi7okG17YIlGugPZiRCj5z6+B09v8s6h
Nk1FoYajSEJB1icdpc1vXKuAsol50kyrqPPuwZWuk3Er9vjTk5C4tKdWaf1L
34xK7rV6nfYz26aFj4UZcpNWXu/0w5q0OgNzXsP8LdrmhgMhjF6TZZB4ixAw
GFi0QfOI9QGGbRFG98ubyUcrVD9Z4O8td4zp+3LGI29iBn45z2bhcCo2B28k
GUYi1roAC/SOZfisim3Ad6Pd42N+tvkgxXPuwlrXYBAK3ANX8B8rWwyn
  "],
 CellLabel->"In[39]:=",ExpressionUUID->"ba8d8622-4acf-4c36-b8a8-aa0ed56046f2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Lensing Angle", "Subsubsection",
 CellChangeTimes->{{3.876298694559404*^9, 
  3.876298697801196*^9}},ExpressionUUID->"8a19a71f-2c87-4dfe-acc9-\
c9c236223541"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "lensingAngle", ",", "x0", ",", "k0", ",", "fun", ",", "vF", ",", "rt", ",",
    "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "nti", ",", "ntf", ",", 
   "ti", ",", "tf", ",", "t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lensingAngle", "[", 
    RowBox[{
    "x0_", ",", "k0_", ",", "vF_", ",", "rt_", ",", "\[Alpha]_", ",", 
     "\[Chi]_", ",", "nti_", ",", "ntf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "b", ",", "fun", ",", "ti", ",", "tf", ",", "rp", ",", 
       "plots", ",", "closestApproach", ",", "tp", ",", "\[Epsilon]p", ",", 
       "Lzp", ",", "\[Epsilon]diff", ",", "Lzdiff", ",", "\[Epsilon]ts", ",", 
       "Lzts", ",", "xvts", ",", "lensingAngleNumeric", ",", 
       "lensingAngleAnalytic1", ",", "lensingAngleAnalytic2", ",", 
       "lensingPlot"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ti", "=", "nti"}], ";", 
      RowBox[{"tf", "=", "ntf"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
         "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fun", "[", "b_", "]"}], ":=", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"solveSEOM", "[", 
         RowBox[{
         "b", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", "\[Alpha]", 
          ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", "periapsis"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"closestApproach", "[", "b_", "]"}], "=", 
       RowBox[{"NMinimize", "[", 
        RowBox[{
         RowBox[{"norm", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "[", "b", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{";;", "2"}], "]"}], "]"}], "]"}], ",", "b"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rp", "=", 
       RowBox[{"First", "[", 
        RowBox[{"closestApproach", "[", "t", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Print", "[", 
        RowBox[{"ToString", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<Periapsis: `1`\>\"", ",", "\[Rho]p"}], "]"}], "]"}], 
        "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tp", "=", 
       RowBox[{"t", "/.", 
        RowBox[{
         RowBox[{"closestApproach", "[", "t", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]ts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Epsilon]", "[", 
          RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]diff", "=", 
       RowBox[{"Subtract", "@@", "\[Epsilon]ts"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Lzts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Lzdiff", "=", 
       RowBox[{"Subtract", "@@", "Lzts"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"\[Epsilon]diff", "/", 
           RowBox[{"\[Epsilon]ts", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
         SuperscriptBox["10", 
          RowBox[{"-", "4"}]]}], ",", 
        RowBox[{"Print", "[", "\"\<Check conserved quantities.\>\"", "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"Lzdiff", "/", 
           RowBox[{"Lzts", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
         SuperscriptBox["10", 
          RowBox[{"-", "4"}]]}], ",", 
        RowBox[{"Print", "[", "\"\<Check conserved quantities.\>\"", "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", 
        RowBox[{"initial", "/", "final"}], " ", "direction", " ", "vector"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"xvts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Normalize", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "'"}], "[", "#", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lensingAngleNumeric", "=", 
       RowBox[{"VectorAngle", "@@", "xvts"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"compare", " ", "to", " ", "analytics"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"lensingAngleAnalytic1", "=", 
       RowBox[{
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"2", 
           RowBox[{"(", 
            RowBox[{"vF", "/", 
             RowBox[{"(", 
              RowBox[{"\[Sqrt]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  FractionBox["1", 
                   SuperscriptBox["rp", "2"]], 
                  RowBox[{"(", 
                   RowBox[{
                    SuperscriptBox["vF", "2"], "-", 
                    SuperscriptBox[
                    RowBox[{"u", "[", 
                    RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "rp"}], 
                    "]"}], "2"]}], ")"}], 
                  SuperscriptBox["r", "4"]}], "-", 
                 RowBox[{
                  SuperscriptBox["r", "2"], 
                  RowBox[{"(", 
                   RowBox[{
                    SuperscriptBox["vF", "2"], "-", 
                    SuperscriptBox[
                    RowBox[{"u", "[", 
                    RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "r"}], 
                    "]"}], "2"]}], ")"}]}]}], ")"}]}], ")"}]}], ")"}]}], ",", 
          
          RowBox[{"{", 
           RowBox[{"r", ",", "rp", ",", "\[Infinity]"}], "}"}]}], "]"}], "-", 
        "\[Pi]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lensingAngleAnalytic2", "=", 
       RowBox[{
        FractionBox[
         SuperscriptBox[
          RowBox[{"u", "[", 
           RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "rp"}], "]"}], "2"], 
         SuperscriptBox["vF", "2"]], 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["r", "2"], "-", 
              RowBox[{
               SuperscriptBox["rp", "2"], " ", 
               SuperscriptBox[
                RowBox[{"(", 
                 FractionBox["rp", "r"], ")"}], 
                RowBox[{"2", "\[Alpha]"}]]}]}], ")"}], 
            RowBox[{
             SuperscriptBox["r", "2"], "-", 
             SuperscriptBox["rp", "2"]}]], 
           FractionBox["rp", 
            RowBox[{"r", 
             SqrtBox[
              RowBox[{
               SuperscriptBox["r", "2"], "-", 
               SuperscriptBox["rp", "2"]}]]}]]}], ",", 
          RowBox[{"{", 
           RowBox[{"r", ",", "rp", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "result", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "rp", ",", "lensingAngleNumeric", ",", "lensingAngleAnalytic1", ",", 
        "lensingAngleAnalytic2"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762994227929077`*^9, 3.8762994233079433`*^9}, {
   3.876299878318181*^9, 3.876299882582816*^9}, {3.8763004780918617`*^9, 
   3.876300478918247*^9}, {3.8763843794979887`*^9, 3.87638437957813*^9}, {
   3.8763921770034122`*^9, 3.876392223749179*^9}, {3.876399153204296*^9, 
   3.876399166645954*^9}, {3.876399222344988*^9, 3.876399407002287*^9}, 
   3.876399449402663*^9, {3.876399496871484*^9, 3.876399699372666*^9}, {
   3.8763998632833433`*^9, 3.876399907115279*^9}, 3.8764089709763527`*^9, {
   3.87640908826567*^9, 3.876409088538278*^9}, {3.8764131164456043`*^9, 
   3.8764131178854094`*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"2eb269a6-aef2-4b4e-8628-13f5f2b3580e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "xv", ",", "kv", ",", "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",",
      "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"3.5", "+", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762994227929077`*^9, 3.8762994233079433`*^9}, {
   3.876299878318181*^9, 3.876299882582816*^9}, {3.8763004780918617`*^9, 
   3.876300478918247*^9}, {3.8763843794979887`*^9, 3.87638437957813*^9}, {
   3.8763921770034122`*^9, 3.876392223749179*^9}, {3.876399153204296*^9, 
   3.876399166645954*^9}, {3.876399222344988*^9, 3.876399407002287*^9}, 
   3.876399449402663*^9, {3.876399496871484*^9, 3.876399699372666*^9}, {
   3.8763998632833433`*^9, 3.876399907115279*^9}, 3.8764089709763527`*^9, {
   3.87640908826567*^9, 3.876409094266225*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"95e1a0c5-c9eb-4ca7-9e7f-3856f08472a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"lensingAngle", "[", 
   RowBox[{"x0", ",", "k0", ",", "1", ",", "1", ",", 
    RowBox[{"1", "/", "2"}], ",", "1", ",", 
    RowBox[{"-", "200"}], ",", "200"}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8762994227929077`*^9, 3.8762994233079433`*^9}, {
   3.876299878318181*^9, 3.876299882582816*^9}, {3.8763004780918617`*^9, 
   3.876300478918247*^9}, {3.8763843794979887`*^9, 3.87638437957813*^9}, {
   3.8763921770034122`*^9, 3.876392223749179*^9}, {3.876399153204296*^9, 
   3.876399166645954*^9}, {3.876399222344988*^9, 3.876399407002287*^9}, 
   3.876399449402663*^9, {3.876399496871484*^9, 3.876399699372666*^9}, {
   3.8763998632833433`*^9, 3.876399907115279*^9}, 3.8764089709763527`*^9, {
   3.87640908826567*^9, 3.876409094266225*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"d10d3fd9-6c76-4c1b-8fdf-b51a0e619353"]
}, Closed]],

Cell[CellGroupData[{

Cell["Transverse Shift", "Subsubsection",
 CellChangeTimes->{{3.8763722398352337`*^9, 
  3.876372243636908*^9}},ExpressionUUID->"5a03dbae-22f6-4134-950d-\
a2d224cabd7f"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "transverseShift", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", 
   "\[Alpha]", ",", "\[Chi]", ",", "nti", ",", "ntf", ",", "t"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"transverseShift", "[", 
    RowBox[{
    "x0_", ",", "k0_", ",", "vF_", ",", "rt_", ",", "\[Alpha]_", ",", 
     "\[Chi]_", ",", "nti_", ",", "ntf_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "fun", ",", "f", ",", "xv", ",", "kv", ",", "ti", ",", "tf", ",", "rp", 
       ",", "t", ",", "a", ",", "plots", ",", "closestApproach", ",", "tp", 
       ",", "\[Epsilon]p", ",", "Lzp", ",", "\[Epsilon]diff", ",", "Lzdiff", 
       ",", "\[Epsilon]ts", ",", "Lzts", ",", "xvts", ",", 
       "\[CapitalDelta]zNumeric", ",", "\[CapitalDelta]zAnalytic1", ",", 
       "\[CapitalDelta]zAnalytic2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ti", "=", "nti"}], ";", 
      RowBox[{"tf", "=", "ntf"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "obtain", " ", "solution", " ", "with", " ", "initial", " ", 
         "conditions", " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fun", "[", "b_", "]"}], ":=", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"solveSEOM", "[", 
         RowBox[{
         "b", ",", "x0", ",", "k0", ",", "vF", ",", "rt", ",", "\[Alpha]", 
          ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"extract", " ", "periapsis"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"closestApproach", "[", "b_", "]"}], "=", 
       RowBox[{"NMinimize", "[", 
        RowBox[{
         RowBox[{"norm", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fun", "[", "b", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{";;", "2"}], "]"}], "]"}], "]"}], ",", "b"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rp", "=", 
       RowBox[{"First", "[", 
        RowBox[{"closestApproach", "[", "t", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Print", "[", 
        RowBox[{"ToString", "[", 
         RowBox[{"StringForm", "[", 
          RowBox[{"\"\<Periapsis: `1`\>\"", ",", "\[Rho]p"}], "]"}], "]"}], 
        "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"tp", "=", 
       RowBox[{"t", "/.", 
        RowBox[{
         RowBox[{"closestApproach", "[", "t", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]ts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Epsilon]", "[", 
          RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Epsilon]diff", "=", 
       RowBox[{"Subtract", "@@", "\[Epsilon]ts"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Lzts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"L", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"ti", ",", "tf"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Lzdiff", "=", 
       RowBox[{"Subtract", "@@", "Lzts"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"\[Epsilon]diff", "/", 
           RowBox[{"\[Epsilon]ts", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
         SuperscriptBox["10", 
          RowBox[{"-", "4"}]]}], ",", 
        RowBox[{"Print", "[", "\"\<Check if energy conserved.\>\"", "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"Lzdiff", "/", 
           RowBox[{"Lzts", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ">", 
         SuperscriptBox["10", 
          RowBox[{"-", "4"}]]}], ",", 
        RowBox[{
        "Print", "[", 
         "\"\<Lz not conserved. Approximation will probably fail.\>\"", 
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          RowBox[{"u", "[", 
           RowBox[{"\[Alpha]", ",", "vF", ",", "rt", ",", "rp"}], "]"}], 
          "vF"], ")"}], "2"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]zNumeric", " ", "=", " ", 
       RowBox[{"Subtract", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", 
          RowBox[{"{", 
           RowBox[{"tf", ",", "ti"}], "}"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"f", "[", "s_", "]"}], ":=", 
       RowBox[{
        FractionBox[
         SuperscriptBox["s", 
          RowBox[{"1", "-", 
           RowBox[{"2", "\[Alpha]"}]}]], 
         SqrtBox[
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", "a"}], ")"}], 
            SuperscriptBox["s", "2"]}], "-", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"a", " ", 
              SuperscriptBox["s", 
               RowBox[{
                RowBox[{"-", "2"}], "\[Alpha]"}]]}]}], ")"}]}]]], 
        FractionBox[
         RowBox[{"2", "-", 
          RowBox[{"a", " ", 
           SuperscriptBox["s", 
            RowBox[{
             RowBox[{"-", "2"}], "\[Alpha]"}]]}], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "a"}], ")"}], 
           SuperscriptBox["s", "2"]}]}], 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", "a"}], ")"}], 
             SuperscriptBox["s", "2"]}], "+", 
            RowBox[{"a", " ", 
             SuperscriptBox["s", 
              RowBox[{
               RowBox[{"-", "2"}], "\[Alpha]"}]]}]}], ")"}], "2"]]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]zAnalytic1", " ", "=", 
       RowBox[{
        RowBox[{"-", 
         FractionBox[
          RowBox[{"\[Chi]", 
           RowBox[{"(", 
            RowBox[{"1", "+", "\[Alpha]"}], ")"}], "rp", " "}], 
          RowBox[{"Lzts", "[", 
           RowBox[{"[", "1", "]"}], "]"}]]}], "a", 
        SqrtBox[
         RowBox[{"1", "-", "a"}]], 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"f", "[", "s", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"s", ",", "1", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]zAnalytic2", " ", "=", 
       RowBox[{
        RowBox[{"-", 
         FractionBox[
          RowBox[{"\[Chi]", " ", "rp", " "}], 
          RowBox[{"Lzts", "[", 
           RowBox[{"[", "1", "]"}], "]"}]]}], 
        FractionBox[
         RowBox[{" ", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"Gamma", "[", 
            RowBox[{
             FractionBox["1", "2"], "+", "\[Alpha]"}], "]"}]}]}], 
         RowBox[{"2", " ", 
          RowBox[{"Gamma", "[", "\[Alpha]", "]"}]}]], 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["rt", "rp"], ")"}], 
         RowBox[{"2", "\[Alpha]"}]]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "a", ",", "rp", ",", "\[CapitalDelta]zNumeric", ",", 
        "\[CapitalDelta]zAnalytic1", ",", "\[CapitalDelta]zAnalytic2"}], 
       "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8763722583779593`*^9, 3.876372259431946*^9}, {
  3.87639095451457*^9, 3.876390956217579*^9}, {3.8763919439534407`*^9, 
  3.8763919459093246`*^9}, {3.876408944324716*^9, 3.876409113362069*^9}, {
  3.876410096541366*^9, 3.876410134709242*^9}, {3.8764130952135563`*^9, 
  3.876413097110865*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"fe9c22e8-f27d-42e2-b49a-0961909f16b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"random", " ", "test", " ", "case"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "xv", ",", "kv", ",", "x0", ",", "k0", ",", "s", ",", "t", ",", "vF", ",",
      "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"3.5", "+", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "0", ",", 
         "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "0"}], "}"}]}],
       "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8763722583779593`*^9, 3.876372259431946*^9}, {
  3.87639095451457*^9, 3.876390956217579*^9}, {3.8763919439534407`*^9, 
  3.8763919459093246`*^9}, {3.876408944324716*^9, 3.876409115103795*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"335cf137-7340-428e-8052-7ac34a2543da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"transverseShift", "[", 
   RowBox[{"x0", ",", "k0", ",", "1", ",", "1", ",", 
    RowBox[{"1", "/", "2"}], ",", "1", ",", 
    RowBox[{"-", "200"}], ",", "200"}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8763722583779593`*^9, 3.876372259431946*^9}, {
  3.87639095451457*^9, 3.876390956217579*^9}, {3.8763919439534407`*^9, 
  3.8763919459093246`*^9}, {3.876408944324716*^9, 3.876409115103795*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"ee7184fa-6857-44f7-8653-a7c236d8b1f1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Create data table", "Subsubsection",
 CellChangeTimes->{{3.877166261812044*^9, 3.8771662644163303`*^9}, {
  3.877166531376994*^9, 
  3.877166543119869*^9}},ExpressionUUID->"b9d05c5d-92b3-4aa7-ac20-\
4d8106c063a7"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", "ti",
    ",", "tf", ",", "Nt", ",", "createData"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"createData", "[", 
   RowBox[{
   "\[Alpha]_", ",", "\[Chi]_", ",", "vF_", ",", "\[Rho]t_", ",", "fun_", ",",
     "ti_", ",", "tf_", ",", " ", 
    RowBox[{"Nt_", ":", "201"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "xs", ",", " ", "ks", ",", " ", "ts", ",", "data", ",", "header", ",", 
      "xvs", ",", "rhophizs", ",", "rhovs", ",", "rhos", ",", "phis", ",", 
      "phivs", ",", "hatrhovs", ",", "hatphivs", ",", "vvs", ",", "kvs", ",", 
      "krhos", ",", "kphis", ",", "\[Epsilon]s", ",", "us", ",", "Lzs", ",", 
      "krhosp", ",", "krhosm"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"create", " ", "all", " ", "necessary", " ", "data"}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ts", "=", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{"ti", ",", "tf", ",", 
         FractionBox[
          RowBox[{"tf", "-", "ti"}], "Nt"]}], "]"}], "//", "N"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"ts", ",", "0"}], "]"}]}], ",", 
       RowBox[{"ts", "=", 
        RowBox[{"Sort", "[", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"ts", ",", "0"}], "]"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"{", 
       RowBox[{"{", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "parameters"}], " ", "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "ts", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<t\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "\[Alpha]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\alpha\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "\[Chi]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\chi\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "vF", "}"}], "&"}], "/@", "ts"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<v_F\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "\[Rho]t", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\rho_t\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "spatial", " ", "coordinates"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"xvs", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fun", "[", "#", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", "xvs", ",", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", " ", "\"\<z\>\""}], 
         "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"rhophizs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"CoordinateTransform", "[", 
         RowBox[{
          RowBox[{"\"\<Cartesian\>\"", "\[Rule]", "\"\<Cylindrical\>\""}], 
          ",", "#"}], "]"}], "&"}], "/@", "xvs"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rhos", "=", 
      RowBox[{"rhophizs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "rhos", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\rho\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"phis", "=", 
      RowBox[{"rhophizs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "phis", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<\\\\phi\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"extract", " ", "useful", " ", "vectors"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"rhovs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "*", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0"}], "}"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hatrhovs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Normalize", "[", 
         RowBox[{"rhovs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"{", "hatrhovs", "}"}], "\[Transpose]"}], ",", "2"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"header", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"header", ",", 
          RowBox[{"{", "\"\<\\\\hat\\\\rho\>\"", "}"}]}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"phivs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], "\[Cross]", 
           RowBox[{"hatrhovs", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "*", 
         RowBox[{"xvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hatphivs", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Normalize", "[", 
         RowBox[{"phivs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"{", "hatphivs", "}"}], "\[Transpose]"}], ",", "2"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"header", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"header", ",", 
          RowBox[{"{", "\"\<\\\\hat\\\\phi\>\"", "}"}]}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "derivatives", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"vvs", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"fun", "'"}], "[", "#", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", "vvs", ",", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<\\\\dot x\>\"", ",", "\"\<\\\\dot y\>\"", ",", " ", 
          "\"\<\\\\dot z\>\""}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"fun", "''"}], "[", "#", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<\\\\ddot x\>\"", ",", "\"\<\\\\ddot y\>\"", ",", " ", 
          "\"\<\\\\ddot z\>\""}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"add", " ", "momentum", " ", "coordinates"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"kvs", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"fun", "[", "#", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", "kvs", ",", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<k_x\>\"", ",", "\"\<k_y\>\"", ",", " ", "\"\<k_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"project", " ", "onto", " ", "\[Rho]"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"krhos", " ", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"hatrhovs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", 
         RowBox[{"kvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "krhos", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\rho\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"project", " ", "onto", " ", "\[Phi]"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"kphis", " ", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"hatphivs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", 
         RowBox[{"kvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "kphis", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\phi\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"the", " ", "two", " ", 
        SubscriptBox["k", "\[Rho]"], " ", "branches", " ", "from", " ", 
        "\[Epsilon]"}], ",", " ", "Lz", ",", " ", 
       RowBox[{"and", " ", "\[Rho]"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Epsilon]s", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Epsilon]", "[", 
         RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", "ts"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"us", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"u", "[", 
         RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", "#"}], "]"}], 
        "&"}], "/@", "rhos"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Lzs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"L", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"fun", "[", "#", "]"}]}], "]"}], "[", 
         RowBox[{"[", "3", "]"}], "]"}], "&"}], "/@", "ts"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"krhosp", "=", 
      FractionBox[
       RowBox[{
        RowBox[{"\[Epsilon]s", " ", "us"}], "-", 
        FractionBox[
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["us", "2"], 
             SuperscriptBox["vF", "2"]}], "-", 
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["vF", "4"]}], "+", 
            RowBox[{
             SuperscriptBox["\[Epsilon]s", "2"], 
             SuperscriptBox["vF", "2"], 
             SuperscriptBox["rhos", "2"]}]}], ")"}]}], "rhos"]}], 
       RowBox[{
        SuperscriptBox["us", "2"], "-", 
        SuperscriptBox["vF", "2"]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "krhosp", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\rho^{(+)}\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"krhosm", "=", 
      FractionBox[
       RowBox[{
        RowBox[{"\[Epsilon]s", " ", "us"}], "+", 
        FractionBox[
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["us", "2"], 
             SuperscriptBox["vF", "2"]}], "-", 
            RowBox[{
             SuperscriptBox["Lzs", "2"], 
             SuperscriptBox["vF", "4"]}], "+", 
            RowBox[{
             SuperscriptBox["\[Epsilon]s", "2"], 
             SuperscriptBox["vF", "2"], 
             SuperscriptBox["rhos", "2"]}]}], ")"}]}], "rhos"]}], 
       RowBox[{
        SuperscriptBox["us", "2"], "-", 
        SuperscriptBox["vF", "2"]}]]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{"{", "krhosm", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<k_\\\\rho^{(-)}\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"spin", ",", " ", 
       RowBox[{"angular", " ", "moment"}], ",", " ", 
       RowBox[{
       "total", " ", "angular", " ", "moment", " ", "and", " ", "energy"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"spin", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", "ts"}], 
        ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", " ", "\"\<s_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"L", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"fun", "[", "#", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", "ts"}], 
        ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", " ", "\"\<L_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"J", "[", 
           RowBox[{"\[Chi]", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", "ts"}], 
        ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", " ", "\"\<J_z\>\""}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"data", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Epsilon]", "[", 
            RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "}"}], "&"}], "/@", 
         "ts"}], ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"header", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"header", ",", 
        RowBox[{"{", "\"\<E\>\"", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"data", ",", " ", "header"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8771662679909277`*^9, 3.877166516592882*^9}},
 CellLabel->
  "In[193]:=",ExpressionUUID->"fe0b4360-e270-4fdc-aaf1-d0efddd3c958"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Case Analysis", "Subsection",
 CellChangeTimes->{{3.876211684824133*^9, 3.876211687491818*^9}, {
  3.876216291171008*^9, 
  3.876216291828706*^9}},ExpressionUUID->"86b1f668-e169-4b17-a61c-\
a53b2d76c76a"],

Cell[CellGroupData[{

Cell[TextData[{
 "Lensing, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["k", "z"], "=", "0"}], TraditionalForm]],ExpressionUUID->
  "2c3d6eaa-5979-4d6a-90ef-1930d9f99632"]
}], "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 
  3.8762128357742043`*^9}},ExpressionUUID->"ddbfbf95-e699-4310-ac22-\
3ca21f7da378"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", "1"}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "40"}]}], ";", 
  RowBox[{"tf", "=", "40"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"2.6", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{
       FractionBox["1", 
        SqrtBox["2"]], 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "1"}], ",", "0"}], "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf", ",", "False"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"lensingAngle", "[", 
  RowBox[{
  "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", 
   ",", "ti", ",", "tf"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"transverseShift", "[", 
  RowBox[{
  "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", 
   ",", "ti", ",", "tf"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8764491120973454`*^9, 3.876449143801107*^9}, {
   3.876449195012836*^9, 3.8764492196110764`*^9}, {3.876449251318733*^9, 
   3.876449276944387*^9}, 3.876449334421805*^9, {3.876449491263528*^9, 
   3.87644949954361*^9}, {3.8764495681287403`*^9, 3.876449578655839*^9}, {
   3.8764500274795732`*^9, 3.8764500673474693`*^9}, {3.8764515420809937`*^9, 
   3.876451544241571*^9}, {3.876452202869668*^9, 3.876452210248601*^9}, 
   3.876841014725233*^9},ExpressionUUID->"52a5c363-57b5-4f43-92d6-\
007efce1bc98"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Lensing, ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["k", "z"], "\[NotEqual]", "0"}], TraditionalForm]],
  ExpressionUUID->"859b60b3-6239-4b54-b71a-e572ed33bca1"]
}], "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 3.8762128357742043`*^9}, {3.876213556691161*^9, 
  3.876213564069309*^9}},ExpressionUUID->"e400a94b-50e9-4a76-9b3f-\
7b27548d0b58"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "40"}]}], ";", 
  RowBox[{"tf", "=", "40"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "4"}], ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{
       FractionBox["1", 
        SqrtBox["2"]], 
       RowBox[{"{", 
        RowBox[{"0", ",", "1", ",", "1"}], "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762141060781384`*^9, 
   3.8762141134561453`*^9}, {3.8762141738660383`*^9, 
   3.8762141745719967`*^9}, {3.8762158004615927`*^9, 3.876215949410845*^9}, 
   3.876216001195833*^9, {3.876216665708499*^9, 3.876216666006266*^9}, 
   3.876279327591407*^9, 3.876409198389716*^9, {3.876409329597155*^9, 
   3.8764093883778763`*^9}, {3.876409451249091*^9, 3.876409477871475*^9}, {
   3.8764097282610493`*^9, 3.876409729126554*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"be4390f1-80cd-4645-8f77-51169d87dec9"]
}, Closed]],

Cell[CellGroupData[{

Cell["Unstable Orbit", "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 3.8762128357742043`*^9}, {3.876213556691161*^9, 
  3.876213564069309*^9}, {3.876213633129332*^9, 
  3.876213635962284*^9}},ExpressionUUID->"99db847d-8409-429b-a999-\
e56108e9aafa"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", "1"}], ";", 
  RowBox[{"ti", "=", "0"}], ";", 
  RowBox[{"tf", "=", "40"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ky0", " ", "=", " ", 
   FractionBox["\[Alpha]", 
    RowBox[{"\[Alpha]", "+", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kx0", "=", 
   FractionBox["ky0", 
    SqrtBox["\[Alpha]"]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Rho]s", "[", 
         RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}], ",", "0", ",", "0"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"kx0", ",", "ky0", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"makePlots", "[", 
     RowBox[{
     "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
      "tf", ",", "False"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", 
   RowBox[{"ViewPoint", "\[Rule]", 
    RowBox[{"{", "Right", "}"}]}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots2D", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762136622150793`*^9, 
   3.876213956159441*^9}, {3.876213997747775*^9, 3.876214017224112*^9}, {
   3.876214088042946*^9, 3.876214091217634*^9}, 3.8762141870554447`*^9, {
   3.876216100615735*^9, 3.8762161090399017`*^9}, {3.876216144689081*^9, 
   3.8762162024980297`*^9}, {3.8762166661576643`*^9, 3.876216667031542*^9}, 
   3.876279345942913*^9, {3.876296990525762*^9, 3.876296998638966*^9}, {
   3.876297052290653*^9, 3.876297053332765*^9}, {3.876409233068941*^9, 
   3.876409320263236*^9}, {3.876409503367268*^9, 3.876409517533741*^9}, {
   3.8764097226920147`*^9, 3.876409723647565*^9}, {3.876452224018977*^9, 
   3.8764523251126432`*^9}, {3.876452556605994*^9, 3.876452665360774*^9}, {
   3.876452699399548*^9, 3.876452742302059*^9}, {3.876452798642294*^9, 
   3.876452830799692*^9}, {3.87645286709803*^9, 3.876452957339101*^9}, 
   3.876453027875021*^9, 3.8764533817271633`*^9, 3.8764534466458178`*^9, {
   3.876840832565462*^9, 3.876840834956294*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"f86fa1e1-9ccf-4d85-b2c6-d98abf7c18f6"]
}, Closed]],

Cell[CellGroupData[{

Cell["Capture", "Subsubsection",
 CellChangeTimes->{{3.876212773587398*^9, 3.876212777077264*^9}, {
  3.876212830776032*^9, 3.8762128357742043`*^9}, {3.876213556691161*^9, 
  3.876213564069309*^9}, {3.876213633129332*^9, 3.876213635962284*^9}, {
  3.876216310132303*^9, 
  3.876216311062275*^9}},ExpressionUUID->"70471d8d-9051-45ec-b1bf-\
98b5dbc06736"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"ti", "=", "0"}], ";", 
  RowBox[{"tf", "=", "10.33"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ky0", " ", "=", " ", 
   FractionBox["\[Alpha]", 
    RowBox[{"\[Alpha]", "+", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kx0", "=", 
   FractionBox["ky0", 
    SqrtBox["\[Alpha]"]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"0.99", 
         RowBox[{"\[Rho]s", "[", 
          RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}]}], ",", "0", ",", "0"}],
        "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"kx0", ",", "ky0", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fun", "[", "s_", "]"}], "=", 
    RowBox[{"solveSEOM", "[", 
     RowBox[{
     "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
      ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"plot", " ", "the", " ", "solution"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots2D", "[", 
   RowBox[{
   "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
    "tf"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876213568149726*^9, 3.87621356820411*^9}, {3.8762136622150793`*^9, 
   3.876213956159441*^9}, {3.876213997747775*^9, 3.876214017224112*^9}, {
   3.876214088042946*^9, 3.876214091217634*^9}, 3.8762141870554447`*^9, {
   3.876216100615735*^9, 3.8762161090399017`*^9}, {3.876216144689081*^9, 
   3.8762162024980297`*^9}, {3.876216320204741*^9, 3.876216343544739*^9}, {
   3.876216374749035*^9, 3.8762164285500813`*^9}, {3.876216667163705*^9, 
   3.8762166682316103`*^9}, {3.876217907399022*^9, 3.876217914087459*^9}, 
   3.8762793760226793`*^9, {3.876297077221315*^9, 3.8762971034602947`*^9}, {
   3.876409538964356*^9, 3.876409636710113*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"f61fd84f-76b3-4026-a36f-2db6bd32ce3e"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Numerics vs. Analytic Approximations", "Subsection",
 CellChangeTimes->{{3.876211684824133*^9, 3.876211687491818*^9}, {
  3.876216291171008*^9, 3.876216291828706*^9}, {3.8762804894930477`*^9, 
  3.876280500308955*^9}},ExpressionUUID->"471f9e0e-9fd6-41aa-88e7-\
07f9cf41fd74"],

Cell[CellGroupData[{

Cell["Lensing Angle", "Subsubsection",
 CellChangeTimes->{{3.876283915669186*^9, 
  3.876283919313569*^9}},ExpressionUUID->"4241d1b9-6af5-44b4-8bca-\
4bf29d0c6b6e"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Alpha]s", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "2"}], ",", "1", ",", 
     RowBox[{"3", "/", "2"}], ",", "2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "1000"}]}], ";", 
  RowBox[{"tf", "=", 
   RowBox[{"-", "ti"}]}], ";", 
  RowBox[{"\[Rho]s", "[", 
   RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"xs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"3", "*", 
      SuperscriptBox["10", "x"]}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", "2", ",", "0.05"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"x0k0s", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{
        FractionBox["1", 
         SqrtBox["2"]], 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"-", "1"}], ",", "0"}], "}"}]}]}], "}"}], "&"}], "/@", 
    "xs"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.876284665864373*^9, 3.876284694799404*^9}, {
   3.876284775866069*^9, 3.876284779855748*^9}, {3.876286858362134*^9, 
   3.876286872508885*^9}, {3.876286936534634*^9, 3.876286941167001*^9}, {
   3.876286979736411*^9, 3.876286981688355*^9}, {3.876288202080182*^9, 
   3.87628837772644*^9}, {3.876288486741686*^9, 3.87628854570193*^9}, {
   3.876288764702566*^9, 3.8762888064345217`*^9}, {3.8762897487231417`*^9, 
   3.87628978931619*^9}, {3.876290001850498*^9, 3.876290029483636*^9}, {
   3.8762901021153708`*^9, 3.87629011929996*^9}, {3.876290183202178*^9, 
   3.876290269508654*^9}, {3.876290305600251*^9, 3.876290306524467*^9}, {
   3.876291975745947*^9, 3.876292126773094*^9}, {3.876292244626021*^9, 
   3.87629224532025*^9}, {3.876292399021867*^9, 3.876292470284574*^9}, {
   3.876293262385076*^9, 3.876293265103135*^9}, {3.8762933102603817`*^9, 
   3.8762935585424767`*^9}, {3.876296322589383*^9, 3.876296440543792*^9}, {
   3.876296487027658*^9, 3.8762969468620777`*^9}, {3.87629713735493*^9, 
   3.876297390057485*^9}, {3.8762974410866127`*^9, 3.876297468192031*^9}, {
   3.876297500573731*^9, 3.876297631604609*^9}, {3.87629771640373*^9, 
   3.87629787693121*^9}, {3.876297912235538*^9, 3.8762979162186193`*^9}, {
   3.876298122811596*^9, 3.876298184485957*^9}, {3.876298446574203*^9, 
   3.8762984480491037`*^9}, {3.876298521763873*^9, 3.87629854173988*^9}, {
   3.87629859355158*^9, 3.87629862158324*^9}, {3.8762986645636063`*^9, 
   3.876298685803686*^9}, {3.8762987162478952`*^9, 3.876298838716179*^9}, {
   3.876299035675013*^9, 3.8762990360931463`*^9}, {3.87636890152318*^9, 
   3.87636891486348*^9}, {3.876369047748521*^9, 3.876369052362012*^9}, {
   3.87637059367612*^9, 3.876370593900783*^9}, {3.876371481504348*^9, 
   3.8763715087408667`*^9}, {3.8763719016074266`*^9, 3.876371901992743*^9}, {
   3.876372005853339*^9, 3.876372024151091*^9}, 3.876386553482665*^9, 
   3.876409753748417*^9, {3.876409814183021*^9, 3.8764098204966793`*^9}, {
   3.876409877019351*^9, 3.876409877407442*^9}, 3.8764131948140306`*^9, 
   3.876413723111273*^9, 3.876413774045397*^9},
 CellLabel->
  "In[1027]:=",ExpressionUUID->"d47f2d2d-d412-4165-a857-008bf648df85"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "loop", " ", "takes", " ", "a", " ", "minutes", " ", "on", 
    " ", "my", " ", "laptop"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"allLensingAngles", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Monitor", "[", 
    RowBox[{
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"lensingAngles", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"lensingAngle", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "vF", ",", "\[Rho]t", ",", 
             "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], "&"}], 
          "/@", "x0k0s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"allLensingAngles", ",", "lensingAngles"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"\[Alpha]", ",", "\[Alpha]s"}], "}"}]}], "]"}], ",", 
     "\[Alpha]"}], "]"}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdxV1IU2EABuAtApdEqXhTwkabgaCJom7hwmwXUyokj0jmMQTFrspp5h+i
F4XTmIpMO8tFhYFiE2sqOpfNqK0xYYo/sZqKzrklqcxQdNLC+t7v4uG5UKJi
yk7weLw4Au8NyEUP1neuTXS7xdg1HkrA10saLmE9dyO5nDydHZGCzTGRchxV
0Ed/11mbiflh4/SlToUb/8uQ7WLf5Pe/WFojPaki32/gRFi/OROL/0h0epwu
NLzG2TL5B7xX/96ChcNWO1b2/HLgjLqfc9ivNC5jRVqKB6sct+jO1aCxgpxk
+WHFdwXdC7jxqoEuHvX4sTxmOoA1jDO3kuy9KWHw6XzHbXzEztfg9BVm7iF5
6l7kGu7yenw4lmOFVWSOjZfibdfnfNz6VVyEhRfVxZhfpC3FBwX7VZjdbmvC
9c6XWtzyNEyHA8dq+vOjO8P4sO2sGa8VL7ixQstfwv2VlzfwuSGTH2v6k3fw
5tuRXRxxKuoAO03mIP4SaAnh31uu8EfksZ5qCT4Tekz3WYyZHLm3l1Vg736Q
wfpnmjxsf5MWrSPLFq/QX0mSnuDEMZ0ah1eMmnC77RO9I2fShlObh+xYUPhC
aSCLPn7LwoKZVs8gefb8IP0/szt2cw==
  "],
 CellLabel->
  "In[843]:=",ExpressionUUID->"8af3d2f2-481f-4b92-87fc-911d38acc3fe"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"allLensingAngles", "[", 
             RowBox[{"[", 
              RowBox[{"a", ",", ";;", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"allLensingAngles", "[", 
             RowBox[{"[", 
              RowBox[{"a", ",", ";;", ",", "s"}], "]"}], "]"}]}], "}"}], 
          "\[Transpose]"}], ",", 
         RowBox[{"{", 
          RowBox[{"s", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3", ",", "4"}], "}"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Joined", "\[Rule]", "False"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{
            SuperscriptBox["10", 
             RowBox[{"-", "6"}]], ",", "\[Pi]"}], "}"}]}], "}"}]}], ",", " ", 
       
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"Opacity", "[", 
         RowBox[{"1", "/", "a"}], "]"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\text{periapsis }\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\text{Lensing angle }\\\\varphi\>\""}], "}"}], "]"}]}], ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.87629788303553*^9, 3.876297900689047*^9}, {
  3.876297931928604*^9, 3.8762979934385433`*^9}, {3.876298196309402*^9, 
  3.87629822729698*^9}, {3.876298257482386*^9, 3.876298351437479*^9}, {
  3.876298856387048*^9, 3.876298917843349*^9}, {3.876298968379734*^9, 
  3.8762989857284184`*^9}, {3.8762991176309633`*^9, 3.8762991186630583`*^9}, {
  3.876299154792714*^9, 3.8762991708282547`*^9}, {3.876299221629558*^9, 
  3.87629925054633*^9}, {3.876300987695215*^9, 3.876300991395934*^9}, {
  3.876368764860949*^9, 3.8763687649699574`*^9}, {3.876372480508017*^9, 
  3.876372488696578*^9}, {3.876409889718807*^9, 3.8764098902444887`*^9}},
 CellLabel->
  "In[845]:=",ExpressionUUID->"0583762d-6a2c-4743-829f-49831259bc0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "to", " ", "evaluate", " ", "this", " ", "commented", " ", "cell", " ", 
     "takes", " ", "quite", " ", "some", " ", "time"}], ",", " ", 
    RowBox[{"with", " ", "the", " ", "result", " ", 
     FractionBox[
      RowBox[{
       SqrtBox["\[Pi]"], " ", 
       RowBox[{"Gamma", "[", 
        RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
       RowBox[{"Tan", "[", 
        RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
      RowBox[{"Gamma", "[", 
       RowBox[{
        RowBox[{"-", 
         FractionBox["1", "2"]}], "-", "\[Alpha]"}], "]"}]]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{"\[Rho]p", ",", "\[Alpha]"}], "]"}], "\[IndentingNewLine]", 
    RowBox[{"Integrate", "[", 
     RowBox[{
      RowBox[{
       FractionBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["\[Rho]", "2"], "-", 
          RowBox[{
           SuperscriptBox["\[Rho]p", "2"], " ", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["\[Rho]p", "\[Rho]"], ")"}], 
            RowBox[{"2", "\[Alpha]"}]]}]}], ")"}], 
        RowBox[{
         SuperscriptBox["\[Rho]", "2"], "-", 
         SuperscriptBox["\[Rho]p", "2"]}]], 
       FractionBox["\[Rho]p", 
        RowBox[{"\[Rho]", " ", 
         SqrtBox[
          RowBox[{
           SuperscriptBox["\[Rho]", "2"], "-", 
           SuperscriptBox["\[Rho]p", "2"]}]]}]]}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Rho]", ",", "\[Rho]p", ",", "\[Infinity]"}], "}"}], ",", 
      RowBox[{"Assumptions", "\[Rule]", 
       RowBox[{
        RowBox[{"\[Rho]p", ">", "0"}], "&&", 
        RowBox[{"\[Alpha]", ">", "0"}]}]}]}], "]"}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.87629034999949*^9, 3.876290373915039*^9}, {
  3.876290416313857*^9, 3.8762904448230257`*^9}, {3.876290500407507*^9, 
  3.876290500685296*^9}, {3.876290675808053*^9, 3.876290682265316*^9}, {
  3.8762913576913033`*^9, 3.876291378440007*^9}, {3.876291809537841*^9, 
  3.87629182992775*^9}, {3.8762923382274647`*^9, 
  3.876292368807871*^9}},ExpressionUUID->"96cd8e0f-a2b3-4cd7-a909-\
e1ef93fabc14"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pf", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Limit", "[", 
      RowBox[{
       FractionBox[
        RowBox[{
         SqrtBox["\[Pi]"], " ", 
         RowBox[{"Gamma", "[", 
          RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
         RowBox[{"Tan", "[", 
          RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
        RowBox[{"Gamma", "[", 
         RowBox[{"-", 
          RowBox[{"(", 
           RowBox[{
            FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]], ",", 
       RowBox[{"\[Alpha]", "\[Rule]", "#"}]}], "]"}], "&"}], "/@", 
    "\[Alpha]s"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   FractionBox[
    RowBox[{
     SqrtBox["\[Pi]"], " ", 
     RowBox[{"Gamma", "[", 
      RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
     RowBox[{"Tan", "[", 
      RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
    RowBox[{"Gamma", "[", 
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{
        FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]], ",", 
   RowBox[{"{", 
    RowBox[{"\[Alpha]", ",", 
     RowBox[{"-", "1"}], ",", "5"}], "}"}], ",", 
   RowBox[{"GridLines", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]s", ",", "pf"}], "}"}]}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\alpha\>\"", ",", 
       "\"\<\\\\sqrt\\\\pi\\\\frac{\\\\Gamma(-\\\\alpha)\\\\tan(\\\\pi\\\\\
alpha)}{\\\\Gamma(-(\\\\alpha+1/2))}\>\""}], "}"}], "]"}]}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.8762915233604393`*^9, 3.876291749738435*^9}, {
  3.8762917909263372`*^9, 3.876291803186165*^9}, {3.8762918937638206`*^9, 
  3.8762919419345703`*^9}, {3.876370584704348*^9, 
  3.876370585036272*^9}},ExpressionUUID->"25d2edc8-bba5-46cd-b9c0-\
42e2ba3ad368"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "\[Alpha]", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   FractionBox[
    RowBox[{
     SqrtBox["\[Pi]"], " ", 
     RowBox[{"Gamma", "[", 
      RowBox[{"-", "\[Alpha]"}], "]"}], " ", 
     RowBox[{"Tan", "[", 
      RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
    RowBox[{"Gamma", "[", 
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{
        FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Gamma", "[", 
       RowBox[{"-", "\[Alpha]"}], "]"}], "\[Rule]", " ", 
      FractionBox[
       RowBox[{"\[Pi]", " ", 
        RowBox[{"Csc", "[", 
         RowBox[{"\[Pi]", " ", "\[Alpha]"}], "]"}]}], 
       RowBox[{"\[Alpha]", " ", 
        RowBox[{"Gamma", "[", "\[Alpha]", "]"}]}]]}], ",", 
     RowBox[{
      RowBox[{"Gamma", "[", 
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}], "\[Rule]",
       "  ", 
      FractionBox[
       RowBox[{"\[Pi]", " ", 
        RowBox[{"Csc", "[", 
         RowBox[{"\[Pi]", " ", 
          RowBox[{"(", 
           RowBox[{
            FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}]}], "]"}]}], 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}], " ", 
        RowBox[{"Gamma", "[", 
         RowBox[{"(", 
          RowBox[{
           FractionBox["1", "2"], "+", "\[Alpha]"}], ")"}], "]"}]}]]}]}], 
    "}"}]}], "//", "FullSimplify"}]}], "Input",
 CellChangeTimes->{{3.876395306436286*^9, 3.876395365540379*^9}},
 CellLabel->
  "In[621]:=",ExpressionUUID->"b57f2315-6a47-4e3b-ae1f-9a8347fb422c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"export", " ", "data", " ", "to", " ", "CSV", " ", "file"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dims", "=", 
     RowBox[{"allLensingAngles", "//", "Dimensions"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"allLensingAnglesMat", "=", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{"allLensingAngles", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"dims", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"dims", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"dims", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"\[Alpha]Column", " ", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"\[Alpha]s", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "\[Alpha]s", "]"}]}], "}"}]}], "]"}], 
        "]"}], "}"}], "\[Transpose]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", "allLensingAnglesMat"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"\[Alpha]Column", ",", "data", ",", "2"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\alpha\>\"", ",", "\"\<\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\varphi from trajectories\>\"", ",", 
       "\"\<\\\\varphi numerical integration\>\"", ",", 
       "\"\<\\\\varphi approx.\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</lensing_angle_chi_`1`_rhot_`2`_vF_`3`.csv\>\"", ",", "\[Chi]", 
         ",", "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", "data"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876369330981982*^9, 3.8763694305095463`*^9}, {
   3.87636993809477*^9, 3.876369953596612*^9}, {3.876370495328301*^9, 
   3.876370556687056*^9}, {3.8763719469979897`*^9, 3.876371986683949*^9}, 
   3.876372063949712*^9, {3.876372117792478*^9, 3.876372120152749*^9}},
 CellLabel->
  "In[846]:=",ExpressionUUID->"7d178f7e-6901-4b9d-a916-d71c597080ed"],

Cell["Export example trajectory", "Text",
 CellChangeTimes->{{3.876413223830183*^9, 
  3.8764132309263144`*^9}},ExpressionUUID->"e94f44fa-0464-4dc8-807f-\
8cdfcc7631a2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ti", "=", 
   RowBox[{"-", "20"}]}], ";", 
  RowBox[{"tf", "=", "20"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{"s", ",", 
     RowBox[{"Sequence", "@@", 
      RowBox[{"x0k0s", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ",", "vF", ",", "\[Rho]t", ",", 
     RowBox[{"\[Alpha]s", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fun", "[", "tf", "]"}], "-", 
  RowBox[{"fun", "[", "ti", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makePlots", "[", 
   RowBox[{"fun", ",", "\[Rho]t", ",", 
    RowBox[{"\[Alpha]s", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf", ",",
     "False"}], "]"}], "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.876413247393074*^9, 3.876413329037723*^9}, {
  3.876413391299411*^9, 3.876413425200783*^9}, {3.876413465407189*^9, 
  3.8764134782279673`*^9}, {3.876413519498755*^9, 3.87641364390934*^9}, {
  3.876413677747101*^9, 3.876413706350423*^9}, {3.8764137494739847`*^9, 
  3.876413759643333*^9}},
 CellLabel->
  "In[1031]:=",ExpressionUUID->"02310316-9c35-41d9-bb69-c3be73d4728d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"makePlots2D", "[", 
   RowBox[{"fun", ",", "\[Rho]t", ",", 
    RowBox[{"\[Alpha]s", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf", ",",
     "1", ",", "2"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.876413247393074*^9, 3.876413329037723*^9}, {
  3.876413391299411*^9, 3.876413425200783*^9}, {3.876413465407189*^9, 
  3.8764134782279673`*^9}, {3.876413519498755*^9, 3.87641364390934*^9}, {
  3.876413677747101*^9, 3.876413706350423*^9}, {3.8764137494739847`*^9, 
  3.8764137498352337`*^9}},ExpressionUUID->"c2b09f99-11c2-4cfc-8f37-\
6265e4d084ea"]
}, Closed]],

Cell[CellGroupData[{

Cell["Transverse Shift", "Subsubsection",
 CellChangeTimes->{{3.876283915669186*^9, 3.876283919313569*^9}, {
  3.87629927162817*^9, 
  3.8762992741305943`*^9}},ExpressionUUID->"7342a176-fb88-4a7e-aa53-\
ccd7ffc4c5c0"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t", ",", "xs", ",", "x0k0s"}], "]"}], "\n", 
 RowBox[{
  RowBox[{"\[Alpha]s", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "/", "2"}], ",", "1", ",", 
     RowBox[{"3", "/", "2"}], ",", "2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Chi]", "=", 
   RowBox[{"+", "1"}]}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"ti", "=", 
   RowBox[{"-", "10000"}]}], ";", 
  RowBox[{"tf", "=", 
   RowBox[{"-", "ti"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"3", "*", 
      SuperscriptBox["10", "x"]}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", "2", ",", "0.1"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"x0k0s", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#", ",", "0", ",", "0"}], "}"}], ",", 
       RowBox[{
        FractionBox["1", 
         SqrtBox["2"]], 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], "}"}], "&"}], "/@", 
    "xs"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.876299484826909*^9, 3.876299677070499*^9}, {
   3.876299708416728*^9, 3.876299814481843*^9}, {3.876299928394212*^9, 
   3.87630023486406*^9}, {3.876300286371763*^9, 3.876300455224091*^9}, {
   3.876300497651495*^9, 3.876300599018816*^9}, {3.876300633524918*^9, 
   3.876300651838739*^9}, {3.8763007289183273`*^9, 3.876300775961022*^9}, {
   3.876301312797521*^9, 3.8763015146202593`*^9}, {3.876302354665354*^9, 
   3.8763023689243517`*^9}, {3.876302471854248*^9, 3.876302507979559*^9}, {
   3.876368925039076*^9, 3.876368925714225*^9}, {3.876371913175323*^9, 
   3.87637192597616*^9}, {3.876372327692477*^9, 3.876372338532997*^9}, {
   3.87638608260809*^9, 3.876386103933674*^9}, {3.876409960548932*^9, 
   3.8764099842454967`*^9}, 
   3.876421928050329*^9},ExpressionUUID->"0870effe-ba71-4e8d-a338-\
a94599cb3c53"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "loop", " ", "takes", " ", "a", " ", "minutes", " ", "on", 
    " ", "my", " ", "laptop"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"allTransverseShifts", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"transverseShifts", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"transverseShift", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "vF", ",", "\[Rho]t", ",", 
             "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}], "&"}], 
          "/@", "x0k0s"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"allTransverseShifts", ",", "transverseShifts"}], "]"}], 
        ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"\[Alpha]", ",", "\[Alpha]s"}], "}"}]}], "]"}], ",", 
     "\[Alpha]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876299484826909*^9, 3.876299677070499*^9}, {
   3.876299708416728*^9, 3.876299814481843*^9}, {3.876299928394212*^9, 
   3.87630023486406*^9}, {3.876300286371763*^9, 3.876300455224091*^9}, {
   3.876300497651495*^9, 3.876300599018816*^9}, {3.876300633524918*^9, 
   3.876300651838739*^9}, {3.8763007289183273`*^9, 3.876300775961022*^9}, {
   3.876301312797521*^9, 3.8763015146202593`*^9}, {3.876302354665354*^9, 
   3.8763023689243517`*^9}, {3.876302471854248*^9, 3.876302507979559*^9}, {
   3.876368925039076*^9, 3.876368925714225*^9}, {3.876371913175323*^9, 
   3.87637192597616*^9}, {3.876372327692477*^9, 3.876372338532997*^9}, {
   3.87638608260809*^9, 3.876386103933674*^9}, {3.876409960548932*^9, 
   3.8764099716910048`*^9}, {3.8764100258865623`*^9, 3.876410026409265*^9}, {
   3.876414875651495*^9, 3.876414875842993*^9}, 3.876416481562801*^9},
 CellLabel->
  "In[1148]:=",ExpressionUUID->"86a12c82-eff1-4ff0-aec9-df6d82e127e9"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"allTransverseShifts", "[", 
             RowBox[{"[", 
              RowBox[{"a", ",", ";;", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"allTransverseShifts", "[", 
              RowBox[{"[", 
               RowBox[{"a", ",", ";;", ",", "s"}], "]"}], "]"}]}]}], "}"}], 
          "\[Transpose]"}], ",", 
         RowBox[{"{", 
          RowBox[{"s", ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4", ",", "5"}], "}"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Joined", "\[Rule]", "False"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{
            SuperscriptBox["10", 
             RowBox[{"-", "6"}]], ",", "\[Pi]"}], "}"}]}], "}"}]}]}], "]"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", 
       RowBox[{"Length", "[", "\[Alpha]s", "]"}]}], "}"}]}], "]"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"MaTeX", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\text{periapsis }\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\text{Transverse shift }\\\\Delta z\>\""}], "}"}], "]"}]}], 
   ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.87629788303553*^9, 3.876297900689047*^9}, {
   3.876297931928604*^9, 3.8762979934385433`*^9}, {3.876298196309402*^9, 
   3.87629822729698*^9}, {3.876298257482386*^9, 3.876298351437479*^9}, {
   3.876298856387048*^9, 3.876298917843349*^9}, {3.876298968379734*^9, 
   3.8762989857284184`*^9}, {3.8762991176309633`*^9, 
   3.8762991186630583`*^9}, {3.876299154792714*^9, 3.8762991708282547`*^9}, {
   3.876299221629558*^9, 3.87629925054633*^9}, {3.876300987695215*^9, 
   3.876300991395934*^9}, {3.876302536703335*^9, 3.876302544882305*^9}, {
   3.8763025763005533`*^9, 3.876302609986615*^9}, {3.8764100394001427`*^9, 
   3.8764100398855762`*^9}, 3.87641669842813*^9},
 CellLabel->
  "In[1794]:=",ExpressionUUID->"5d7730f4-65a9-493b-aa98-8da6183930da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"export", " ", "data", " ", "to", " ", "CSV", " ", "file"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"dims", "=", 
     RowBox[{"allTransverseShifts", "//", "Dimensions"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"allTransverseShiftsMat", "=", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{"allTransverseShifts", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"dims", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "*", 
          RowBox[{"dims", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"dims", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"\[Alpha]Column", " ", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"\[Alpha]s", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "*", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"dims", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "\[Alpha]s", "]"}]}], "}"}]}], "]"}], 
        "]"}], "}"}], "\[Transpose]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"data", "=", "allTransverseShiftsMat"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"\[Alpha]Column", ",", "data", ",", "2"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\\\\alpha\>\"", ",", " ", "\"\<a\>\"", ",", 
       "\"\<\\\\rho_p/\\\\rho_t\>\"", ",", 
       "\"\<\\\\Delta z from trajectories\>\"", ",", 
       "\"\<\\\\Delta z numerical integration\>\"", ",", 
       "\"\<\\\\Delta z approx.\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</transverse_shift_chi_`1`_rhot_`2`_vF_`3`.csv\>\"", ",", 
         "\[Chi]", ",", "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", "data"}],
     "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876369330981982*^9, 3.8763694305095463`*^9}, {
   3.87636993809477*^9, 3.876369953596612*^9}, {3.876370495328301*^9, 
   3.876370556687056*^9}, {3.8763719469979897`*^9, 3.876371986683949*^9}, 
   3.876372063949712*^9, {3.876372117792478*^9, 3.876372120152749*^9}, {
   3.8763723819586287`*^9, 3.876372448918305*^9}, {3.876372942269519*^9, 
   3.8763729801447783`*^9}, {3.87638029777945*^9, 3.8763802988619432`*^9}, 
   3.876380405400898*^9},
 CellLabel->
  "In[1152]:=",ExpressionUUID->"2f506285-d9ef-4390-a2ff-000ce71b54d0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ti", "=", 
   RowBox[{"-", "30.23605"}]}], ";", 
  RowBox[{"tf", "=", "100"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"\[Alpha]s", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"transverseShift", "[", 
  RowBox[{
   RowBox[{"Sequence", "@@", 
    RowBox[{"x0k0s", "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ",", "vF", ",", "\[Rho]t", ",", 
   "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{"s", ",", 
     RowBox[{"Sequence", "@@", 
      RowBox[{"x0k0s", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ",", "vF", ",", "\[Rho]t", ",", 
     "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", "tf"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"makePlots2D", "[", 
     RowBox[{"fun", ",", "\[Rho]t", ",", 
      RowBox[{"\[Alpha]s", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\[Chi]", ",", "ti", ",", "tf", 
      ",", "2", ",", "3", ",", "False"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", 
   RowBox[{"Graphics", "[", 
    RowBox[{"Arrow", "[", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"fun", "[", "ti", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"fun", "[", "tf", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}]}], "}"}], "]"}], 
     "]"}], "]"}], ",", 
   RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NMinimize", "[", 
  RowBox[{
   RowBox[{"norm", "[", 
    RowBox[{
     RowBox[{"fun", "[", "t", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", 
       RowBox[{";;", "2"}]}], "]"}], "]"}], "]"}], ",", "t"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.876416494657523*^9, 3.876416592186308*^9}, {
  3.87641672408426*^9, 3.876416799023837*^9}, {3.876416830041699*^9, 
  3.876416889796095*^9}, {3.876416921729144*^9, 3.8764169274188137`*^9}, {
  3.876421945365592*^9, 3.876421945662862*^9}, {3.876421982745328*^9, 
  3.876421984991989*^9}, {3.8764220303836517`*^9, 3.87642204476996*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"380db273-ef0e-45ac-b297-98c9101f331b"],

Cell[BoxData[
 RowBox[{"fun", "[", "0", "]"}]], "Input",
 CellChangeTimes->{{3.876421959612914*^9, 3.8764219660648203`*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"76b3bdbd-d9b3-47ec-9a44-86a04c64f3ed"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"create", " ", "all", " ", "necessary", " ", "data"}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"ts", ",", "Nt"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Nt", "=", "401"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ts", "=", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"ti", ",", "tf", ",", 
        FractionBox[
         RowBox[{"tf", "-", "ti"}], "Nt"]}], "]"}], "//", "N"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{"MemberQ", "[", 
        RowBox[{"ts", ",", "0"}], "]"}]}], ",", 
      RowBox[{"ts", "=", 
       RowBox[{"Sort", "[", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"ts", ",", "0"}], "]"}], "]"}]}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"add", " ", "parameters"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{"{", "ts", "}"}], "\[Transpose]"}], ",", "2"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<t\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "\[Alpha]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<\\\\alpha\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "\[Chi]", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<\\\\chi\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "vF", "}"}], "&"}], "/@", "ts"}], ",", "2"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<v_F\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "\[Rho]t", "}"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<\\\\rho_t\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"add", " ", "spatial", " ", "coordinates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"fun", "[", "#", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", " ", "\"\<z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"fun", "'"}], "[", "#", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{
        "\"\<\\\\dot x\>\"", ",", "\"\<\\\\dot y\>\"", ",", " ", 
         "\"\<\\\\dot z\>\""}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"fun", "''"}], "[", "#", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{
        "\"\<\\\\ddot x\>\"", ",", "\"\<\\\\ddot y\>\"", ",", " ", 
         "\"\<\\\\ddot z\>\""}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"add", " ", "momentum", " ", "coordinates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"fun", "[", "#", "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "ts"}], ",", "2"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<k_x\>\"", ",", "\"\<k_y\>\"", ",", " ", "\"\<k_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"spin", ",", " ", 
     RowBox[{"angular", " ", "moment"}], ",", " ", 
     RowBox[{
     "total", " ", "angular", " ", "moment", " ", "and", " ", "energy"}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"spin", "[", 
          RowBox[{"\[Chi]", ",", 
           RowBox[{
            RowBox[{"fun", "[", "#", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], "/@", "ts"}], ",",
        "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<s_x\>\"", ",", "\"\<s_y\>\"", ",", " ", "\"\<s_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"L", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"fun", "[", "#", "]"}]}], "]"}], "&"}], "/@", "ts"}], ",", 
       "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<L_x\>\"", ",", "\"\<L_y\>\"", ",", " ", "\"\<L_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"J", "[", 
          RowBox[{"\[Chi]", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "&"}], "/@", "ts"}], 
       ",", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<J_x\>\"", ",", "\"\<J_y\>\"", ",", " ", "\"\<J_z\>\""}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Epsilon]", "[", 
           RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"fun", "[", "#", "]"}]}]}], "]"}], "}"}], "&"}], "/@", 
        "ts"}], ",", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"header", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"header", ",", 
       RowBox[{"{", "\"\<E\>\"", "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</transverse_shift_example_chi_`1`.csv\>\"", ",", "\[Chi]", ",", 
         "\[Rho]t", ",", "vF"}], "]"}], "]"}]}], ",", "data"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876202449607046*^9, 3.87620246460498*^9}, {
   3.8762025042416563`*^9, 3.8762025081708508`*^9}, {3.8762025478315353`*^9, 
   3.876202549523097*^9}, {3.876202734464232*^9, 3.876202749041786*^9}, {
   3.8762027854989653`*^9, 3.876202828917985*^9}, {3.8762029446456547`*^9, 
   3.87620295351633*^9}, {3.876202990878449*^9, 3.876202990962721*^9}, {
   3.876203098940886*^9, 3.876203158753994*^9}, {3.876209195144755*^9, 
   3.8762092252484627`*^9}, {3.8762092644491997`*^9, 
   3.8762093079588137`*^9}, {3.876209372194146*^9, 3.8762094492272663`*^9}, 
   3.876211207888198*^9, {3.876211581456253*^9, 3.876211581541545*^9}, {
   3.8762116996724987`*^9, 3.876211699784801*^9}, 3.876211757114768*^9, 
   3.876212057023203*^9, {3.8762122808459578`*^9, 3.8762123132928753`*^9}, {
   3.876212782704933*^9, 3.8762128068350887`*^9}, {3.876212839824224*^9, 
   3.876212931826804*^9}, {3.876212973997509*^9, 3.876212992936593*^9}, {
   3.8762130573551407`*^9, 3.8762130977154284`*^9}, {3.87621331494979*^9, 
   3.876213374062437*^9}, {3.8762134601379833`*^9, 3.8762134602508307`*^9}, {
   3.876214135350264*^9, 3.8762141565470552`*^9}, {3.8762160077046213`*^9, 
   3.8762160078519773`*^9}, {3.876216665273892*^9, 3.876216665559404*^9}, {
   3.876278431039276*^9, 3.87627844491685*^9}, {3.8762792000630083`*^9, 
   3.876279200212097*^9}, {3.876279294801033*^9, 3.876279301047196*^9}, {
   3.876279561623369*^9, 3.876279604254713*^9}, {3.8762801131120443`*^9, 
   3.876280129618326*^9}, {3.876280164523526*^9, 3.876280187106764*^9}, {
   3.876374609467863*^9, 3.876374687513371*^9}, 3.876374978965086*^9, {
   3.876375020809722*^9, 3.876375115849485*^9}, {3.876375230483272*^9, 
   3.876375329044094*^9}, {3.876379341386565*^9, 3.8763793415683393`*^9}, {
   3.8763805655612707`*^9, 3.876380660805534*^9}, {3.8763811433135*^9, 
   3.876381148229204*^9}, {3.87638119011854*^9, 3.8763812194903107`*^9}, {
   3.8763813815607147`*^9, 3.876381381736446*^9}, {3.876381648709656*^9, 
   3.87638165273878*^9}, {3.876382839957404*^9, 3.8763828400478487`*^9}, {
   3.876416941559304*^9, 3.87641700078365*^9}, {3.876418324204833*^9, 
   3.87641832473638*^9}},
 CellLabel->
  "In[1327]:=",ExpressionUUID->"fd9c792f-35ec-48e1-b291-b18da3c1dd50"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export example trajectories for python / blender scripts", "Subsection",
 CellChangeTimes->{{3.876211684824133*^9, 3.876211687491818*^9}, {
  3.876216291171008*^9, 3.876216291828706*^9}, {3.876278401973187*^9, 
  3.8762784154034863`*^9}, {3.87628050876005*^9, 3.876280509659204*^9}, {
  3.876372998181967*^9, 
  3.876373021645277*^9}},ExpressionUUID->"49117bdc-ab77-4159-8667-\
916cd02a010c"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t", ",", "data", ",", "header1", ",", "header2", ",", 
   "data1", ",", "data2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vF", "=", "1"}], ";", 
   RowBox[{"\[Rho]t", "=", "1"}], ";", 
   RowBox[{"\[Alpha]", "=", 
    RowBox[{"1", "/", "2"}]}], ";", 
   RowBox[{"ti", "=", "0"}], ";", 
   RowBox[{"tf", "=", 
    RowBox[{"31.5", "*", "\[Rho]t"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x0", ",", "k0"}], "}"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "20"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.1644", ",", "1", ",", "0"}], "}"}]}], "}"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x0", ",", "k0"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "20"}], ",", "0"}], "}"}], "*", "\[Rho]t"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.167", ",", "1", ",", "0"}], "}"}], "/", "\[Rho]t"}]}], 
     "}"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{
    "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
     ",", 
     RowBox[{"\[Chi]", "=", 
      RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots2D", "[", 
    RowBox[{
    "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
     "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"data1", ",", "header1"}], "}"}], "=", 
   RowBox[{"createData", "[", 
    RowBox[{
    "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
     "ti", ",", "tf", ",", " ", "201"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fun", "[", "s_", "]"}], "=", 
   RowBox[{"solveSEOM", "[", 
    RowBox[{
    "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
     ",", 
     RowBox[{"\[Chi]", "=", 
      RowBox[{"-", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makePlots2D", "[", 
    RowBox[{
    "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
     "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"data2", ",", "header2"}], "}"}], "=", 
   RowBox[{"createData", "[", 
    RowBox[{
    "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
     "ti", ",", "tf", ",", " ", "201"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"data1", ",", "data2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Prepend", "[", 
    RowBox[{"data", ",", "header1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathOut", "=", 
   RowBox[{"SetDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathOut", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"StringForm", "[", 
      RowBox[{
      "\"\</lensing.csv\>\"", ",", "\[Chi]", ",", "\[Rho]t", ",", "vF"}], 
      "]"}], "]"}]}], ",", "data"}], "]"}]}], "Input",
 CellChangeTimes->{{3.876841001755007*^9, 3.876841003791091*^9}, {
   3.876841077168263*^9, 3.8768412694202957`*^9}, 3.876841381719429*^9, {
   3.876841453157504*^9, 3.876841465234432*^9}, 3.876841502419917*^9, {
   3.876841621690765*^9, 3.876841644033751*^9}, {3.876841698497971*^9, 
   3.876841826170759*^9}, {3.8768418615887737`*^9, 3.8768419595586233`*^9}, {
   3.876842006834156*^9, 3.876842035254355*^9}, {3.876842381977064*^9, 
   3.876842401064389*^9}, 3.8768433097657757`*^9, {3.8768444210736647`*^9, 
   3.876844425617117*^9}, {3.876844531512841*^9, 3.876844539530815*^9}, 
   3.8768447496788807`*^9, {3.8768449087333717`*^9, 3.876844916846984*^9}, {
   3.876845004653029*^9, 3.8768450360766697`*^9}, 3.8768830536224203`*^9, 
   3.876883257773134*^9, 3.876883794424837*^9, {3.876884032447543*^9, 
   3.876884046928669*^9}, {3.8768840960950737`*^9, 3.8768841249113398`*^9}, {
   3.876884371755968*^9, 3.876884373662796*^9}, {3.8768845150511503`*^9, 
   3.876884517490637*^9}, {3.876887544757514*^9, 3.8768875477501993`*^9}, 
   3.8768896500960827`*^9, {3.876889692722703*^9, 3.8768896974452972`*^9}, {
   3.876889734355641*^9, 3.876889737496272*^9}, {3.8768901374531603`*^9, 
   3.8768901492514677`*^9}, {3.876909991565831*^9, 3.876910004547984*^9}, {
   3.8769929265649843`*^9, 3.876993053126361*^9}, {3.876993535462082*^9, 
   3.876993618563311*^9}, {3.876994485591386*^9, 3.8769944905584507`*^9}, 
   3.8771655623326607`*^9, 3.877166572045574*^9, {3.877166631355433*^9, 
   3.877166695417758*^9}, {3.877166739468849*^9, 3.877166790977713*^9}, {
   3.87716703501562*^9, 3.877167072978856*^9}, {3.877167297658736*^9, 
   3.8771672981628647`*^9}},
 CellLabel->
  "In[386]:=",ExpressionUUID->"e0e5eeca-8ee6-465c-805e-e075833c129c"],

Cell[BoxData["\<\"/Users/andreashaller/lensing_device_clean/codes/lensing.csv\
\"\>"], "Output",
 CellChangeTimes->{
  3.877166797842906*^9, {3.877167040775723*^9, 3.8771670777662973`*^9}, {
   3.8771672831267853`*^9, 3.877167303031815*^9}},
 CellLabel->
  "Out[400]=",ExpressionUUID->"a4aa2940-274b-49b9-8dfa-c59aab099f45"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"Clear", "[", "\[Epsilon]peff", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Epsilon]peff", "[", 
   RowBox[{
   "\[Rho]_", ",", "Lz_", ",", "vF_", ",", "\[Alpha]_", ",", "\[Rho]t_"}], 
   "]"}], ":=", 
  RowBox[{
   FractionBox[
    SuperscriptBox["Lz", "2"], 
    SuperscriptBox["\[Rho]", "2"]], 
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["vF", "2"], "-", 
     SuperscriptBox[
      RowBox[{"u", "[", 
       RowBox[{"\[Alpha]", ",", "vF", ",", "\[Rho]t", ",", "\[Rho]"}], "]"}], 
      "2"]}], ")"}]}]}]}], "Input",
 CellChangeTimes->{{3.876909839798931*^9, 3.8769099026515636`*^9}, {
  3.8769109456086683`*^9, 3.8769109488574266`*^9}, {3.876911035173243*^9, 
  3.876911035382072*^9}},
 CellLabel->
  "In[982]:=",ExpressionUUID->"a2e5d6a7-4025-46d0-9533-cce607299c6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Epsilon]peffs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"\[Epsilon]peff", "[", 
      RowBox[{
       RowBox[{"norm", "[", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"xvs", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"Lzs", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", "vF", ",", "\[Alpha]", ",", 
       "\[Rho]t"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "ts", "]"}]}], "}"}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.876909533239388*^9, 3.876909562656561*^9}, {
  3.876909612381916*^9, 3.8769096211105633`*^9}, {3.876909658957049*^9, 
  3.876909659337927*^9}, {3.8769097927752457`*^9, 3.876909819816079*^9}, {
  3.876909912860282*^9, 3.876909942520022*^9}, {3.876910515474333*^9, 
  3.8769105178930607`*^9}, {3.876910649247176*^9, 3.876910685099617*^9}, {
  3.876910847517892*^9, 3.876910854861659*^9}, {3.876910968310522*^9, 
  3.876911002542387*^9}},
 CellLabel->
  "In[984]:=",ExpressionUUID->"3d8ddd2c-b4ac-443e-a207-09d5f816007f"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Epsilon]peff", "[", 
    RowBox[{
     RowBox[{"norm", "[", 
      RowBox[{"\[Rho]", "[", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", "0"}], "}"}], "]"}], "]"}], ",", 
     RowBox[{"Lzs", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "vF", ",", "\[Alpha]", ",", 
     "\[Rho]t"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "1", ",", "10"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.876911456224819*^9, 3.876911460146995*^9}, {
  3.876911660950986*^9, 3.876911664963983*^9}, {3.876911696983629*^9, 
  3.876911697947524*^9}},
 CellLabel->
  "In[1032]:=",ExpressionUUID->"7bca24e4-a67f-4bb9-bc98-50ff0fc9a1ef"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"DensityPlot", "[", 
    RowBox[{
     RowBox[{"\[Epsilon]peff", "[", 
      RowBox[{
       RowBox[{"norm", "[", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"{", 
          RowBox[{"x", ",", "y", ",", "0"}], "}"}], "]"}], "]"}], ",", 
       RowBox[{"Lzs", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "vF", ",", "\[Alpha]", ",", 
       "\[Rho]t"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", 
       RowBox[{"-", "10"}], ",", "10"}], "}"}], ",", 
     RowBox[{"Frame", "->", "False"}], ",", 
     RowBox[{"MaxRecursion", "->", "15"}], ",", 
     RowBox[{"PlotPoints", "->", "100"}], ",", 
     RowBox[{"ClippingStyle", "->", "Black"}], ",", 
     RowBox[{"PlotRange", "->", 
      RowBox[{"{", 
       RowBox[{"0", ",", "2.5"}], "}"}]}], ",", 
     RowBox[{"PlotTheme", "->", "\"\<Scientific\>\""}], ",", 
     RowBox[{"PlotRangePadding", "->", "0"}]}], "]"}], ",", 
   RowBox[{"Graphics", "[", 
    RowBox[{"Arrow", "[", 
     RowBox[{"Line", "[", 
      RowBox[{"xvs", "[", 
       RowBox[{"[", 
        RowBox[{";;", ",", 
         RowBox[{";;", "2"}]}], "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
   RowBox[{"GridLines", "->", "None"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8769111393335667`*^9, 3.876911289113914*^9}, {
  3.876911367867474*^9, 3.876911374794229*^9}, {3.876911426106331*^9, 
  3.876911443216055*^9}, {3.876911674922196*^9, 3.8769117634667*^9}, {
  3.8769120160103683`*^9, 3.876912083337117*^9}},
 CellLabel->
  "In[1033]:=",ExpressionUUID->"a01e2b63-80bb-49d6-a5f8-2f8943890a36"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dtrhosqsLHS", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      SuperscriptBox[
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"norm", "[", 
          RowBox[{"\[Rho]", "[", 
           RowBox[{
            RowBox[{"fun", "[", "s", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "s"}], "]"}], 
       "2"], "/.", 
      RowBox[{"{", 
       RowBox[{"s", "->", "#"}], "}"}]}], "&"}], "/@", "ts"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dtrhosqsRHS", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["\[Epsilon]s", "2"], "-", "\[Epsilon]peffs"}], ")"}], 
    "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SuperscriptBox[
        RowBox[{"norm", "[", "#", "]"}], "2"], "&"}], "/@", "kvs"}], 
     ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"dtrhosqsLHS", ",", "dtrhosqsRHS"}], "}"}], "//", 
  "ListPlot"}]}], "Input",
 CellChangeTimes->{{3.876910011934535*^9, 3.87691009243574*^9}, {
  3.87691032531509*^9, 3.876910385005013*^9}, {3.876910707399872*^9, 
  3.8769107738067713`*^9}, {3.87691083326567*^9, 3.8769109315191298`*^9}, {
  3.87691104520516*^9, 3.876911115359598*^9}},
 CellLabel->
  "In[1034]:=",ExpressionUUID->"08165883-7568-439f-81d9-de138afe44cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"norm", "[", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{
               RowBox[{"fun", "[", "s", "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "s"}], 
           "]"}], "2"], "/.", 
         RowBox[{"{", 
          RowBox[{"s", "->", "#"}], "}"}]}], "&"}], "/@", "ts"}], ")"}], "*", 
     
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SuperscriptBox[
         RowBox[{"norm", "[", "#", "]"}], "2"], "&"}], "/@", "kvs"}], ")"}]}],
     ",", "\[Epsilon]peffs", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"D", "[", 
            RowBox[{
             RowBox[{"norm", "[", 
              RowBox[{"\[Rho]", "[", 
               RowBox[{
                RowBox[{"fun", "[", "s", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "s"}], 
            "]"}], "2"], "/.", 
          RowBox[{"{", 
           RowBox[{"s", "->", "#"}], "}"}]}], "&"}], "/@", "ts"}], ")"}], "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SuperscriptBox[
          RowBox[{"norm", "[", "#", "]"}], "2"], "&"}], "/@", "kvs"}], 
       ")"}]}], "+", "\[Epsilon]peffs"}]}], "}"}], "//", 
  "ListPlot"}]], "Input",
 CellChangeTimes->{{3.876912185241496*^9, 3.8769122912141647`*^9}},
 CellLabel->
  "In[1045]:=",ExpressionUUID->"fe1e313c-38bd-4a68-aa83-73a53096a910"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{
  "fun", ",", "x0", ",", "k0", ",", "kx0", ",", "ky0", ",", "t", ",", "s", 
   ",", "fun", ",", "vF", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
   "tf", ",", "\[Rho]t", ",", "data", ",", "header1", ",", "header2", ",", 
   "data1", ",", "data2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vF", "=", "1"}], ";", 
  RowBox[{"\[Rho]t", "=", "1"}], ";", 
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"1", "/", "2"}]}], ";", 
  RowBox[{"ti", "=", "0"}], ";", 
  RowBox[{"tf", "=", "30"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ky0", " ", "=", " ", 
   FractionBox["\[Alpha]", 
    RowBox[{"\[Alpha]", "+", "1"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kx0", "=", 
   FractionBox["ky0", 
    SqrtBox["\[Alpha]"]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"x0", ",", "k0"}], "}"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Rho]s", "[", 
       RowBox[{"\[Rho]t", ",", "\[Alpha]"}], "]"}], ",", "0", ",", "0"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kx0", ",", "ky0", ",", "0"}], "}"}], "/", "\[Rho]t"}]}], 
   "}"}]}]}], "Input",
 CellChangeTimes->{{3.876841001755007*^9, 3.876841003791091*^9}, {
   3.876841077168263*^9, 3.8768412694202957`*^9}, 3.876841381719429*^9, {
   3.876841453157504*^9, 3.876841465234432*^9}, 3.876841502419917*^9, {
   3.876841621690765*^9, 3.876841644033751*^9}, {3.876841698497971*^9, 
   3.876841826170759*^9}, {3.8768418615887737`*^9, 3.8768419595586233`*^9}, {
   3.876842006834156*^9, 3.876842035254355*^9}, {3.876842381977064*^9, 
   3.876842401064389*^9}, 3.8768433097657757`*^9, {3.8768444210736647`*^9, 
   3.876844425617117*^9}, {3.876844531512841*^9, 3.876844539530815*^9}, 
   3.8768447496788807`*^9, {3.8768449087333717`*^9, 3.876844916846984*^9}, {
   3.876845004653029*^9, 3.8768450360766697`*^9}, 3.8768830536224203`*^9, 
   3.876883257773134*^9, 3.876883794424837*^9, {3.876884032447543*^9, 
   3.876884046928669*^9}, {3.8768840960950737`*^9, 3.8768841249113398`*^9}, {
   3.876884259403254*^9, 3.8768843213564157`*^9}, {3.876884425074397*^9, 
   3.8768844507384853`*^9}, {3.876884494660097*^9, 3.8768844973591137`*^9}, 
   3.8768845276242037`*^9, {3.876886818231607*^9, 3.876886822374219*^9}, {
   3.876907410399376*^9, 3.876907411522505*^9}, 3.876993313982235*^9, {
   3.8769933578815327`*^9, 3.876993461662043*^9}, {3.8769949595483007`*^9, 
   3.876994991409333*^9}, {3.87699508720268*^9, 3.876995218755274*^9}, {
   3.876996237648796*^9, 3.876996247065325*^9}, {3.876996289604611*^9, 
   3.876996355813283*^9}, {3.877167838880122*^9, 3.8771678632294617`*^9}, {
   3.877167905143476*^9, 3.877167929541995*^9}, {3.877168231342227*^9, 
   3.877168231391014*^9}},
 CellLabel->
  "In[457]:=",ExpressionUUID->"f942659e-6621-49ba-9c08-cbe017c8fb1e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     FractionBox["3", "2"], ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     FractionBox[
      SqrtBox["2"], "3"], ",", 
     FractionBox["1", "3"], ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8771678514405003`*^9, 3.877167864116067*^9}, {
   3.877167905929915*^9, 3.877167930226075*^9}, 3.877168231990753*^9},
 CellLabel->
  "Out[461]=",ExpressionUUID->"6ea9575b-63e4-43f2-a2bb-99dfd2541155"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "obtain", " ", "solution", " ", "with", " ", "initial", " ", "conditions",
      " ", "x0"}], ",", " ", "k0"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"fun", "[", "s_", "]"}], "=", 
     RowBox[{"solveSEOM", "[", 
      RowBox[{
      "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
       ",", 
       RowBox[{"\[Chi]", "=", 
        RowBox[{"+", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"makePlots", "[", 
        RowBox[{
        "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",",
          "tf", ",", "False"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"ViewPoint", "\[Rule]", 
       RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots2D", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data1", ",", "header1"}], "}"}], "=", 
     RowBox[{"createData", "[", 
      RowBox[{
      "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
       "ti", ",", "tf", ",", " ", "201"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fun", "[", "s_", "]"}], "=", 
     RowBox[{"solveSEOM", "[", 
      RowBox[{
      "s", ",", "x0", ",", "k0", ",", "vF", ",", "\[Rho]t", ",", "\[Alpha]", 
       ",", 
       RowBox[{"\[Chi]", "=", 
        RowBox[{"-", "1"}]}], ",", "ti", ",", "tf"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"makePlots", "[", 
        RowBox[{
        "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",",
          "tf", ",", "False"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"ViewPoint", "\[Rule]", 
       RowBox[{"{", "Right", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makePlots2D", "[", 
      RowBox[{
      "fun", ",", "\[Rho]t", ",", "\[Alpha]", ",", "\[Chi]", ",", "ti", ",", 
       "tf", ",", "1", ",", "2", ",", "False"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data2", ",", "header2"}], "}"}], "=", 
     RowBox[{"createData", "[", 
      RowBox[{
      "\[Alpha]", ",", "\[Chi]", ",", "vF", ",", "\[Rho]t", ",", "fun", ",", 
       "ti", ",", "tf", ",", " ", "201"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Join", "[", 
      RowBox[{"data1", ",", "data2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Prepend", "[", 
      RowBox[{"data", ",", "header1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pathOut", "=", 
     RowBox[{"SetDirectory", "[", 
      RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"pathOut", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\</unstable_orbit.csv\>\"", ",", "\[Chi]", ",", "\[Rho]t", ",", 
         "vF"}], "]"}], "]"}]}], ",", "data"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.876841001755007*^9, 3.876841003791091*^9}, {
   3.876841077168263*^9, 3.8768412694202957`*^9}, 3.876841381719429*^9, {
   3.876841453157504*^9, 3.876841465234432*^9}, 3.876841502419917*^9, {
   3.876841621690765*^9, 3.876841644033751*^9}, {3.876841698497971*^9, 
   3.876841826170759*^9}, {3.8768418615887737`*^9, 3.8768419595586233`*^9}, {
   3.876842006834156*^9, 3.876842035254355*^9}, {3.876842381977064*^9, 
   3.876842401064389*^9}, 3.8768433097657757`*^9, {3.8768444210736647`*^9, 
   3.876844425617117*^9}, {3.876844531512841*^9, 3.876844539530815*^9}, 
   3.8768447496788807`*^9, {3.8768449087333717`*^9, 3.876844916846984*^9}, {
   3.876845004653029*^9, 3.8768450360766697`*^9}, 3.8768830536224203`*^9, 
   3.876883257773134*^9, 3.876883794424837*^9, {3.876884032447543*^9, 
   3.876884046928669*^9}, {3.8768840960950737`*^9, 3.8768841249113398`*^9}, {
   3.876884371755968*^9, 3.876884373662796*^9}, {3.8768845150511503`*^9, 
   3.876884517490637*^9}, {3.876887544757514*^9, 3.8768875477501993`*^9}, 
   3.8768896500960827`*^9, {3.876889692722703*^9, 3.8768896974452972`*^9}, {
   3.876889734355641*^9, 3.876889737496272*^9}, {3.8768901374531603`*^9, 
   3.8768901492514677`*^9}, {3.876909991565831*^9, 3.876910004547984*^9}, {
   3.8769929265649843`*^9, 3.876993053126361*^9}, {3.876993535462082*^9, 
   3.876993618563311*^9}, {3.876994485591386*^9, 3.8769944905584507`*^9}, 
   3.8771655623326607`*^9, 3.877166572045574*^9, {3.877166631355433*^9, 
   3.877166695417758*^9}, {3.877166739468849*^9, 3.877166790977713*^9}, {
   3.87716703501562*^9, 3.877167072978856*^9}, {3.877167297658736*^9, 
   3.8771672981628647`*^9}, {3.87716782703633*^9, 3.8771678679722433`*^9}},
 CellLabel->
  "In[462]:=",ExpressionUUID->"6b3cf5e4-61f5-4f83-8d1b-bdb9a534f25d"],

Cell[BoxData["\<\"/Users/andreashaller/lensing_device_clean/codes/unstable_\
orbit.csv\"\>"], "Output",
 CellChangeTimes->{
  3.8771678750845203`*^9, {3.87716791084129*^9, 3.877167935869239*^9}, 
   3.87716823701587*^9},
 CellLabel->
  "Out[473]=",ExpressionUUID->"e2dd7ce8-ac49-4c4a-91b5-c3eeecee03d5"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1440, 847},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> True}, "TryRealOnly" -> False},
Magnification:>1.5 Inherited,
FrontEndVersion->"12.2 for Mac OS X x86 (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"a6ccc10e-d63f-42dc-8cb4-736dc525cd0d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 678, 15, 138, "Subtitle",ExpressionUUID->"85bcbaea-da79-47a9-8841-3e5fd17331cb"],
Cell[1261, 39, 588, 17, 89, "Text",ExpressionUUID->"972199aa-7d14-4887-b813-b221dd610ba3",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1874, 60, 227, 4, 81, "Subsection",ExpressionUUID->"16834aeb-6dc8-44ad-b1a3-534a9027c016"],
Cell[CellGroupData[{
Cell[2126, 68, 165, 3, 67, "Subsubsection",ExpressionUUID->"bf937a19-27d2-4354-aaf4-706dd50f00fe"],
Cell[2294, 73, 19479, 435, 2786, "Input",ExpressionUUID->"8c845484-fbdb-440b-9c72-f8615d0ef9dd",
 InitializationCell->True],
Cell[21776, 510, 6511, 106, 164, "Input",ExpressionUUID->"4f22d022-b777-4da8-bee6-99a5ec583125",
 InitializationCell->True],
Cell[28290, 618, 5927, 85, 102, "Input",ExpressionUUID->"f2a61410-9d2d-4663-9dde-d0f4096b7917",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[34254, 708, 159, 3, 53, "Subsubsection",ExpressionUUID->"7ef52e73-a8a0-414d-bc87-366b20317915"],
Cell[34416, 713, 16948, 423, 1893, "Input",ExpressionUUID->"8993ef5f-aa5a-4840-baed-a3ef0d44ff0c",
 InitializationCell->True],
Cell[51367, 1138, 2118, 47, 133, "Input",ExpressionUUID->"07001438-fc15-4819-b89d-bdc34fe5fe08",
 InitializationCell->True],
Cell[53488, 1187, 1089, 26, 102, "Input",ExpressionUUID->"c1f8ba6c-be24-45f4-8e20-fdef409918cf",
 InitializationCell->True],
Cell[54580, 1215, 715, 15, 70, "Input",ExpressionUUID->"339cc039-9676-4aeb-a571-7f0325e2b968",
 InitializationCell->True],
Cell[55298, 1232, 16623, 408, 1512, "Input",ExpressionUUID->"32b1e47c-a4b0-4d8a-9e85-6e3c67104036",
 InitializationCell->True],
Cell[71924, 1642, 1985, 39, 133, "Input",ExpressionUUID->"ad230d05-71dc-4410-9588-11c4a3edf72a",
 InitializationCell->True],
Cell[73912, 1683, 1994, 51, 195, "Input",ExpressionUUID->"ba8d8622-4acf-4c36-b8a8-aa0ed56046f2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[75943, 1739, 164, 3, 53, "Subsubsection",ExpressionUUID->"8a19a71f-2c87-4dfe-acc9-c9c236223541"],
Cell[76110, 1744, 8868, 218, 2083, "Input",ExpressionUUID->"2eb269a6-aef2-4b4e-8628-13f5f2b3580e",
 InitializationCell->True],
Cell[84981, 1964, 1653, 41, 164, "Input",ExpressionUUID->"95e1a0c5-c9eb-4ca7-9e7f-3856f08472a4",
 InitializationCell->True],
Cell[86637, 2007, 910, 16, 102, "Input",ExpressionUUID->"d10d3fd9-6c76-4c1b-8fdf-b51a0e619353",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[87584, 2028, 169, 3, 53, "Subsubsection",ExpressionUUID->"5a03dbae-22f6-4134-950d-a2d224cabd7f"],
Cell[87756, 2033, 8667, 227, 1096, "Input",ExpressionUUID->"fe9c22e8-f27d-42e2-b49a-0961909f16b1",
 InitializationCell->True],
Cell[96426, 2262, 1304, 36, 133, "Input",ExpressionUUID->"335cf137-7340-428e-8052-7ac34a2543da",
 InitializationCell->True],
Cell[97733, 2300, 564, 11, 70, "Input",ExpressionUUID->"ee7184fa-6857-44f7-8653-a7c236d8b1f1",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[98334, 2316, 219, 4, 53, "Subsubsection",ExpressionUUID->"b9d05c5d-92b3-4aa7-ac20-4d8106c063a7"],
Cell[98556, 2322, 19456, 530, 2668, "Input",ExpressionUUID->"fe0b4360-e270-4fdc-aaf1-d0efddd3c958"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[118061, 2858, 210, 4, 81, "Subsection",ExpressionUUID->"86b1f668-e169-4b17-a61c-a53b2d76c76a"],
Cell[CellGroupData[{
Cell[118296, 2866, 382, 11, 68, "Subsubsection",ExpressionUUID->"ddbfbf95-e699-4310-ac22-3ca21f7da378"],
Cell[118681, 2879, 2667, 69, 613, "Input",ExpressionUUID->"52a5c363-57b5-4f43-92d6-007efce1bc98"]
}, Closed]],
Cell[CellGroupData[{
Cell[121385, 2953, 438, 11, 54, "Subsubsection",ExpressionUUID->"e400a94b-50e9-4a76-9b3f-7b27548d0b58"],
Cell[121826, 2966, 3398, 76, 520, "Input",ExpressionUUID->"be4390f1-80cd-4645-8f77-51169d87dec9"]
}, Closed]],
Cell[CellGroupData[{
Cell[125261, 3047, 311, 5, 53, "Subsubsection",ExpressionUUID->"99db847d-8409-429b-a999-e56108e9aafa"],
Cell[125575, 3054, 4577, 99, 698, "Input",ExpressionUUID->"f86fa1e1-9ccf-4d85-b2c6-d98abf7c18f6"]
}, Closed]],
Cell[CellGroupData[{
Cell[130189, 3158, 353, 6, 53, "Subsubsection",ExpressionUUID->"70471d8d-9051-45ec-b1bf-98b5dbc06736"],
Cell[130545, 3166, 3827, 85, 357, "Input",ExpressionUUID->"f61fd84f-76b3-4026-a36f-2db6bd32ce3e"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[134421, 3257, 281, 4, 81, "Subsection",ExpressionUUID->"471f9e0e-9fd6-41aa-88e7-07f9cf41fd74"],
Cell[CellGroupData[{
Cell[134727, 3265, 164, 3, 67, "Subsubsection",ExpressionUUID->"4241d1b9-6af5-44b4-8bca-4bf29d0c6b6e"],
Cell[134894, 3270, 3598, 76, 206, "Input",ExpressionUUID->"d47f2d2d-d412-4165-a857-008bf648df85"],
Cell[138495, 3348, 1957, 46, 201, "Input",ExpressionUUID->"8af3d2f2-481f-4b92-87fc-911d38acc3fe"],
Cell[140455, 3396, 2276, 54, 315, "Input",ExpressionUUID->"0583762d-6a2c-4743-829f-49831259bc0b"],
Cell[142734, 3452, 2193, 58, 202, "Input",ExpressionUUID->"96cd8e0f-a2b3-4cd7-a909-e1ef93fabc14"],
Cell[144930, 3512, 1820, 53, 345, "Input",ExpressionUUID->"25d2edc8-bba5-46cd-b9c0-42e2ba3ad368"],
Cell[146753, 3567, 1714, 52, 252, "Input",ExpressionUUID->"b57f2315-6a47-4e3b-ae1f-9a8347fb422c"],
Cell[148470, 3621, 2996, 81, 482, "Input",ExpressionUUID->"7d178f7e-6901-4b9d-a916-d71c597080ed"],
Cell[151469, 3704, 169, 3, 52, "Text",ExpressionUUID->"e94f44fa-0464-4dc8-807f-8cdfcc7631a2"],
Cell[151641, 3709, 1313, 32, 139, "Input",ExpressionUUID->"02310316-9c35-41d9-bb69-c3be73d4728d"],
Cell[152957, 3743, 620, 12, 44, "Input",ExpressionUUID->"c2b09f99-11c2-4cfc-8f37-6265e4d084ea"]
}, Closed]],
Cell[CellGroupData[{
Cell[153614, 3760, 217, 4, 53, "Subsubsection",ExpressionUUID->"7342a176-fb88-4a7e-aa53-ccd7ffc4c5c0"],
Cell[153834, 3766, 2170, 55, 206, "Input",ExpressionUUID->"0870effe-ba71-4e8d-a338-a94599cb3c53"],
Cell[156007, 3823, 2186, 45, 232, "Input",ExpressionUUID->"86a12c82-eff1-4ff0-aec9-df6d82e127e9"],
Cell[158196, 3870, 2274, 55, 280, "Input",ExpressionUUID->"5d7730f4-65a9-493b-aa98-8da6183930da"],
Cell[160473, 3927, 3229, 85, 544, "Input",ExpressionUUID->"2f506285-d9ef-4390-a2ff-000ce71b54d0"],
Cell[163705, 4014, 2568, 68, 232, "Input",ExpressionUUID->"380db273-ef0e-45ac-b297-98c9101f331b"],
Cell[166276, 4084, 203, 3, 44, "Input",ExpressionUUID->"76b3bdbd-d9b3-47ec-9a44-86a04c64f3ed"],
Cell[166482, 4089, 11543, 314, 1353, "Input",ExpressionUUID->"fd9c792f-35ec-48e1-b291-b18da3c1dd50"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[178074, 4409, 398, 6, 81, "Subsection",ExpressionUUID->"49117bdc-ab77-4159-8667-916cd02a010c"],
Cell[CellGroupData[{
Cell[178497, 4419, 6593, 168, 543, "Input",ExpressionUUID->"e0e5eeca-8ee6-465c-805e-e075833c129c"],
Cell[185093, 4589, 324, 6, 52, "Output",ExpressionUUID->"a4aa2940-274b-49b9-8dfa-c59aab099f45"]
}, Open  ]],
Cell[185432, 4598, 813, 22, 111, "Input",ExpressionUUID->"a2e5d6a7-4025-46d0-9533-cce607299c6f"],
Cell[186248, 4622, 1104, 26, 46, "Input",ExpressionUUID->"3d8ddd2c-b4ac-443e-a207-09d5f816007f"],
Cell[187355, 4650, 703, 18, 46, "Input",ExpressionUUID->"7bca24e4-a67f-4bb9-bc98-50ff0fc9a1ef"],
Cell[188061, 4670, 1687, 42, 140, "Input",ExpressionUUID->"a01e2b63-80bb-49d6-a5f8-2f8943890a36"],
Cell[189751, 4714, 1327, 40, 112, "Input",ExpressionUUID->"08165883-7568-439f-81d9-de138afe44cf"],
Cell[191081, 4756, 1676, 53, 84, "Input",ExpressionUUID->"fe1e313c-38bd-4a68-aa83-73a53096a910"],
Cell[CellGroupData[{
Cell[192782, 4813, 2875, 59, 233, "Input",ExpressionUUID->"f942659e-6621-49ba-9c08-cbe017c8fb1e"],
Cell[195660, 4874, 502, 14, 75, "Output",ExpressionUUID->"6ea9575b-63e4-43f2-a2bb-99dfd2541155"]
}, Open  ]],
Cell[CellGroupData[{
Cell[196199, 4893, 5450, 128, 419, "Input",ExpressionUUID->"6b3cf5e4-61f5-4f83-8d1b-bdb9a534f25d"],
Cell[201652, 5023, 303, 6, 52, "Output",ExpressionUUID->"e2dd7ce8-ac49-4c4a-91b5-c3eeecee03d5"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

